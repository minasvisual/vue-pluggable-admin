'use strict';

var vue = require('vue');
var _ = require('lodash');
var axios = require('axios');
var deepmerge = require('deepmerge');
var moment = require('moment');
var vue$1 = require('@formkit/vue');

const _hoisted_1$w = {
  xmlns: "http://www.w3.org/2000/svg",
  viewBox: "0 0 320 512"
};
const _hoisted_2$s = /*#__PURE__*/vue.createElementVNode("path", { d: "M9.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l192 192c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L77.3 256 246.6 86.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-192 192z" }, null, -1 /* HOISTED */);
const _hoisted_3$m = [
  _hoisted_2$s
];

function render$f(_ctx, _cache) {
  return (vue.openBlock(), vue.createElementBlock("svg", _hoisted_1$w, _hoisted_3$m))
}

const script$y = {};


script$y.render = render$f;
script$y.__file = "src/components/icons/ChevronLeft.vue";

const _hoisted_1$v = {
  xmlns: "http://www.w3.org/2000/svg",
  viewBox: "0 0 320 512"
};
const _hoisted_2$r = /*#__PURE__*/vue.createElementVNode("path", { d: "M310.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-192 192c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L242.7 256 73.4 86.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l192 192z" }, null, -1 /* HOISTED */);
const _hoisted_3$l = [
  _hoisted_2$r
];

function render$e(_ctx, _cache) {
  return (vue.openBlock(), vue.createElementBlock("svg", _hoisted_1$v, _hoisted_3$l))
}

const script$x = {};


script$x.render = render$e;
script$x.__file = "src/components/icons/ChevronRight.vue";

const _hoisted_1$u = {
  xmlns: "http://www.w3.org/2000/svg",
  viewBox: "0 0 384 512"
};
const _hoisted_2$q = /*#__PURE__*/vue.createElementVNode("path", { d: "M169.4 470.6c12.5 12.5 32.8 12.5 45.3 0l160-160c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L224 370.8 224 64c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 306.7L54.6 265.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l160 160z" }, null, -1 /* HOISTED */);
const _hoisted_3$k = [
  _hoisted_2$q
];

function render$d(_ctx, _cache) {
  return (vue.openBlock(), vue.createElementBlock("svg", _hoisted_1$u, _hoisted_3$k))
}

const script$w = {};


script$w.render = render$d;
script$w.__file = "src/components/icons/ArrowDown.vue";

const _hoisted_1$t = {
  xmlns: "http://www.w3.org/2000/svg",
  viewBox: "0 0 384 512"
};
const _hoisted_2$p = /*#__PURE__*/vue.createElementVNode("path", { d: "M214.6 41.4c-12.5-12.5-32.8-12.5-45.3 0l-160 160c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L160 141.2V448c0 17.7 14.3 32 32 32s32-14.3 32-32V141.2L329.4 246.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3l-160-160z" }, null, -1 /* HOISTED */);
const _hoisted_3$j = [
  _hoisted_2$p
];

function render$c(_ctx, _cache) {
  return (vue.openBlock(), vue.createElementBlock("svg", _hoisted_1$t, _hoisted_3$j))
}

const script$v = {};


script$v.render = render$c;
script$v.__file = "src/components/icons/ArrowUp.vue";

const _hoisted_1$s = {
  xmlns: "http://www.w3.org/2000/svg",
  viewBox: "0 0 512 512"
};
const _hoisted_2$o = /*#__PURE__*/vue.createElementVNode("path", { d: "M441 58.9L453.1 71c9.4 9.4 9.4 24.6 0 33.9L424 134.1 377.9 88 407 58.9c9.4-9.4 24.6-9.4 33.9 0zM209.8 256.2L344 121.9 390.1 168 255.8 302.2c-2.9 2.9-6.5 5-10.4 6.1l-58.5 16.7 16.7-58.5c1.1-3.9 3.2-7.5 6.1-10.4zM373.1 25L175.8 222.2c-8.7 8.7-15 19.4-18.3 31.1l-28.6 100c-2.4 8.4-.1 17.4 6.1 23.6s15.2 8.5 23.6 6.1l100-28.6c11.8-3.4 22.5-9.7 31.1-18.3L487 138.9c28.1-28.1 28.1-73.7 0-101.8L474.9 25C446.8-3.1 401.2-3.1 373.1 25zM88 64C39.4 64 0 103.4 0 152V424c0 48.6 39.4 88 88 88H360c48.6 0 88-39.4 88-88V312c0-13.3-10.7-24-24-24s-24 10.7-24 24V424c0 22.1-17.9 40-40 40H88c-22.1 0-40-17.9-40-40V152c0-22.1 17.9-40 40-40H200c13.3 0 24-10.7 24-24s-10.7-24-24-24H88z" }, null, -1 /* HOISTED */);
const _hoisted_3$i = [
  _hoisted_2$o
];

function render$b(_ctx, _cache) {
  return (vue.openBlock(), vue.createElementBlock("svg", _hoisted_1$s, _hoisted_3$i))
}

const script$u = {};


script$u.render = render$b;
script$u.__file = "src/components/icons/Pencil.vue";

const _hoisted_1$r = {
  xmlns: "http://www.w3.org/2000/svg",
  viewBox: "0 0 448 512"
};
const _hoisted_2$n = /*#__PURE__*/vue.createElementVNode("path", { d: "M256 80c0-17.7-14.3-32-32-32s-32 14.3-32 32V224H48c-17.7 0-32 14.3-32 32s14.3 32 32 32H192V432c0 17.7 14.3 32 32 32s32-14.3 32-32V288H400c17.7 0 32-14.3 32-32s-14.3-32-32-32H256V80z" }, null, -1 /* HOISTED */);
const _hoisted_3$h = [
  _hoisted_2$n
];

function render$a(_ctx, _cache) {
  return (vue.openBlock(), vue.createElementBlock("svg", _hoisted_1$r, _hoisted_3$h))
}

const script$t = {};


script$t.render = render$a;
script$t.__file = "src/components/icons/Plus.vue";

const _hoisted_1$q = {
  xmlns: "http://www.w3.org/2000/svg",
  viewBox: "0 0 512 512"
};
const _hoisted_2$m = /*#__PURE__*/vue.createElementVNode("path", { d: "M142.9 142.9c62.2-62.2 162.7-62.5 225.3-1L327 183c-6.9 6.9-8.9 17.2-5.2 26.2s12.5 14.8 22.2 14.8H463.5c0 0 0 0 0 0H472c13.3 0 24-10.7 24-24V72c0-9.7-5.8-18.5-14.8-22.2s-19.3-1.7-26.2 5.2L413.4 96.6c-87.6-86.5-228.7-86.2-315.8 1C73.2 122 55.6 150.7 44.8 181.4c-5.9 16.7 2.9 34.9 19.5 40.8s34.9-2.9 40.8-19.5c7.7-21.8 20.2-42.3 37.8-59.8zM16 312v7.6 .7V440c0 9.7 5.8 18.5 14.8 22.2s19.3 1.7 26.2-5.2l41.6-41.6c87.6 86.5 228.7 86.2 315.8-1c24.4-24.4 42.1-53.1 52.9-83.7c5.9-16.7-2.9-34.9-19.5-40.8s-34.9 2.9-40.8 19.5c-7.7 21.8-20.2 42.3-37.8 59.8c-62.2 62.2-162.7 62.5-225.3 1L185 329c6.9-6.9 8.9-17.2 5.2-26.2s-12.5-14.8-22.2-14.8H48.4h-.7H40c-13.3 0-24 10.7-24 24z" }, null, -1 /* HOISTED */);
const _hoisted_3$g = [
  _hoisted_2$m
];

function render$9(_ctx, _cache) {
  return (vue.openBlock(), vue.createElementBlock("svg", _hoisted_1$q, _hoisted_3$g))
}

const script$s = {};


script$s.render = render$9;
script$s.__file = "src/components/icons/Refresh.vue";

const _hoisted_1$p = {
  xmlns: "http://www.w3.org/2000/svg",
  viewBox: "0 0 448 512"
};
const _hoisted_2$l = /*#__PURE__*/vue.createElementVNode("path", { d: "M170.5 51.6L151.5 80h145l-19-28.4c-1.5-2.2-4-3.6-6.7-3.6H177.1c-2.7 0-5.2 1.3-6.7 3.6zm147-26.6L354.2 80H368h48 8c13.3 0 24 10.7 24 24s-10.7 24-24 24h-8V432c0 44.2-35.8 80-80 80H112c-44.2 0-80-35.8-80-80V128H24c-13.3 0-24-10.7-24-24S10.7 80 24 80h8H80 93.8l36.7-55.1C140.9 9.4 158.4 0 177.1 0h93.7c18.7 0 36.2 9.4 46.6 24.9zM80 128V432c0 17.7 14.3 32 32 32H336c17.7 0 32-14.3 32-32V128H80zm80 64V400c0 8.8-7.2 16-16 16s-16-7.2-16-16V192c0-8.8 7.2-16 16-16s16 7.2 16 16zm80 0V400c0 8.8-7.2 16-16 16s-16-7.2-16-16V192c0-8.8 7.2-16 16-16s16 7.2 16 16zm80 0V400c0 8.8-7.2 16-16 16s-16-7.2-16-16V192c0-8.8 7.2-16 16-16s16 7.2 16 16z" }, null, -1 /* HOISTED */);
const _hoisted_3$f = [
  _hoisted_2$l
];

function render$8(_ctx, _cache) {
  return (vue.openBlock(), vue.createElementBlock("svg", _hoisted_1$p, _hoisted_3$f))
}

const script$r = {};


script$r.render = render$8;
script$r.__file = "src/components/icons/Trash.vue";

const _hoisted_1$o = {
  xmlns: "http://www.w3.org/2000/svg",
  height: "1em",
  viewBox: "0 0 512 512"
};
const _hoisted_2$k = /*#__PURE__*/vue.createElementVNode("path", { d: "M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM184 232H328c13.3 0 24 10.7 24 24s-10.7 24-24 24H184c-13.3 0-24-10.7-24-24s10.7-24 24-24z" }, null, -1 /* HOISTED */);
const _hoisted_3$e = [
  _hoisted_2$k
];

function render$7(_ctx, _cache) {
  return (vue.openBlock(), vue.createElementBlock("svg", _hoisted_1$o, _hoisted_3$e))
}

const script$q = {};


script$q.render = render$7;
script$q.__file = "src/components/icons/MinusCircle.vue";

const _hoisted_1$n = {
  xmlns: "http://www.w3.org/2000/svg",
  height: "1em",
  viewBox: "0 0 512 512"
};
const _hoisted_2$j = /*#__PURE__*/vue.createElementVNode("path", { d: "M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM232 344V280H168c-13.3 0-24-10.7-24-24s10.7-24 24-24h64V168c0-13.3 10.7-24 24-24s24 10.7 24 24v64h64c13.3 0 24 10.7 24 24s-10.7 24-24 24H280v64c0 13.3-10.7 24-24 24s-24-10.7-24-24z" }, null, -1 /* HOISTED */);
const _hoisted_3$d = [
  _hoisted_2$j
];

function render$6(_ctx, _cache) {
  return (vue.openBlock(), vue.createElementBlock("svg", _hoisted_1$n, _hoisted_3$d))
}

const script$p = {};


script$p.render = render$6;
script$p.__file = "src/components/icons/PlusCircle.vue";

var script$o = { 
    components: {  ChevronRightIcon: script$x, ChevronLeftIcon: script$y },
    props:{
      pages: {
        type: Number
      },
      actual: {
        type: Number,
        default: 1
      },
    },
    setup(props, { emit }){
      
      const _actual = vue.ref(props.actual);   
      const _pages = vue.ref(props.pages);   

      vue.watch(_pages, (nil) => {
        console.log('novo pages', nil);
      });

      let hasPrev = vue.computed(() => _actual.value > 1);
      let hasNext = vue.computed(() => _actual.value < _pages.value);
      let pageNums = vue.computed(() => {
        let init =  _pages.value > 5; 
        let ends =  _pages.value > 10; 
        let pg = init && ends && _actual.value > 5 && _actual.value < (_pages.value - 5) ? [_actual.value]:[]; 
        return [ ..._.range(1, ( init ? 5:_pages.value)), ...pg, ..._.range( (ends ? (_pages.value - 5):_pages.value), _pages.value)] 
      });
      
      const prev = () => {
        _actual.value = _actual.value > 1 ? (_actual.value - 1) : _actual.value; 
        console.log(
          'prev', typeof _actual.value , 1
        );
        emit('change', _actual.value);
      };

      const next = () => { 
        console.log(
          'next', _actual.value , _pages.value
        );
        _actual.value = _actual.value < _pages.value ? (_actual.value + 1) : _actual.value; 
      
        emit('change', _actual.value);
      };

      const change = (num) => {
        _actual.value = num;
        emit('change', _actual.value);
      };
           
      return {
        change,
        next,
        prev,
        hasPrev,
        hasNext,
        _,
        _actual,
        _pages,
        pageNums
      }
    },
    mounted(){
      this.$watch('pages', () => {
        this._pages = this.pages;
      }, { immediate: true });
    }
  };

const _hoisted_1$m = { "aria-label": "Page navigation" };
const _hoisted_2$i = { class: "flex justify-center list-style-none" };
const _hoisted_3$c = {
  key: 0,
  class: "page-item"
};
const _hoisted_4$9 = { "aria-hidden": "true" };
const _hoisted_5$4 = ["onClick"];
const _hoisted_6$4 = {
  key: 1,
  class: "page-item"
};
const _hoisted_7$2 = {
  "aria-hidden": "true",
  class: "text-md"
};

function render$5(_ctx, _cache, $props, $setup, $data, $options) {
  const _component_ChevronLeftIcon = vue.resolveComponent("ChevronLeftIcon");
  const _component_ChevronRightIcon = vue.resolveComponent("ChevronRightIcon");

  return (vue.openBlock(), vue.createElementBlock("div", _hoisted_1$m, [
    vue.createElementVNode("ul", _hoisted_2$i, [
      ($setup.hasPrev)
        ? (vue.openBlock(), vue.createElementBlock("li", _hoisted_3$c, [
            vue.createElementVNode("a", {
              class: "page-link relative block py-1.5 px-3 rounded border-0 bg-transparent outline-none transition-all duration-300 rounded text-gray-800 hover:text-gray-800 focus:shadow-none cursor-pointer",
              "aria-label": "Previous",
              onClick: _cache[0] || (_cache[0] = vue.withModifiers((...args) => ($setup.prev && $setup.prev(...args)), ["prevent"]))
            }, [
              vue.createElementVNode("span", _hoisted_4$9, [
                vue.createVNode(_component_ChevronLeftIcon, {
                  class: "h-6 w-6",
                  "aria-hidden": "true"
                })
              ])
            ])
          ]))
        : vue.createCommentVNode("v-if", true),
      (vue.openBlock(true), vue.createElementBlock(vue.Fragment, null, vue.renderList($setup.pageNums, (i) => {
        return (vue.openBlock(), vue.createElementBlock("li", {
          class: vue.normalizeClass(["page-item", { 'active': $setup._actual === i }]),
          key: i
        }, [
          vue.createElementVNode("a", {
            class: vue.normalizeClass(["page-link relative block py-1.5 px-3 rounded border-0 outline-none transition-all duration-300 rounded hover:text-gray-800 hover:bg-gray-200 focus:shadow-none cursor-pointer", { 'bg-blue-600 text-white ': $setup._actual === i, 'bg-transparent text-teal-900': $setup._actual != i }]),
            onClick: vue.withModifiers(() => $setup.change(i), ["prevent"])
          }, vue.toDisplayString(i), 11 /* TEXT, CLASS, PROPS */, _hoisted_5$4)
        ], 2 /* CLASS */))
      }), 128 /* KEYED_FRAGMENT */)),
      ($setup.hasNext)
        ? (vue.openBlock(), vue.createElementBlock("li", _hoisted_6$4, [
            vue.createElementVNode("a", {
              class: "page-link relative block py-1.5 px-3 rounded border-0 bg-transparent outline-none transition-all duration-300 rounded text-gray-800 hover:text-gray-800 hover:bg-gray-200 focus:shadow-none cursor-pointer",
              "aria-label": "Next",
              onClick: _cache[1] || (_cache[1] = vue.withModifiers((...args) => ($setup.next && $setup.next(...args)), ["prevent"]))
            }, [
              vue.createElementVNode("span", _hoisted_7$2, [
                vue.createVNode(_component_ChevronRightIcon, {
                  class: "h-6 w-6",
                  "aria-hidden": "true"
                })
              ])
            ])
          ]))
        : vue.createCommentVNode("v-if", true)
    ])
  ]))
}

script$o.render = render$5;
script$o.__file = "src/components/common/Pagination.vue";

var script$n = {
    props:['data', 'cell'],
    data(){ return {
        formopen: false,
        pic: false
    }},
    methods: {
        replaceByDefault(e) {
            e.target.src = '';
        },
        showModal(item){ 
           this.$emit("click", this.data);
           this.pic = item;
           this.formopen = true;
        }
    }
};

const _hoisted_1$l = ["src"];
const _hoisted_2$h = {
  key: 0,
  class: "modal fixed w-full h-full bg-black/20 left-0 top-0"
};
const _hoisted_3$b = { class: "absolute -translate-x-1/2 left-1/2 bg-white p-4 rounded-lg my-2 text center" };
const _hoisted_4$8 = ["src"];

function render$4(_ctx, _cache, $props, $setup, $data, $options) {
  return (vue.openBlock(), vue.createElementBlock("div", null, [
    vue.createElementVNode("img", {
      onClick: _cache[0] || (_cache[0] = $event => ($options.showModal($props.data))),
      src: $props.data,
      style: {"height":"30px","width":"auto"},
      onError: _cache[1] || (_cache[1] = (...args) => ($options.replaceByDefault && $options.replaceByDefault(...args)))
    }, null, 40 /* PROPS, HYDRATE_EVENTS */, _hoisted_1$l),
    ($data.formopen)
      ? (vue.openBlock(), vue.createElementBlock("div", _hoisted_2$h, [
          vue.createElementVNode("div", _hoisted_3$b, [
            vue.createElementVNode("button", {
              onClick: _cache[2] || (_cache[2] = e => $data.formopen = false),
              class: "absolute right-0 top-0"
            }, "âœ–"),
            vue.createElementVNode("img", { src: $data.pic }, null, 8 /* PROPS */, _hoisted_4$8)
          ])
        ]))
      : vue.createCommentVNode("v-if", true)
  ]))
}

script$n.render = render$4;
script$n.__file = "src/components/tables/image.vue";

var script$m = {
    props:['data', 'cell'],
    data(){ return {
        valid: true,
        model: []
    }},
    mounted () {
      this.checkFormat(this.data);
    },
    methods:{
        checkFormat(data){
            if( data === null || data === undefined) 
            this.model = [];
            if( Array.isArray(data) ){
            this.valid = true;
            this.model = data;
            }else if( typeof data == 'string' && data.includes('[') ){
                try {
                    this.model = JSON.parse(data);
                    this.valid = true;
                } catch (e) {
                    this.valid = false;
                }
            }else {
                this.valid = false;
            }
        }
    }
};

const _hoisted_1$k = { key: 0 };
const _hoisted_2$g = { key: 1 };

function render$3(_ctx, _cache, $props, $setup, $data, $options) {
  return (vue.openBlock(), vue.createElementBlock("span", null, [
    ($data.valid)
      ? (vue.openBlock(), vue.createElementBlock("span", _hoisted_1$k, vue.toDisplayString($data.model && $data.model.join(', ')), 1 /* TEXT */))
      : (vue.openBlock(), vue.createElementBlock("span", _hoisted_2$g, "Invalid data array"))
  ]))
}

script$m.render = render$3;
script$m.__file = "src/components/tables/tags.vue";

var script$l = {
    props:['data', 'cell', 'row'],
    methods: {
        replaceContent() {
            if( this.cell?.action?.label ) 
                return _.template(this.cell.action.label)({data: this.data, action: this.cell.action, row: this.row  })
            else
                return this.data
        }
    }
};

const _hoisted_1$j = ["href", "target", "innerHTML"];

function render$2(_ctx, _cache, $props, $setup, $data, $options) {
  return (vue.openBlock(), vue.createElementBlock("a", {
    href: $props.cell?.action?.handler,
    target: ($props.cell?.action?.target ?? '_self'),
    innerHTML: $options.replaceContent()
  }, null, 8 /* PROPS */, _hoisted_1$j))
}

script$l.render = render$2;
script$l.__file = "src/components/tables/link.vue";

const _hoisted_1$i = ["innerHTML"];
  
  
var script$k = {
  __name: 'expression',
  props: ['data', 'cell', 'row'],
  setup(__props) {

const props = __props;
 
  const { template, get } = _;
  
  const { data, cell, row } = props;
  vue.computed(e => { 
      let compiled = _.template(_.get(cell, 'action.template', '${data}'));
      return compiled({data, cell, row}) 
  });

return (_ctx, _cache) => {
  return (vue.openBlock(), vue.createElementBlock("span", {
    innerHTML: vue.unref(template)( vue.unref(get)(vue.unref(cell), 'action.template', '${data}') )(props)
  }, null, 8 /* PROPS */, _hoisted_1$i))
}
}

};

script$k.__file = "src/components/tables/expression.vue";

const { has: has$1, sortBy, get: get$1, isNil: isNil$1, isObject, omit, isEqual, capitalize, round } = _;
 

const mergeDeep  = (a = {}, b = {}) => {
    return deepmerge(a, b, {
        arrayMerge: (d, s) => {
            return [ ...d, ...s ]
        }
    })
};

const getErrorMessage = (error) => {
    if(error){
        if( get$1(error, 'code', '') == "ECONNREFUSED" ){
            return error.message + "( " + get$1(error, 'config.url') + ")"
        }

        if( has$1(error, 'response.data.message') )
            return get$1(error, 'response.data.message')

        if( get$1(error, 'message') )
            return get$1(error, 'message')

        if( typeof error == 'string' )
            return error
    }
    return ""
};

const toRaw = (model) => {
  return JSON.parse( JSON.stringify(model) )
};
 
const formatDate = function(value, format, from, utc=false) {
    if (value) {
      let date = moment(String(value), from);
      // console.log('formatDate', value, date)
      if(utc) date = date.utc();
      return date.format(format)
    }
};

const interpolate = (string, scope, def) => {
    if( typeof string !== 'string' ) return string; 

    return string.replace(/\{([^}]*)}/g, (r,k) => get$1(scope, k, (def ? def:'{'+k+'}')) );
};

const queryString = (params, join, data) => {
    let rtn = '';
    let arrQuery = [];
    if( isObject(params) && Object.keys(params).length > 0 ){
        Object.keys(params).map(k => {
            if( Array.isArray(params[k]) )
                params[k].map(i => arrQuery.push([ interpolate(k, data), interpolate(i, data)]) );
            else
                arrQuery.push([interpolate(k, data), interpolate(params[k], data)]);
        });

        rtn = join+new URLSearchParams( arrQuery );
    }
    return rtn
};

const filterParams = (api, queryInfo) => { 
    let { page, pageSize, sort, filters } = queryInfo || {};
    let { params = {}, pagination = {} } = api || {};
    if( !isNil$1(page) && has$1(pagination, 'pageField') )
        params[ pagination.pageField || 'page' ] = page;
    if( !isNil$1(pageSize) && has$1(pagination, 'limitField') )
        params[ pagination.limitField || 'limit'] = pageSize;
    if( sort && !isNil$1(sort.prop) && !isNil$1(sort.order) && has$1(pagination, 'sortField') && has$1(pagination, 'sortExp') ){
        let pagData = {prop: sort.prop, sort: sort.order == 'ascending'? get$1(pagination,'sortAscChar','asc'): get$1(pagination, 'sortDescChar', 'desc')};
        params[ pagination.sortField || 'order' ] = interpolate( get$1(pagination, 'sortExp', '{prop},{order}'), pagData);
    }

    if( get$1(queryInfo, 'filters', []).length > 0 ){
      for(let i = 0; i < get$1(queryInfo, 'filters', []).length; i++ ){  
        let filterField = interpolate(
          get$1(filters[i], 'filterField', (pagination?.filterField || 'filter')), 
          get$1(filters, '[0]', {}) 
        );
        let filterExp = get$1(filters[i], 'filterExp', (pagination?.filterExp || '{prop},like,%{value}%'));
        if ( !params[filterField] ) params[ filterField ] = [];
        if( has$1(filters, `[${i}].prop`) && has$1(filters, `[${i}].value`) && filters[i].value && has$1(pagination, 'filterField') && (has$1(pagination, 'filterExp') || has$1(filters[i], 'filterExp')) )
            params[ filterField ].push( interpolate(filterExp, filters[i]) );
      }
    }else if( has$1(pagination, 'filterField') ){
      let filterField = interpolate(
        get$1(pagination, 'filterField', 'filter'), 
        get$1(filters, '[0]', {}) 
      );
      delete params[ filterField ];
    }
    console.log('filter params', params);
    return {...api, params};
};
  
// const isRegex = (data, reg, custom=false) => {
//     let rgs ={
//         url: "^(http[s]?:\\/\\/(www\\.)?|ftp:\\/\\/(www\\.)?|www\\.)"
//     }
//     if( !rgs[reg] && !custom ) return ;

//     var regex = new RegExp( rgs[reg] || reg );

//     console.debug('isRegex', rgs[reg], data, regex.test(data))
//     return regex.test(data)
// }  


///
// TABLES
//

const schemaColumns = (properties) => {
  // let columns = [ { label: '', key: "_selected", filter: false, sorter:false, sort: -1 } ]
  let columns = [  ];
  let extractdata = (col = {}, k) =>  {
      if( col.children && Array.isArray(col.children) )  col.children.map( i => extractdata(i, k));
      if( get$1(col, 'config.grid', false) )
          columns.push({
              sort: get$1(col, 'config.sort', k+1),
              key: get$1(col, 'name', col.id),
              label: get$1(col, 'config.label', capitalize((col.label || col.name))),
              type: get$1(col, 'config.type', (col.type || 'text')),
              action: Object.assign( get$1(col, 'config.action',{}), get$1(col, 'attributes', {}) ),
              options: get$1(col, 'options', {}),
              model: get$1(col, 'model', {}),
              overwrite: get$1(col, 'overwrite', {}),
              sorter: get$1(col, 'config.sorter', true),
              filter: get$1(col, 'config.filter', true),
              _classes: get$1(col, 'config.classes'),
              _style: get$1(col, 'config.styles'),
          });
  };
  properties.map((col, k) => {
          extractdata(col, k);
  });
 

  return sortBy(columns, ['sort'])
};

const can = (schema, attr, def = true) => {
  return get$1(schema, attr, def)
};

const isSelected = (rows, row) => {
    return rows.findIndex(i => _.isEqual(i, row) ) >= 0
};

const selectionChange = (rows, row, index) => {
    let key = rows.findIndex(i => isEqual(i, row) );
    if( key >= 0 )   
      rows.splice(key, 1);
    else
      rows.push(row);
    return rows
};

const selectionAll = (rows, data) =>{
  if( rows.length == data.length ){
    rows = [];
  }else
    rows = data;
  return rows
};

const fetchQueryInfo = (type, data) => {
  console.debug("fetch query info", type, data);
  let queryInfo = { type };
  if( type == 'sort' ){
    queryInfo.sort = { prop: data.column, order: data.asc === true ? 'ascending':'descending' };
  }
  if( type == 'filter' ){
    queryInfo.filters = Object.keys(data).map((key) => ({ 
      prop: key, value: data[key]?.value, filterExp: data[key]?.filter?.filterExp, filterField: data[key]?.filter?.filterField
    }));
  }
  if( type == 'page' ){
    queryInfo.page = data;
  }
  if( type == 'pageSize' ){
    queryInfo.pageSize = data;
  }
  
 return queryInfo
};

const validateQueryInfo = (queryInfo) => { 
  if( !queryInfo || typeof queryInfo !== 'object' ) return false;
  
  if( ['sizeChange', 'pageSize', 'size', 'pageChange', 'sort', 'filter', 'page', 'init'].includes(queryInfo.type) ){
      if( queryInfo.type == 'filter' &&  !get$1(queryInfo, 'filters[0].prop')  )
          return false;
  }

  return true
};

const calcPages = (totalRows, perPage) => {
  let count = (totalRows || 1) / perPage;
  let rounded = round(count);
  return count > rounded ? rounded + 1 : rounded
};

const normalizeInput = async (row, modifier) => {  
  if( typeof row == 'string' ) return row

  if( row.children && Array.isArray(row.children) )
    for(let idx in row.children){ 
      row.children[idx] = await normalizeInput(row.children[idx], modifier);
    }  

  if( row['$el'] ) return row

  let input = {
    ...row,
    label: _.get(row, 'label', _.capitalize(row?.name ?? '')),
    placeholder: _.get(row, 'placeholder', _.capitalize(row?.name ?? '')),
  };
  if( input['type'] || (!input['$cmp'] && !input['$el'] && !input['type']) ) input['$formkit'] = input.type || 'text';
 
  if( modifier && typeof modifier == 'function') input = await modifier(input);

  return input
};

// FORMS

const schemaFields = (properties) => {
  // let columns = [ { label: '', key: "_selected", filter: false, sorter:false, sort: -1 } ]
  let columns = [  ];
  let extractdata = (col = {}, k) =>  {
      if( col.children && Array.isArray(col.children) )  col.children.map( i => extractdata(i, k));
      if( get$1(col, 'name', false) )
          columns.push({
              sort: get$1(col, 'config.sort', k+1),
              key: get$1(col, 'name', col.id),
              ignored: get$1(col, 'ignore', false),
              label: get$1(col, 'config.label', capitalize((col.label || col.name))),
              type: get$1(col, 'config.type', (col.type || 'text')),
              action: Object.assign( get$1(col, 'config.action',{}), get$1(col, 'attributes', {}) ),
              options: get$1(col, 'options', []),
              model: get$1(col, 'model', {}),
              overwrite: get$1(col, 'overwrite', {}),
              sorter: get$1(col, 'config.sorter', true),
              filter: get$1(col, 'config.filter', true),
              _classes: get$1(col, 'config.classes'),
              _style: get$1(col, 'config.styles'),
          });
  };
  properties.map((col, k) => {
          extractdata(col, k);
  });

  // columns.push({ label: '', key: 'actions', filter: false, sorter: false })

  return sortBy(columns, ['sort'])
};

const { get, set, has, isNil, isEmpty } = _;

var ResourceClass = ({ $axios,  }) => {
  let modelUrl = null;
  let config = {};
  let model = {};
  let schema = [];
  let session = {};
  let sorter = null;
  // table
  let rows = {};
  let total = 1;
 
  // Schema 
  const setConfig = (input) =>{
    config = input;
  };

  const setModel = (modelObj={}) => {
    model = JSON.parse(JSON.stringify(modelObj));
    schema = model.properties;
    config = config?.domain ? config : _.pick(model, ['auth','domain','type','primaryKey']);
  };

  const getModel = () => {
    return model
  };

  const loadModel = (url, options = {}) => {
    return $axios.get(url, options).then(({data}) => {
        console.debug("loadModel "+url, data);
        if( !data ) throw { message: "Model Load error" }

        model = JSON.parse(JSON.stringify(data));
        schema = model.properties;
        return model
    })
  };

  const loadModelByUrl = async (path='', file) => {
    try {
      modelUrl = `/models/${path}${file}`;
      let { data } = await $axios.get(modelUrl);
      if( !data.domain )
        throw { message:'Model load error' }

      model = data;

      return data
    } catch (error) {
      console.error("loadModelByUrl", error);
      return false
    }
  };

  const can = (perm) => {
    if( perm == 'getData' ){
      return get(model, 'api.getData', true)
    }
    if( perm == 'getDataById' ){
      return get(model, 'api.getData', true)
    } 
    if( perm == 'deleteDataById' ){
      return get(model, 'api.deleteDataById', true)
    } 
    if( perm == 'paginate' ){
      return has(model, 'api.pagination.pageField', false)
    } 

    return true
  };

  const isIt = (perm) => {
    if( perm == 'local' ){
      return get(model, 'api.pagination.local', false)
    } 
    if( perm == 'sorter' ){
      return sorter
    }
    if( perm == 'logged' ){
      return get(model, 'auth', false)
    }
    return false
  };

  // Data
  const setData = (resource, filters) => { 
    console.log('setData', resource, filters);
    let data = resource;
    let isRow = has(data, `[${model.primaryKey || 'id'}]`) || model.type == 'form';
    let api = get(model, 'api', {}); 

    if( isRow ){
      return ( !isNil(api.wrapDataById) ? get(data, api.wrapDataById, data): data)
    }else {
      rows = ( !isNil(api.wrapData) ? get(data, api.wrapData, data): data);
      total = ( !isNil(api.totalData) ? get(data, api.totalData, rows.length): rows.length );

      if( !Array.isArray(rows) ) rows = [rows];
      if( typeof total !== 'number' ) total = rows.length;

      if( filters?.filters && Array.isArray(filters?.filters) && filters?.filters?.length > 0 ){
        rows = filterLocal(filters.filters);
        total = rows.length;
      }

      if( !filters?.sort )
        filters.sort = getSchemaSort();
      if( filters?.sort )
        rows = sortLocal(filters.sort);
 
      return {
        rows,
        total
      }
    }
  };

  const getData = (data={}, config={}) => {
    console.log("called get data", data, config);
    let { api = {} } = model;
    if( api.resource && isEmpty(data.data) ) data.data = api.resource;
    let primaryKey = (model?.primaryKey || 'id');

    let url = '';
    let isRow = has(data, `[${model.primaryKey || 'id'}]`) || model.type == 'form';
    let options = {
      method: ( isRow ? ( isNil(api.methodGetById) ? 'GET':api.methodGetById) : (isNil(api.methodGet) ? 'GET':api.methodGet) ),
      ...config
    }; 
    let sessionConfig = {
      session: model.auth
    };

    let query = queryString(api.params, ( api.rootApi.includes('?') ? '&':'?'), data);

    if( isRow )
      url = `${api.rootApi}${ isNil(api.urlGetById) ? '/{'+primaryKey+'}{query}': api.urlGetById }`;
    else
      url = `${api.rootApi}${ isNil(api.urlGet) ? '{query}': api.urlGet }`;

    if( api.headers )
      options['headers'] = api.headers;
    
    url = interpolate(url, {...data, query });
  
    // console.debug('get data', url, options, sessionConfig)
    return $axios(url, options, sessionConfig)
    .then( data => {  
      data = sessionConfig.wrap === false ? data : data.data;

      if( isRow ){
        return ( !isNil(api.wrapDataById) ? get(data, api.wrapDataById, data): data)
      }else {
        rows = ( !isNil(api.wrapData) ? get(data, api.wrapData, data): data);
        total = ( !isNil(api.totalData) ? get(data, api.totalData, rows.length): rows.length );

        if( !Array.isArray(rows) ) rows = [rows];
        if( typeof total !== 'number' ) total = rows.length;
  
        return {
          rows,
          total
        }
      }
    })
  };
  
  const getDataObject = (data={}, config={}) => { 
    let { api = {} } = model;
    if( api.resource && isEmpty(data.data) ) data.data = api.resource;
 
    let url = '';
    let options = {
      method:  isNil(api.methodGet) ? 'GET': api.methodGet,
      ...config
    }; 
    let sessionConfig = {
      session: model.auth
    };

    let query = queryString(api.params, ( api.rootApi.includes('?') ? '&':'?'), data);
  
    url = `${api.rootApi}${ isNil(api.urlGet) ? '{query}':api.urlGet }`;

    if( api.headers )
      options['headers'] = api.headers;
    
    url = interpolate(url, {...data, query });
    
    console.debug('get data object', url, options, sessionConfig);
    return $axios(url, options, sessionConfig)
        .then(({data}) => {   
          return ( !isNil(api.wrapData) ? get(data, api.wrapData, data): data) 
        })
  };
    
  const saveData = async (data, config={}) => { 
    let { api = {} } = model; 
    let resource = api.resource || {};
    let url = '';
    let primaryKey = (isNil(model.primaryKey) ? 'id':model.primaryKey);
    let method = data[primaryKey] ? (isNil(api.methodPatch) ? "PUT":api.methodPatch) : (isNil(api.methodPost) ? "POST":api.methodPost);
    let query = interpolate( 
      queryString(api.params, (api.rootApi.includes('?') ? '&':'?')),  
      { ...data, data: resource }
    );
    let sessionConfig = {
      session: model.auth
    };
  
    if( has(data, primaryKey) && !isNil(data[primaryKey]) )
      url = `${api.rootApi}${ isNil(api.urlPatch) ? '/{id}':api.urlPatch }`;
    else
      url = `${api.rootApi}${ isNil(api.urlPost) ? '': api.urlPost}`;

    console.log("saveData interpolate date", url, {...data, query}, api.resource);
    url = interpolate(url, {...data, query, data: resource});

    let options = {
      method,
      data,
      ...config
    };
    if( api.headers )
      options['headers'] = api.headers;
    
    return $axios(url, options, sessionConfig)
  };

  const deleteData = async (data, config={}) => {
    let { api={} } = model;
    if( api?.resource && isEmpty(data.data) ) data.data = api.resource;
    
    let primaryKey = (model?.primaryKey || 'id');

    if( !has(data, primaryKey) ) return Promise.reject('Id not found')

    let sessionConfig = {
      session: model?.auth
    };
    
    let method = ( isNil(api.methodDelete) ? "DELETE":api.methodDelete );
    let query = interpolate( 
      queryString(api.params, (api.rootApi.includes('?') ? '&':'?')),  
      data
    );
    let url = `${api.rootApi}${ isNil(api.urlDelete) ? '/{id}':api.urlDelete }`;
      
    url = interpolate(url, {...data, query});

    let options = {
      method,
      ...config
    };
    if( api.headers )
      options['headers'] = api.headers;
    
    return $axios(url, options, sessionConfig)
  };

  // Fitlers
  const getSchemaSort = () => {
    return schema.reduce( (pv, i) => {
      if( _.has(i, 'config.sorter') && typeof i.config.sorter == 'string' ){ 
        pv = { prop:i.name, order:i.config.sorter };
      }
      return pv
    }, ({}))
  };

  const paginate = ({ local = false, perPage = 5, page = 1 }) => { 
    console.debug('paginate', rows.length, ((perPage * page) - perPage), (perPage * page));
    if( !local ) return rows
    return  [...rows].slice( ((perPage * page) - perPage), (perPage * page))
  };

  const sorting = ({ local, col, order }) => {
    if( !local ) return rows
    return _.orderBy(rows, col. order)
  };

  const filterLocal = (filters = []) => { 
    return rows.filter(
      (row) => {
        return filters.some(i => String(row[i.prop]).includes(String(i.value)) )
      }
    )
  };

  const sortLocal = (filters) => { 
    console.debug('sortLocal', filters);
    if( !filters || !filters.prop ) return rows

    let sorted = _.sortBy(rows, [filters.prop]);
    sorter = filters.prop;
    if( filters.order === 'descending' ) sorted.reverse();
    return sorted
  };

  // AUTH
  const getSession = () => {
    return session
  };

  const authenticate = ({username, secret, remember}) => {
    try{  
      console.debug('store login'); 

      if( !has(config, 'auth.url_login') ) 
        throw new Error('url login doest exist');
      let input = {
        [get(config, 'auth.field_username', 'email')]: username,
        [get(config, 'auth.field_secret', 'password')]: secret, 
      };
      if( has(config, 'auth.field_remember') )
        input[get(config, 'auth.field_remember', 'remember')] = remember;

      return $axios({
              url: get(config, 'auth.url_login'),
              method: get(config, 'auth.url_method', 'post'),
              data: input,
              headers: get(config, 'api.headers', {}) 
            })
      .then(async (res) => {
          let token = setToken(res);
          let reqAuthData = authRequest(token);
          let user = setUser(res.data);
          session = { request: reqAuthData, logged: true, token, user }; 
          return { token, request: reqAuthData, user, logged: true  }
      })
    }catch(e){ 
      console.error('Resource > authenticate error', e);
      return Promise.reject(e)
    }
  };

  const checkAuth = (force = false) => {
    try{   
      console.debug('Resource > checkAuth start');
      let cfg = _.get(config, 'auth', {});
      let token = getToken(); 
      //Check active session
      if( !token )
        return Promise.reject({message: 'Token not exits'})

      if( _.get(session,'logged') && !force )
        return Promise.resolve(session)

      if( !_.has(cfg, 'logged_url') ){
        return Promise.reject({message: 'Logged url not found'})
      }
      
      let reqAuthData = authRequest(token);
      let url = interpolate( _.get(cfg, 'logged_url'), session);
      
      let options = { 
        url, 
        method: _.get(cfg, 'logged_method', 'get'), 
        ...reqAuthData  
      };

      return $axios(options).then((res) => {
          let user = setUser(res.data);
          
          session = { user, request: reqAuthData, logged: true, token };
          return { token, user, request: reqAuthData, logged: true }
      })
    }catch(e){
      logout();
      console.error('Resource > checkAuth error', e);
      return Promise.reject({message: e.message})
    }
  };

  const getToken = () => { 
    return sessionStorage.getItem(`${_.get(config, 'domain', 'default')}_session`)
  };

  const removeToken = () => { 
    return sessionStorage.removeItem(`${_.get(config, 'domain', 'default')}_session`)
  };

  const setToken = ({data, headers}) => {
    let token = null; 

    let cfg = _.get(config, 'auth', {});
    if( _.get(cfg, 'response_mode', 'body') === 'header' ){
      token = headers[ _.get(cfg, 'response_token', 'access-token') ];
    }else {
      token = _.get(data, _.get(cfg, 'response_token', 'access_token'), null);
    } 

    if( !token ) {
      return new Error ({message: 'token not found', config: cfg, data, headers})
    }

    sessionStorage.setItem(`${_.get(config, 'domain', 'default')}_session`, token);
    return token
  };

  const authRequest = (token) => { 
    let cfg = _.get(config, 'auth', {});

    let tokenRequest = get(cfg, 'request_token_expression', '{token}');
    if( _.get(cfg, 'request_mode', 'header') == 'query' )
      return { 
        headers: _.get(config, 'api.headers', {}),
        params:{
          [_.get(cfg, 'request_token', 'access-token')] : interpolate(tokenRequest, {token})
        }
      } 
    else 
      return {
        headers:{
          ..._.get(config, 'api.headers', {}),
          [_.get(cfg, 'request_token', 'access-token')] : interpolate(tokenRequest, {token})
        }
      }
  };
  
  const setUser = (data) => { 
    let cfg = _.get(config, 'auth', {});
    if( !_.has(cfg, 'logged_model') ) return {};

    let { id, name, username, role } = _.get(cfg, 'logged_model');
    let content = _.get(data, _.get(cfg, 'logged_wrap'), data);
    let user = {
      "id": _.get(content, id, "id"),
      "name": _.get(content, name, "name"),
      "username": _.get(content, username, "email"),
      "role": _.get(content, role, "level")
    };

    return user;
  };

  const logout = async (ctx) => {
    _.get(config, 'auth', {});

    let auth = { logged: false };
    let token = getToken();
    console.log("dispatched logout", token);
    if( token ){   
      removeToken();
    }
    session = auth; 
    return auth
  };

  return {
    // Schema
    loadModel,
    loadModelByUrl,
    setModel,
    getModel,
    can,
    isIt,
    // Data
    setConfig,
    getData,
    setData,
    getDataObject,
    saveData,
    deleteData,
    paginate,
    sorting,
    getSchemaSort,
    // Auth
    getSession,
    getToken,
    setToken,
    authRequest,
    authenticate,
    checkAuth,
    logout,
  }
};

const _hoisted_1$h = ["value"];
const _hoisted_2$f = ["value"];

  
var script$j = {
  __name: 'select',
  props: ['data','cell','row'],
  setup(__props) {

const { data, cell, row } = __props;
 
  
  const Instance = ResourceClass({ $axios:axios });
  const renderComponent = vue.ref(false);
  const loading = vue.ref(false);
  const options = vue.ref([]);
 
  function forceRerender() {
    renderComponent.value = false;

    vue.nextTick(() => {
      renderComponent.value = true;
    });
  }

  async function getOptions({ rootApi, fieldLabel, fieldValue, ...apiModel }, modelValue = {}, filter={}){
    try{ 
      // console.debug("input mixin get options", { rootApi, fieldLabel, fieldValue, ...data })
      if( rootApi ){
        loading.value = true;
        let request = Instance.authRequest( Instance.getToken() );
        apiModel = mergeDeep(apiModel, request);
        if( typeof filter == 'object' )
          apiModel = mergeDeep(apiModel, filter);

        rootApi = interpolate(rootApi, { data:modelValue, row });

        Instance.setModel({ api: { ...apiModel, rootApi, resource:row } });

        // console.log("getOoptions", this.Instance.getModel())
        let { rows } = await Instance.getData({ data:modelValue }); 

        options.value = rows && rows.map((i, k) => ({ 
            label: _.get(i, fieldLabel, i.toString()), 
            value: _.get(i, fieldValue, k)
          }) 
        );
        
        loading.value = false;
        forceRerender();
        return options.value
      }
    }catch(e){
        alert('Erro to get data from '+ rootApi);
        console.error('Erro select input', e);
        return options.value
    }
  } 
    
  vue.onMounted(async () => {
    let { action, model } = cell;
    Instance.setModel(toRaw(model));

    if( _.has(model, 'api.rootApi') )
      cell.options = await getOptions(
          Object.assign(model.api, action), 
          data, 
          filterParams(model.api, { filters:[{prop: action.fieldValue, value:data }] }) 
      );

    renderComponent.value = true;
  }); 

return (_ctx, _cache) => {
  return (renderComponent.value)
    ? (vue.openBlock(), vue.createElementBlock("select", {
        key: 0,
        class: "table-select",
        value: __props.data,
        disabled: ""
      }, [
        vue.createCommentVNode(" v-on=\"$listeners\" "),
        (vue.openBlock(true), vue.createElementBlock(vue.Fragment, null, vue.renderList((__props.cell.options || options.value), (opt, idx) => {
          return (vue.openBlock(), vue.createElementBlock("option", {
            key: idx,
            value: opt.value
          }, vue.toDisplayString(opt.label), 9 /* TEXT, PROPS */, _hoisted_2$f))
        }), 128 /* KEYED_FRAGMENT */))
      ], 8 /* PROPS */, _hoisted_1$h))
    : vue.createCommentVNode("v-if", true)
}
}

};

script$j.__file = "src/components/tables/select.vue";

const _hoisted_1$g = {
  key: 0,
  class: "font-semibold text-xs mr-1"
};
const _hoisted_2$e = {
  key: 1,
  class: "font-semibold text-xs ml-1"
};
  
var script$i = {
  __name: 'toggle',
  props: ['data', 'cell', 'row'],
  setup(__props) {

const { data, cell, row } = __props;
 
    
  const model = vue.ref(row ?? false);

return (_ctx, _cache) => {
  return (vue.openBlock(), vue.createElementBlock("div", {
    class: vue.normalizeClass(["flex items-center cursor-pointer py-2", ['cursor-not-allowed']])
  }, [
    (!model.value)
      ? (vue.openBlock(), vue.createElementBlock("span", _hoisted_1$g, " Off "))
      : vue.createCommentVNode("v-if", true),
    vue.createElementVNode("div", {
      class: vue.normalizeClass(["rounded-full w-10 h-6 p-0.5 bg-gray-300", {'bg-red-500': !model.value,'bg-green-500': model.value}])
    }, [
      vue.createElementVNode("div", {
        class: vue.normalizeClass(["rounded-full w-5 h-5 bg-white transform mx-auto duration-300 ease-in-out", {'-translate-x-2': !model.value,'translate-x-2': model.value}])
      }, null, 2 /* CLASS */)
    ], 2 /* CLASS */),
    (model.value)
      ? (vue.openBlock(), vue.createElementBlock("span", _hoisted_2$e, " On "))
      : vue.createCommentVNode("v-if", true)
  ]))
}
}

};

script$i.__file = "src/components/tables/toggle.vue";

const _hoisted_1$f = { class: "whitespace-nowrap" };
  
var script$h = {
  __name: 'dates',
  props: ['data', 'cell', 'row'],
  setup(__props) {

  
    

return (_ctx, _cache) => {
  return (vue.openBlock(), vue.createElementBlock("div", _hoisted_1$f, vue.toDisplayString(vue.unref(formatDate)(__props.data, __props.cell?.action?.format || 'MM/DD/YYYY hh:mm', __props.cell?.action?.from || null, __props.cell?.action?.utc || false)), 1 /* TEXT */))
}
}

};

script$h.__file = "src/components/tables/dates.vue";

const _hoisted_1$e = ["textContent"];
const _hoisted_2$d = ["innerHTML"];
const _hoisted_3$a = ["textContent"];
// import Actions from './action'
// import BelongsTo from './belongsTo'

var script$g = {
  __name: 'index',
  props: ['data','cell'],
  setup(__props) {

const { data, cell } = __props;
  
const { get } = _;
  
vue.computed(() => {
    return get(cell, 'click.type', 'link')
});  

function emitAction(){
    // if( this.cell.type == 'action' || !this.cell.action || !this.cell.action.event || this.cell.action.event != 'click' ) 
    //     return;

    // this.$bus.$emit(this.cell.action?.handler, this.sendType(this.cell, this.data, this.data[this.cell.key]) )
    // console.log("chamado event", this.cell)
}

return (_ctx, _cache) => {
  const _component_CommonsFragment = vue.resolveComponent("CommonsFragment");

  return (__props.cell.type == 'tags')
    ? (vue.openBlock(), vue.createBlock(_component_CommonsFragment, { key: 0 }, {
        default: vue.withCtx(() => [
          vue.createVNode(script$m, {
            data: __props.data[__props.cell.key],
            cell: __props.cell,
            row: __props.data,
            onClick: emitAction
          }, null, 8 /* PROPS */, ["data", "cell", "row"])
        ]),
        _: 1 /* STABLE */
      }))
    : (__props.cell.type == 'image')
      ? (vue.openBlock(), vue.createBlock(_component_CommonsFragment, { key: 1 }, {
          default: vue.withCtx(() => [
            vue.createVNode(script$n, {
              data: __props.data[__props.cell.key],
              cell: __props.cell,
              row: __props.data,
              onClick: emitAction
            }, null, 8 /* PROPS */, ["data", "cell", "row"])
          ]),
          _: 1 /* STABLE */
        }))
      : (__props.cell.type == 'switch' || __props.cell.type == 'toggle')
        ? (vue.openBlock(), vue.createBlock(_component_CommonsFragment, { key: 2 }, {
            default: vue.withCtx(() => [
              vue.createVNode(script$i, {
                data: __props.data[__props.cell.key],
                cell: __props.cell,
                row: __props.data,
                onClick: emitAction
              }, null, 8 /* PROPS */, ["data", "cell", "row"])
            ]),
            _: 1 /* STABLE */
          }))
        : (__props.cell.type == 'select' || __props.cell.type == 'autocomplete' || __props.cell.type == 'dynamic')
          ? (vue.openBlock(), vue.createBlock(_component_CommonsFragment, {
              key: 3,
              onClick: emitAction
            }, {
              default: vue.withCtx(() => [
                vue.createVNode(script$j, {
                  data: __props.data[__props.cell.key],
                  cell: __props.cell,
                  row: __props.data,
                  onClick: emitAction
                }, null, 8 /* PROPS */, ["data", "cell", "row"])
              ]),
              _: 1 /* STABLE */
            }))
          : (__props.cell.type == 'link')
            ? (vue.openBlock(), vue.createElementBlock(vue.Fragment, { key: 4 }, [
                vue.createCommentVNode(" <span v-else-if=\"cell.type == 'belongsTo'\">\r\n        <BelongsTo :data=\"data[cell.key]\" :cell=\"cell\" :row=\"data\" v-on:click=\"emitAction\"   />\r\n    </span>  "),
                vue.createVNode(_component_CommonsFragment, null, {
                  default: vue.withCtx(() => [
                    vue.createVNode(script$l, {
                      data: __props.data[__props.cell.key],
                      cell: __props.cell,
                      row: __props.data,
                      onClick: emitAction
                    }, null, 8 /* PROPS */, ["data", "cell", "row"])
                  ]),
                  _: 1 /* STABLE */
                })
              ], 2112 /* STABLE_FRAGMENT, DEV_ROOT_FRAGMENT */))
            : (__props.cell.type == 'expression')
              ? (vue.openBlock(), vue.createBlock(_component_CommonsFragment, { key: 5 }, {
                  default: vue.withCtx(() => [
                    vue.createVNode(script$k, {
                      data: __props.data[__props.cell.key],
                      cell: __props.cell,
                      row: __props.data,
                      onClick: emitAction
                    }, null, 8 /* PROPS */, ["data", "cell", "row"])
                  ]),
                  _: 1 /* STABLE */
                }))
              : (__props.cell.type == 'date')
                ? (vue.openBlock(), vue.createElementBlock("span", {
                    key: 6,
                    onClick: emitAction
                  }, [
                    vue.createVNode(script$h, {
                      data: __props.data[__props.cell.key],
                      cell: __props.cell,
                      row: __props.data,
                      onClick: emitAction
                    }, null, 8 /* PROPS */, ["data", "cell", "row"])
                  ]))
                : (__props.cell.type == 'object')
                  ? (vue.openBlock(), vue.createElementBlock(vue.Fragment, { key: 7 }, [
                      vue.createCommentVNode(" <span v-else-if=\"cell.type == 'action'\"  >\r\n        <Actions :data.sync=\"data[cell.key]\" :cell.sync=\"cell\" :row.sync=\"data\" />\r\n    </span> "),
                      vue.createElementVNode("span", {
                        textContent: vue.toDisplayString(vue.unref(get)(__props.data, `${__props.cell.action.name}`, __props.data[__props.cell.key])),
                        onClick: emitAction
                      }, null, 8 /* PROPS */, _hoisted_1$e)
                    ], 2112 /* STABLE_FRAGMENT, DEV_ROOT_FRAGMENT */))
                  : (__props.cell.type == 'html')
                    ? (vue.openBlock(), vue.createElementBlock("span", {
                        key: 8,
                        innerHTML: __props.data[__props.cell.key],
                        onClick: emitAction
                      }, null, 8 /* PROPS */, _hoisted_2$d))
                    : (vue.openBlock(), vue.createElementBlock("span", {
                        key: 9,
                        textContent: vue.toDisplayString(__props.data[__props.cell.key]),
                        onClick: emitAction
                      }, null, 8 /* PROPS */, _hoisted_3$a))
}
}

};

script$g.__file = "src/components/tables/index.vue";

const _hoisted_1$d = {
  class: "spinner",
  viewBox: "0 0 50 50"
};
const _hoisted_2$c = /*#__PURE__*/vue.createElementVNode("circle", {
  class: "path",
  cx: "25",
  cy: "25",
  r: "20",
  fill: "none",
  "stroke-width": "5"
}, null, -1 /* HOISTED */);

function render$1(_ctx, _cache) {
  return (vue.openBlock(), vue.createElementBlock("svg", _hoisted_1$d, [
    _hoisted_2$c,
    vue.renderSlot(_ctx.$slots, "default")
  ]))
}

const script$f = {};

script$f.render = render$1;
script$f.__file = "src/components/common/Spinner.vue";

const _hoisted_1$c = { class: "relative shadow-md sm:rounded-lg crud-table overflow-x-auto w-full" };
const _hoisted_2$b = { class: "text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400" };
const _hoisted_3$9 = { class: "pd-toolbar py-1" };
const _hoisted_4$7 = ["colspan"];
const _hoisted_5$3 = { class: "headers flex" };
const _hoisted_6$3 = { class: "lelf-col flex items-center justify-left w-1/2" };
const _hoisted_7$1 = { class: "right-col flex items-center justify-center w-1/2" };
const _hoisted_8$1 = { class: "right-col flex items-center justify-end w-1/2" };
const _hoisted_9 = { class: "px-4 flex gap-2" };
const _hoisted_10 = ["checked"];
const _hoisted_11 = ["onClick"];
const _hoisted_12 = { class: "flex items-center gap-2" };
const _hoisted_13 = { key: 0 };
const _hoisted_14 = /*#__PURE__*/vue.createElementVNode("th", { class: "" }, " Â  ", -1 /* HOISTED */);
const _hoisted_15 = {
  key: 0,
  class: "pd-filters"
};
const _hoisted_16 = /*#__PURE__*/vue.createElementVNode("th", { class: "px-4 flex gap-2" }, " Â  ", -1 /* HOISTED */);
const _hoisted_17 = { class: "px-2 flex items-center justify-end" };
const _hoisted_18 = {
  key: 0,
  class: "flex items-center justify-end"
};
const _hoisted_19 = /*#__PURE__*/vue.createElementVNode("p", { class: "" }, "Limit", -1 /* HOISTED */);
const _hoisted_20 = { class: "px-4 py-2" };
const _hoisted_21 = ["checked", "onChange"];
const _hoisted_22 = { class: "px-2 py-2 flex justify-end" };
const _hoisted_23 = ["onClick"];
const _hoisted_24 = ["onClick"];
const _hoisted_25 = {
  key: 0,
  class: "pd-subfooter"
};
const _hoisted_26 = /*#__PURE__*/vue.createElementVNode("td", { class: "px-4 py-2" }, " Â  ", -1 /* HOISTED */);
const _hoisted_27 = { class: "px-2 py-2 flex justify-end" };
const _hoisted_28 = { class: "pd-footer" };
const _hoisted_29 = ["colspan"];
const _hoisted_30 = {
  key: 2,
  class: "text-center h-20"
};
  
  
var script$e = {
  __name: 'Table',
  props: {  
    model:{
      type: Object,
      default: null
    },
    resource: {
      type: Array,
      default: []
    }
  },
  emits: ['create','edit','delete','selected','refresh'],
  setup(__props, { expose: __expose, emit }) {

const { resource, model:defModel } = __props;

  
   
  let model = defModel ? vue.ref(defModel) : vue.inject('model');  
  vue.inject('session');  
  // const App = useAppContext() 
  let Instance = ResourceClass({ $axios: axios }); 
  let alert = vue.ref(null);
  let ready = vue.ref(false);
  let schema = vue.ref([]);
  let filters = vue.ref({});
  let selected = vue.ref([]);
  let table = vue.ref(resource);
  let perPage = vue.ref( _.get(model.value,'api.perPage',5) );
  let tableCount = vue.ref(1);
  vue.reactive({});
  let queryInfo = vue.reactive({});
  const gete = _.get;

  
      
  let totalCols = vue.computed(() => { 
    return schema.value.length + 2
  });
    
  let totalPages = vue.computed(() => { 
    return calcPages(tableCount.value, perPage.value)
  });

  const deleteEmit = (row) =>{
    // Instance.setModel({ ...model.value })

    if( confirm('Are you sure?') ) { 
      ( Instance.can('deleteDataById') ? Instance.deleteData(row):Promise.resolve('bypassed')).then(
        e => {
          console.log(e);
          // $message("Removido com sucesso")
          emit('delete', { target: 'delete', row });
          getDatasource();
        }
      ).catch(setAlert);
    }else {
     return false
    }
  };

  const selectAll = () => {
    selected.value = selectionAll(selected.value, table.value);
    table.value = [ ...table.value ];
  };

  const deleteSelected = async () => {
    if( confirm('Are you sure?') ) {
      for( let row of selected.value ){
        await Instance.deleteData(row).then(e => { 
          emit('delete', { target: 'delete', row});
        });
      }
      $message("Removido com sucesso");
      getDatasource();
    }
  };

  const toggleSort = (col = {}) => {
    vue.nextTick(() => { 
      // let localPagination = _.get(model.value,'api.pagination.local', false)
      // config.sort = col.key
      col._order = _.isNil(col._order) ? false : !col._order;

      queryInfo = { ...queryInfo, ...fetchQueryInfo('sort', { column: col.key, asc: col._order }) };

      console.debug('toggleSort', queryInfo);
      // if( Instance.isIt('local') )
      //   table.value = Instance.sorting({ local: true, col:[col.key], order:[col._order ? 'desc':'asc']  })
      // else
        getDatasource();
    });
  };

  const changePage = (num) => {
    vue.nextTick(() => { 
      let localPagination = _.get(model.value,'api.pagination.local', false);
      queryInfo = { ...queryInfo, ...fetchQueryInfo('page', num) };

      if( localPagination === true )
        table.value = Instance.paginate({ local: true, perPage: perPage.value, page:num });
      else
        getDatasource();
    });
  };

  const changeLimit = (v) => {
    vue.nextTick(() => { 
      if( Instance.can('paginate') )
        queryInfo = { ...queryInfo, ...fetchQueryInfo('pageSize', v) };

      getDatasource();
    });
  };

  const setFilter = (col, value) => {
    return changeFilters({ [col.key]:{ value:value, filter: col?.filter }})
  };

  const changeFilters = (e) => {
    vue.nextTick(() => { 
      console.debug("changeFilters change", e); 
      filters.value = Object.assign(filters.value, e);

      Object.keys(filters.value).map((item) => {
        if( !filters.value[item].value )
           filters.value = _.omit(filters.value, [item]);
      });

      queryInfo = { ...queryInfo, ...fetchQueryInfo('filter', filters.value) };
      getDatasource();
    });
  };

  const getDatasource = async (data={}, config={}) => {
    try {
      if( !Instance.isIt('local') && validateQueryInfo(JSON.parse(JSON.stringify(queryInfo)) )){
        let api = filterParams({ ...model.value.api }, { ...queryInfo, data: resource.value }); 
        Instance.setModel({ ...model.value, api });
      }
 
      if( Instance.can('getData') ){
        var { rows, total } = await Instance.getData(data, config);  
      } else { 
        var { rows, total } = await Instance.setData(resource, queryInfo);  
      }

      if( Instance.isIt('local') ) { 
        var { rows, total } = await Instance.setData(rows, queryInfo);  
      }
       
      // table.value = localPagination ? 
      table.value = Instance.paginate({ local:true, perPage: perPage.value });
      tableCount.value = total;

      emit('refresh', { target:'refresh', rows });
      console.debug("concluiu  getDatasource");
    } catch (error) {
      console.error(error);
      setAlert({ message:"Error to getData" });
    }
  };

  const modifyColumn = async (input) => {
    if( input.model && typeof input.model == 'string' ) 
      input.model = await Instance.loadModel(input.model);

    if( _.has(model.value, 'auth') ){ 
      let request = Instance.authRequest( Instance.getToken() );
      input.model = mergeDeep(input.model, { api:request });
    } 

    if( input.overwrite && typeof input.overwrite == 'object' )
      input.model = mergeDeep(input.model, input.overwrite);
 
    input.model = mergeDeep(input.model, _.pick(model.value, ['domain','auth']));

    return input
  };

  const setAlert = (rs) => {
    alert.value = {
      message: _.get(rs, 'response.data.message', _.get(rs, 'data.message', rs.message)),
      type: rs && rs.error ? 'error': 'success',
    };
  };

  vue.watch(model, () => {
    Instance.setModel({ ...model.value });

    getDatasource();
  });

  vue.watch(() => selected, (dd) => {  
    emit('selected', { target:'selected', rows:dd.value });
  }, { deep: true });

  __expose({
    getDatasource,
  });

  vue.onBeforeMount(async () => {
    schema.value = schemaColumns(model.value?.properties); 
    for(let idx in schema.value){
      // console.debug('onBeforeMount', schema.value[idx])
      schema.value[idx] = await modifyColumn(schema.value[idx]);
    }
  });
    
  vue.onMounted(async () => {
    try { 
      // console.error("table mounted", model.value)
      Instance.setModel({ ...model.value });
  
      // await getDatasource()
      changeLimit(perPage.value);
      // $bus.listen('table:refresh', getDatasource)
    } catch (error) {
      console.error("onmounted", error);
    }
    ready.value = true;
  });
 
  vue.onUnmounted(() => {
      // console.error("table unmountedmounted", model.value)
      Instance.setModel({ });
  });

return (_ctx, _cache) => {
  const _component_FormKit = vue.resolveComponent("FormKit");

  return (vue.openBlock(), vue.createElementBlock("div", _hoisted_1$c, [
    (vue.unref(alert) && vue.unref(alert).message)
      ? (vue.openBlock(), vue.createElementBlock("div", {
          key: 0,
          class: vue.normalizeClass(`alert w-full text-center ${ vue.unref(alert)?.type || '' }`)
        }, [
          vue.createElementVNode("span", null, vue.toDisplayString(vue.unref(alert).message), 1 /* TEXT */)
        ], 2 /* CLASS */))
      : vue.createCommentVNode("v-if", true),
    (vue.unref(ready))
      ? (vue.openBlock(), vue.createElementBlock("table", {
          key: 1,
          class: vue.normalizeClass(["w-full text-sm text-left text-gray-500 dark:text-gray-400", `${ vue.unref(model).tableClasses || '' }`])
        }, [
          vue.createElementVNode("thead", _hoisted_2$b, [
            vue.createElementVNode("tr", _hoisted_3$9, [
              vue.createElementVNode("th", {
                scope: "col",
                colspan: vue.unref(totalCols),
                class: "py-2"
              }, [
                vue.createElementVNode("div", _hoisted_5$3, [
                  vue.createElementVNode("div", _hoisted_6$3, [
                    (vue.unref(selected).length)
                      ? (vue.openBlock(), vue.createElementBlock("button", {
                          key: 0,
                          class: "px-4 flex items-center whitespace-nowrap",
                          type: "button",
                          onClick: deleteSelected
                        }, [
                          vue.createVNode(vue.unref(script$r), { class: "h-5" }),
                          vue.createTextVNode(" " + vue.toDisplayString(vue.unref(selected).length) + " Selected ", 1 /* TEXT */)
                        ]))
                      : vue.createCommentVNode("v-if", true),
                    vue.createElementVNode("button", {
                      class: "px-4",
                      type: "button",
                      onClick: getDatasource
                    }, [
                      vue.createVNode(vue.unref(script$s), { class: "h-5" })
                    ]),
                    (vue.unref(can)(vue.unref(model), 'canCreate'))
                      ? (vue.openBlock(), vue.createElementBlock("button", {
                          key: 1,
                          class: "px-4",
                          type: "button",
                          onClick: _cache[0] || (_cache[0] = () => emit('create', {target: 'create', row: {}}))
                        }, [
                          vue.createVNode(vue.unref(script$t), { class: "h-5" })
                        ]))
                      : vue.createCommentVNode("v-if", true),
                    vue.renderSlot(_ctx.$slots, "toolbar-left")
                  ]),
                  vue.createElementVNode("div", _hoisted_7$1, [
                    vue.renderSlot(_ctx.$slots, "toolbar-center")
                  ]),
                  vue.createElementVNode("div", _hoisted_8$1, [
                    vue.renderSlot(_ctx.$slots, "toolbar-right")
                  ])
                ])
              ], 8 /* PROPS */, _hoisted_4$7)
            ]),
            vue.createElementVNode("tr", null, [
              vue.createElementVNode("th", _hoisted_9, [
                vue.createElementVNode("input", {
                  type: "checkbox",
                  checked: (vue.unref(selected).length == vue.unref(table).length),
                  onChange: selectAll
                }, null, 40 /* PROPS, HYDRATE_EVENTS */, _hoisted_10),
                vue.createTextVNode(" All ")
              ]),
              (vue.openBlock(true), vue.createElementBlock(vue.Fragment, null, vue.renderList(vue.unref(schema), (col) => {
                return (vue.openBlock(), vue.createElementBlock("th", {
                  scope: "col",
                  class: "px-2 py-1",
                  key: col.key,
                  onClick: () => toggleSort(col)
                }, [
                  vue.createElementVNode("div", _hoisted_12, [
                    vue.createTextVNode(vue.toDisplayString(col.label) + " ", 1 /* TEXT */),
                    (col.sorter && vue.unref(Instance).isIt('sorter') == col.key)
                      ? (vue.openBlock(), vue.createElementBlock("span", _hoisted_13, [
                          (col._order)
                            ? (vue.openBlock(), vue.createBlock(vue.unref(script$v), {
                                key: 0,
                                class: "h-4"
                              }))
                            : (vue.openBlock(), vue.createBlock(vue.unref(script$w), {
                                key: 1,
                                class: "h-4"
                              }))
                        ]))
                      : vue.createCommentVNode("v-if", true)
                  ])
                ], 8 /* PROPS */, _hoisted_11))
              }), 128 /* KEYED_FRAGMENT */)),
              _hoisted_14
            ]),
            (vue.unref(can)(vue.unref(model), 'api.pagination.limitField', false) && vue.unref(can)(vue.unref(model), 'api.pagination.filterExp', false))
              ? (vue.openBlock(), vue.createElementBlock("tr", _hoisted_15, [
                  _hoisted_16,
                  (vue.openBlock(true), vue.createElementBlock(vue.Fragment, null, vue.renderList(vue.unref(schema), (col) => {
                    return (vue.openBlock(), vue.createElementBlock("th", {
                      scope: "col",
                      class: "px-2",
                      key: col.key
                    }, [
                      (vue.unref(can)(vue.unref(model), 'api.pagination.filterExp', false) && col.filter)
                        ? (vue.openBlock(), vue.createBlock(_component_FormKit, {
                            key: 0,
                            type: vue.unref(gete)(col, 'filter.type', 'search'),
                            delay: 500,
                            "outer-class": "m-0 p-0",
                            "input-class": "w-full p-1",
                            model: vue.unref(gete)(col, 'model', {}),
                            overwrite: vue.unref(gete)(col, 'overwrite', {}),
                            options: vue.unref(gete)(col, 'options', []),
                            onInput: e => setFilter(col, e)
                          }, null, 8 /* PROPS */, ["type", "model", "overwrite", "options", "onInput"]))
                        : vue.createCommentVNode("v-if", true),
                      vue.renderSlot(_ctx.$slots, "header-scope", vue.normalizeProps(vue.guardReactiveProps({col, filters: vue.unref(filters)})))
                    ]))
                  }), 128 /* KEYED_FRAGMENT */)),
                  vue.createElementVNode("th", _hoisted_17, [
                    vue.renderSlot(_ctx.$slots, "header-actions", vue.normalizeProps(vue.guardReactiveProps({schema: vue.unref(schema), filters: vue.unref(filters)}))),
                    (vue.unref(can)(vue.unref(model), 'api.pagination.limitField', false))
                      ? (vue.openBlock(), vue.createElementBlock("span", _hoisted_18, [
                          _hoisted_19,
                          vue.createVNode(_component_FormKit, {
                            "outer-class": "m-0 p-0 pl-2",
                            "input-class": "text-xs",
                            type: "select",
                            modelValue: vue.unref(perPage),
                            "onUpdate:modelValue": _cache[1] || (_cache[1] = $event => (vue.isRef(perPage) ? (perPage).value = $event : perPage = $event)),
                            options: [1,5,15,25,50,100,500],
                            onInput: changeLimit
                          }, null, 8 /* PROPS */, ["modelValue"])
                        ]))
                      : vue.createCommentVNode("v-if", true)
                  ])
                ]))
              : vue.createCommentVNode("v-if", true)
          ]),
          vue.createElementVNode("tbody", null, [
            (vue.openBlock(true), vue.createElementBlock(vue.Fragment, null, vue.renderList(vue.unref(table), (row, index) => {
              return (vue.openBlock(), vue.createElementBlock("tr", {
                class: "pd-rows bg-white border-b dark:bg-gray-800 dark:border-gray-700",
                key: index
              }, [
                vue.createElementVNode("td", _hoisted_20, [
                  vue.createElementVNode("input", {
                    type: "checkbox",
                    value: false,
                    checked: vue.unref(isSelected)(vue.unref(selected), row),
                    onChange: $event => (vue.unref(selectionChange)(vue.unref(selected), row))
                  }, null, 40 /* PROPS, HYDRATE_EVENTS */, _hoisted_21)
                ]),
                (vue.openBlock(true), vue.createElementBlock(vue.Fragment, null, vue.renderList(vue.unref(schema), (col, k) => {
                  return (vue.openBlock(), vue.createElementBlock("td", {
                    class: "px-2 py-2",
                    key: col.key
                  }, [
                    vue.renderSlot(_ctx.$slots, "row-scope", vue.normalizeProps(vue.guardReactiveProps({col, row, index})), () => [
                      (vue.openBlock(), vue.createBlock(script$g, {
                        cell: col,
                        data: row,
                        key: col.key+k
                      }, null, 8 /* PROPS */, ["cell", "data"]))
                    ])
                  ]))
                }), 128 /* KEYED_FRAGMENT */)),
                vue.createElementVNode("td", _hoisted_22, [
                  vue.renderSlot(_ctx.$slots, "row-actions", vue.normalizeProps(vue.guardReactiveProps({row, index}))),
                  (vue.unref(can)(vue.unref(model), 'canEdit'))
                    ? (vue.openBlock(), vue.createElementBlock("a", {
                        key: 0,
                        class: "cursor-pointer mr-3",
                        onClick: () => emit('edit', { target: 'edit', row})
                      }, [
                        vue.createVNode(vue.unref(script$u), { class: "h-5" })
                      ], 8 /* PROPS */, _hoisted_23))
                    : vue.createCommentVNode("v-if", true),
                  (vue.unref(can)(vue.unref(model), 'canDelete'))
                    ? (vue.openBlock(), vue.createElementBlock("a", {
                        key: 1,
                        class: "cursor-pointer",
                        onClick: () => deleteEmit(row)
                      }, [
                        vue.createVNode(vue.unref(script$r), { class: "h-5" })
                      ], 8 /* PROPS */, _hoisted_24))
                    : vue.createCommentVNode("v-if", true)
                ])
              ]))
            }), 128 /* KEYED_FRAGMENT */))
          ]),
          vue.createElementVNode("tfoot", null, [
            (vue.unref(can)(vue.unref(model), 'canFooter', false))
              ? (vue.openBlock(), vue.createElementBlock("tr", _hoisted_25, [
                  _hoisted_26,
                  (vue.openBlock(true), vue.createElementBlock(vue.Fragment, null, vue.renderList(vue.unref(schema), (col) => {
                    return (vue.openBlock(), vue.createElementBlock("td", {
                      class: "px-4 py-2",
                      key: col.key
                    }, [
                      vue.renderSlot(_ctx.$slots, "footer-scope", vue.normalizeProps(vue.guardReactiveProps({col, table: vue.unref(table), filters: vue.unref(filters)})))
                    ]))
                  }), 128 /* KEYED_FRAGMENT */)),
                  vue.createElementVNode("td", _hoisted_27, [
                    vue.renderSlot(_ctx.$slots, "footer-actions", vue.normalizeProps(vue.guardReactiveProps({table: vue.unref(table), filters: vue.unref(filters)})))
                  ])
                ]))
              : vue.createCommentVNode("v-if", true),
            vue.createElementVNode("tr", _hoisted_28, [
              vue.createElementVNode("td", {
                colspan: vue.unref(totalCols),
                class: "w-full pt-4"
              }, [
                vue.renderSlot(_ctx.$slots, "pagination", vue.normalizeProps(vue.guardReactiveProps({totalPages: vue.unref(totalPages), actual:1, changePage: changePage})), () => [
                  (vue.unref(can)(vue.unref(model), 'api.pagination.pageField', false) || vue.unref(can)(vue.unref(model), 'api.pagination.local', false))
                    ? (vue.openBlock(), vue.createBlock(script$o, {
                        key: 0,
                        pages: vue.unref(totalPages),
                        actual: 1,
                        onChange: changePage
                      }, null, 8 /* PROPS */, ["pages"]))
                    : vue.createCommentVNode("v-if", true)
                ])
              ], 8 /* PROPS */, _hoisted_29)
            ])
          ])
        ], 2 /* CLASS */))
      : (vue.openBlock(), vue.createElementBlock("div", _hoisted_30, [
          vue.createVNode(script$f)
        ]))
  ]))
}
}

};

script$e.__file = "src/components/Table.vue";

const _hoisted_1$b = {
  key: 0,
  class: "form"
};
const _hoisted_2$a = {
  key: 0,
  class: "text-red"
};
const _hoisted_3$8 = { key: 2 };
const _hoisted_4$6 = { key: 3 };

  // let { $axios, $bus, $message } = useNuxtApp() 
  
var script$d = {
  __name: 'Form',
  props: {
    model: {
      type: Object,
      default: () => ({ properties: [] })
    }, 
    data: {
      type: Object,
      default: () => ({})
    },
    resource:{
      type: Object,
      default: () => ({})
    },
  },
  emits: ['saved'],
  setup(__props, { emit }) {

const { model, data, resource } = __props;

  let Instance = ResourceClass({ $axios: axios });
  
  // const App = useAppContext()
  // const Auth = useAuth()
  const schema = vue.ref([]); 

  
 
  const save = (payload) => {
    Instance.setModel(JSON.parse(JSON.stringify(model)));
    // payload = Object.assign(resource, payload)

    let formFields = fields.value.filter(i => !i.ignored).map(i => i.key);
    console.debug('Save', formFields, payload);  
    Instance.saveData(_.pick(payload, formFields)).then((rs) => {
      // $message("Saved ")
      res.value = rs;
      emit('saved', rs);

      // $bus.emit('form:created', payload)
    }).catch(err => res.value = _.get(err, 'response.data', err) );
  };

  let row = vue.ref(data);
  let res = vue.ref({});
  let ready = vue.ref(false);
  let fields = vue.ref(schemaFields(model?.properties)); 
 
  const getDatasource = async (payload={}, config={}) => {
    try { 
      console.debug("chamou to formDatasource", model);  
      let api = filterParams({ ..._.get(model, 'api', {}) }, { data: payload }); 

      Instance.setModel({ ...model, api });

      row.value = await Instance.getDataObject(payload, config);
        
      console.debug("concluiu  getDatasource", api);
    } catch (error) {
      console.error('error formDatarousce', error);
      alert("Error to getData");
    }
  };

  vue.watch(model, (newVal) => {
    console.debug('form wathc', newVal);
    Instance.setModel(JSON.parse(JSON.stringify(newVal))); 
  });
  
  const modifyInput = async (input) => {
    if( input.model && typeof input.model == 'string' ) 
      input.model = await Instance.loadModel(input.model);
      
    let token = Instance.getToken();
    let request = Instance.authRequest(token); 
    _.set(input.model, 'api.resource', row.value);
    _.set(input.model, 'api', mergeDeep(_.get(input.model,'api',({})), request) );

    return input
  };
 
  vue.onBeforeMount(async () => {
    try {  
      let modelRaw = JSON.parse(JSON.stringify(model));
      Instance.setModel(modelRaw);
      fields.value = schemaFields(modelRaw.properties);
      // row.value = await Instance.getData(row.value)
 
      // Instance.setModel(model.value)
      // resource.value = await Instance.getData() 

      console.debug('fields', fields.value);
      for(let row of model.properties){ 
        schema.value.push( await normalizeInput(row, modifyInput) );
      } 
    } catch (error) {
      console.error("onmounted", error);
    }
  });

  vue.onMounted(async () => {
    if( model.type == 'form' && Instance.can('getDataById') )
        await getDatasource(resource);
    
    ready.value = true;
  });

  vue.onUnmounted(() => { 
    console.debug("onmounted");
  });

return (_ctx, _cache) => {
  const _component_FormKitSchema = vue.resolveComponent("FormKitSchema");
  const _component_FormKit = vue.resolveComponent("FormKit");

  return (!!vue.unref(row))
    ? (vue.openBlock(), vue.createElementBlock("div", _hoisted_1$b, [
        (vue.unref(res).message)
          ? (vue.openBlock(), vue.createElementBlock("div", _hoisted_2$a, [
              vue.renderSlot(_ctx.$slots, "alert", vue.normalizeProps(vue.guardReactiveProps({ row: vue.unref(row), res: vue.unref(res), model: __props.model })), () => [
                vue.createTextVNode(vue.toDisplayString(vue.unref(res).message), 1 /* TEXT */)
              ])
            ]))
          : vue.createCommentVNode("v-if", true),
        (vue.unref(ready) && schema.value)
          ? (vue.openBlock(), vue.createBlock(_component_FormKit, {
              key: 1,
              type: "form",
              method: "post",
              "submit-label": "Submit",
              "form-class": `w-full ${ __props.model?.formClasses || '' }`,
              actions: vue.unref(can)(__props.model, 'submit'),
              modelValue: vue.unref(row),
              "onUpdate:modelValue": _cache[0] || (_cache[0] = $event => (vue.isRef(row) ? (row).value = $event : row = $event)),
              onSubmit: save
            }, {
              default: vue.withCtx(() => [
                vue.renderSlot(_ctx.$slots, "prefix", vue.normalizeProps(vue.guardReactiveProps({ row: vue.unref(row), res: vue.unref(res), model: __props.model }))),
                vue.createVNode(_component_FormKitSchema, {
                  schema: schema.value,
                  class: "py-2"
                }, null, 8 /* PROPS */, ["schema"]),
                vue.renderSlot(_ctx.$slots, "suffix", vue.normalizeProps(vue.guardReactiveProps({ row: vue.unref(row), res: vue.unref(res), model: __props.model })))
              ]),
              _: 3 /* FORWARDED */
            }, 8 /* PROPS */, ["form-class", "actions", "modelValue"]))
          : (!vue.unref(ready))
            ? (vue.openBlock(), vue.createElementBlock("div", _hoisted_3$8, [
                vue.createVNode(script$f)
              ]))
            : (vue.openBlock(), vue.createElementBlock("div", _hoisted_4$6, [
                vue.renderSlot(_ctx.$slots, "error", vue.normalizeProps(vue.guardReactiveProps({ row: vue.unref(row), res: vue.unref(res), model: __props.model })), () => [
                  vue.createTextVNode(" Schema not found ")
                ])
              ]))
      ]))
    : vue.createCommentVNode("v-if", true)
}
}

};

script$d.__file = "src/components/Form.vue";

const _hoisted_1$a = {
  key: 0,
  class: "modal fixed w-full h-full bg-black/20 left-0 top-0"
};
const _hoisted_2$9 = { class: "absolute w-1/2 -translate-x-1/2 left-1/2 bg-white p-4 rounded-lg my-2 max-h-[95vh] overflow-y-auto" };


var script$c = {
  __name: 'Flow',
  props: ['schema'],
  setup(__props) {

const { schema } = __props;

 
vue.ref(schema); 
const data =  vue.ref();

function setData (newVal) {
  data.value = null;
  vue.nextTick(() => {
    data.value = newVal;
  });
}

function doEvent(e){
  // console.log( 'Event received', JSON.stringify(e, null, 2))
  if( e.target == 'create' )
    setData(e.row);
  if( e.target == 'edit' )
    setData(e.row); 
}

return (_ctx, _cache) => {
  return (vue.openBlock(), vue.createElementBlock("main", {
    class: vue.normalizeClass(`w-full relative ${ _ctx.$attrs.class || ''}`)
  }, [
    vue.createVNode(script$e, {
      model: __props.schema,
      onCreate: doEvent,
      onEdit: doEvent,
      onDelete: doEvent,
      onSelected: doEvent,
      onRefresh: doEvent
    }, null, 8 /* PROPS */, ["model"]),
    (data.value)
      ? (vue.openBlock(), vue.createElementBlock("div", _hoisted_1$a, [
          vue.createElementVNode("button", {
            onClick: _cache[0] || (_cache[0] = e => setData(null)),
            class: "absolute right-0"
          }, "âœ–"),
          vue.createElementVNode("div", _hoisted_2$9, [
            vue.createVNode(script$d, {
              model: __props.schema,
              data: data.value,
              onSaved: _cache[1] || (_cache[1] = $event => (setData(null)))
            }, null, 8 /* PROPS */, ["model", "data"])
          ])
        ]))
      : vue.createCommentVNode("v-if", true)
  ], 2 /* CLASS */))
}
}

};

script$c.__file = "src/components/Flow.vue";

function render(_ctx, _cache) {
  return vue.renderSlot(_ctx.$slots, "default")
}

const script$b = {};


script$b.render = render;
script$b.__file = "src/components/common/Fragment.vue";

const _hoisted_1$9 = { key: 0 };
const _hoisted_2$8 = {
  key: 1,
  class: "auth-form w-1/3 mx-auto"
};
const _hoisted_3$7 = {
  key: 0,
  class: "text-center"
};
const _hoisted_4$5 = /*#__PURE__*/vue.createElementVNode("h4", { class: "text-center py-4" }, "Project Authentication", -1 /* HOISTED */);
const _hoisted_5$2 = { class: "action-buttons mt-3 flex gap-4" };
const _hoisted_6$2 = ["disabled"];

  
var script$a = {
  __name: 'Auth',
  props: ['schema', 'config'],
  emits: ['auth:failed','auth:logged','update:schema'],
  setup(__props, { emit }) {

const { schema, config = {} } = __props;
 
  const Instance = ResourceClass({ $axios: axios });
  
  

  let loading = vue.ref(true);
  let form = vue.ref({});
  let login = vue.ref(false);
  let session = vue.ref({});
  Instance.setModel(schema);  
  Instance.setConfig(config);  
 
  let hasAuth = vue.computed(() => {
    return _.has(config, 'auth')
  }); 
  
  const doAuth = async (form) => {
    try{
      loading.value = true;
      let res = await Instance.authenticate(form);
      
      return await Instance.checkAuth(true).then(success).catch(error)
    }catch(e){
      console.error( getErrorMessage(e) ); 
      loading.value = false;
    }
  };

  const success = function(res){ 
    console.debug("called success", res);
    session.value = res;

    if( !_.has(session.value, 'token') ) {
      loading.value = false;
      return emit('auth:failed', {message: 'token not found', ...res })
    } 
     
    emit(
      'update:schema', 
      mergeDeep(schema, { api: _.get(session.value, 'request', {}) })
    );
    emit('auth:logged', _.pick(session.value, ['token','user','logged']));

    vue.nextTick(() => {
      loading.value = false;
      login.value = true;
    });
  };
  
  const error = function({ response, message, ...data }){
    // app.message( getErrorMessage({ response, message, ...data }) )
    console.log('Auth Error', message, response, data);
    loading.value = false;
    login.value = false;
    
    emit('auth:failed', {message});
  };

  const logout = () => {
    console.debug("called auth logout");
    loading.value = true;
    return Instance.logout().then(() => {
      loading.value = false;
      login.value = false;
      console.debug("finish auth logout");
    })
  };  
      
  vue.onMounted(async () => {
    try{  
      if( !hasAuth.value || !Instance.isIt('logged') ) {
        console.debug('bypassed auth', hasAuth.value, Instance.isIt('logged') );
        login.value = true;  
        loading.value = false; 
        return;
      }

      console.debug('auth process start');
      let token = Instance.getToken();
      session.value = Instance.getSession(); 

      loading.value = true;
      if( token && _.get(session.value, 'logged', false) ){
        // emit('auth:logged', session.value)  
        success(session.value);
      }else if( token ){
        await Instance.checkAuth().then(success);
      }else { 
        login.value = false;
        console.debug('show login form'); 
      } 
      
      loading.value = false; 
    }catch(e){
      login.value = false;
      emit('auth:failed', e);
      console.debug('erro mounted auth', e);
      console.error( getErrorMessage(e) );
      
      loading.value = false; 
    }  
  }); 

return (_ctx, _cache) => {
  const _component_FormKit = vue.resolveComponent("FormKit");

  return (vue.openBlock(), vue.createBlock(script$b, null, {
    default: vue.withCtx(() => [
      (vue.unref(login))
        ? (vue.openBlock(), vue.createElementBlock("section", _hoisted_1$9, [
            vue.renderSlot(_ctx.$slots, "default", {
              schema: __props.schema,
              methods: { logout: logout },
              session: vue.unref(session)
            }, () => [
              vue.createTextVNode(" vazio ")
            ])
          ]))
        : (vue.openBlock(), vue.createElementBlock("section", _hoisted_2$8, [
            (vue.unref(loading))
              ? (vue.openBlock(), vue.createElementBlock("h3", _hoisted_3$7, [
                  vue.createVNode(script$f, null, {
                    default: vue.withCtx(() => [
                      vue.createTextVNode(">Authenticating...")
                    ]),
                    _: 1 /* STABLE */
                  })
                ]))
              : (vue.openBlock(), vue.createBlock(_component_FormKit, {
                  key: 1,
                  type: "form",
                  "form-class": "flex flex-col gap-4",
                  method: "post",
                  modelValue: vue.unref(form),
                  "onUpdate:modelValue": _cache[1] || (_cache[1] = $event => (vue.isRef(form) ? (form).value = $event : form = $event)),
                  onSubmit: doAuth,
                  actions: false
                }, {
                  default: vue.withCtx(({ hasErrors }) => [
                    _hoisted_4$5,
                    vue.createVNode(_component_FormKit, {
                      type: "text",
                      name: "username",
                      placeholder: "Username",
                      validation: "required"
                    }),
                    vue.createVNode(_component_FormKit, {
                      type: "password",
                      name: "secret",
                      placeholder: "Password",
                      validation: "required"
                    }),
                    vue.createVNode(_component_FormKit, {
                      type: "checkbox",
                      name: "remember",
                      label: "Keep logged",
                      wrapperClass: "flex gap-2",
                      innerClass: "w-6"
                    }),
                    vue.createElementVNode("div", _hoisted_5$2, [
                      vue.createElementVNode("button", {
                        type: "button",
                        color: "danger",
                        class: "py-2 px-4 border bg-red-800 text-white rounded hover:text-gray-400",
                        onClick: _cache[0] || (_cache[0] = $event => (_ctx.$emit('close', { refresh: false })))
                      }, " Cancel "),
                      vue.createElementVNode("button", {
                        type: "submit",
                        color: "success",
                        class: "py-2 px-4 border bg-green-800 text-white rounded hover:text-gray-400",
                        disabled: hasErrors
                      }, " Send ", 8 /* PROPS */, _hoisted_6$2)
                    ])
                  ]),
                  _: 1 /* STABLE */
                }, 8 /* PROPS */, ["modelValue"]))
          ]))
    ]),
    _: 3 /* FORWARDED */
  }))
}
}

};

script$a.__file = "src/components/Auth.vue";

const _hoisted_1$8 = { class: "tabs" };
const _hoisted_2$7 = { class: "flex my-2 w-full border-b" };
const _hoisted_3$6 = ["onClick"];

  
var script$9 = {
  __name: 'Tabs',
  props: ['tab', 'tabs'],
  setup(__props) {

const { tabs:tabes , tab } = __props;
  
    
  const tabs = vue.ref(tabes); 
  const active = vue.ref(''); 
  let styleTag = vue.reactive(); 
		
  function changeTab(tb){
    if( tabs.value?.length === 0 ) return ;

    active.value = tb.name;

    if( styleTag ) styleTag.remove();

    const css = `
      ${ tabs.value.map(i => i.name).join(',') }{
        display: none;
      } 
      ${tb.name}{
        ${ tb.enabledStyle ? `${ tb.enabledStyle } ${ tb.enabledStyle.includes('important') ?'':'!important' }` : 'display: flex; flex-direction: column;' }
      }
    `;
    styleTag = document.createElement('style');
    styleTag.appendChild(document.createTextNode(css));
    document.head.appendChild(styleTag);
  }  
  
  vue.onMounted(() => {
		if( tabs.value?.length === 0 ) return ;

		changeTab(tabs.value[0]);
		active.value = tabs.value[0].name;
  });

  vue.onBeforeUnmount(() => {
    styleTag.remove();
  }); 

return (_ctx, _cache) => {
  return (vue.openBlock(), vue.createElementBlock("section", _hoisted_1$8, [
    vue.createElementVNode("ul", _hoisted_2$7, [
      (vue.openBlock(true), vue.createElementBlock(vue.Fragment, null, vue.renderList(tabs.value, (tb, ky) => {
        return (vue.openBlock(), vue.createElementBlock("li", {
          class: "mr-2 -mb-px",
          key: ky
        }, [
          vue.createElementVNode("a", {
            onClick: $event => (changeTab(tb)),
            href: "#",
            class: vue.normalizeClass([{'active': active.value == tb.name }, "inline-block py-2 px-4 text-blue-500 hover:text-blue-800 font-semibold"])
          }, vue.toDisplayString(tb.label), 11 /* TEXT, CLASS, PROPS */, _hoisted_3$6)
        ]))
      }), 128 /* KEYED_FRAGMENT */))
    ])
  ]))
}
}

};

script$9.__file = "src/components/common/Tabs.vue";

var script$8 = {
  __name: 'Section',
  props: ['model','resource'],
  setup(__props) {

const { model, resource:res = [] } = __props;
  
  let Instance = ResourceClass({ $axios:axios });

  
  const ready = vue.ref(false);
  const schema = vue.ref([{'$el':'h1', 'children':'Hello World'}]);
  let resource = vue.reactive(res);
  
  async function loadData () { 
    let res = await Instance.getData().catch(console.error);
    resource = JSON.parse(JSON.stringify(res));
  }

  vue.onBeforeMount(async () => { 
    try{
      if( typeof model === 'string' ){
        let data = await Instance.loadModel(model); 
        if( data.api?.rootApi )
          await loadData();
        schema.value = data; 
      }else {
        Instance.setModel(model);
        if( model?.api?.rootApi )
          await loadData();
        schema.value = model;
      } 
      ready.value = true;
    } catch(e) {
      console.error('before mont', e);
    }
  });
 
  vue.onMounted(async () => { 
    console.log('mounted section', typeof model); 
  });

return (_ctx, _cache) => {
  const _component_FormKitSchema = vue.resolveComponent("FormKitSchema");

  return (ready.value)
    ? (vue.openBlock(), vue.createBlock(script$b, { key: 0 }, {
        default: vue.withCtx(() => [
          vue.createVNode(_component_FormKitSchema, {
            schema: schema.value?.properties || schema.value,
            data: vue.unref(resource)
          }, null, 8 /* PROPS */, ["schema", "data"])
        ]),
        _: 1 /* STABLE */
      }))
    : vue.createCommentVNode("v-if", true)
}
}

};

script$8.__file = "src/components/layouts/Section.vue";

const _hoisted_1$7 = { key: 1 };
  
  
var script$7 = {
  __name: 'Forms',
  props: ['model','resource'],
  setup(__props) {

const { model, resource:res = {} } = __props;
   
   

  const ready = vue.ref(false);
  let schema = vue.ref({ });
  let resource = vue.reactive(res);
  let Instance = ResourceClass({ $axios:axios });
  
  vue.onBeforeMount(async () => { 
    try{
      if( typeof model === 'string' ){
        let data = await Instance.loadModel(model);  
        schema.value = data; 
      }else {
        Instance.setModel(model); 
        schema.value = model;
      } 
      ready.value = true;
    } catch(e) {
      console.error('before mont', e);
    }
  });
 
 
  vue.onMounted(async () => { 
    // ready.value = true
  });

return (_ctx, _cache) => {
  const _component_CrudForm = vue.resolveComponent("CrudForm");

  return (ready.value)
    ? (vue.openBlock(), vue.createBlock(script$b, { key: 0 }, {
        default: vue.withCtx(() => [
          (vue.unref(schema).properties)
            ? (vue.openBlock(), vue.createBlock(_component_CrudForm, {
                key: 0,
                model: vue.unref(schema),
                data: vue.unref(resource),
                onSaved: _cache[0] || (_cache[0] = e =>_ctx.$emit('saved', e))
              }, null, 8 /* PROPS */, ["model", "data"]))
            : (vue.openBlock(), vue.createElementBlock("span", _hoisted_1$7, "Properties required"))
        ]),
        _: 1 /* STABLE */
      }))
    : vue.createCommentVNode("v-if", true)
}
}

};

script$7.__file = "src/components/layouts/Forms.vue";

var components = {
  Table: script$e,
  Form: script$d,
  Flow: script$c,
  Tabs: script$9,
  Auth: script$a,
  Section: script$8,
  Forms: script$7,
};

const _hoisted_1$6 = ["data-type"];
const _hoisted_2$6 = { class: "flex flex-col py-2" };
const _hoisted_3$5 = { class: "py-2" };
const _hoisted_4$4 = /*#__PURE__*/vue.createElementVNode("hr", null, null, -1 /* HOISTED */);
 
  
var script$6 = {
  __name: 'grid',
  props: ['context'],
  emits: ['create'],
  setup(__props, { emit }) {

const { context } = __props;

   
   
  const props = vue.computed(() => context.node?.props || {});  

  const model = vue.ref({
    ..._.get(props.value, 'model', {}),
    canCreate: _.get(props.value, 'model.canEdit', false),
    canEdit: _.get(props.value, 'model.canEdit', false),
    canDelete: _.get(props.value, 'model.canEdit', false),
  }); 
  const selected = vue.ref([]); 
  
  function changed({rows}) { 
    console.log('change', rows);
    selected.value = rows;
    context.node.input(rows);
  }

  function hook({ target, ...data }){ 
    if( target == 'create' && context.attrs.onCreate )
      context.attrs.onCreate({ target, ...data });
    if( target == 'edit' && context.attrs.onEdit )
      context.attrs.onEdit({ target, ...data });
    if( target == 'delete' && context.attrs.onDelete )
      context.attrs.onDelete({ target, ...data });
    if( target == 'refresh' && context.attrs.onRefresh )
      context.attrs.onRefresh({ target, ...data });
  }

  vue.onMounted(() => {
    console.log('grid', context.attrs.onCreate);
    
  });

return (_ctx, _cache) => {
  return (vue.openBlock(), vue.createElementBlock("div", {
    "data-type": __props.context.type,
    class: vue.normalizeClass([props.value.outerClass ?? ''])
  }, [
    vue.createElementVNode("div", _hoisted_2$6, [
      vue.createVNode(script$e, {
        resource: [],
        model: model.value,
        onSelected: changed,
        onCreate: hook,
        onEdit: hook,
        onDelete: hook,
        onRefresh: hook
      }, null, 8 /* PROPS */, ["model"]),
      vue.createElementVNode("p", _hoisted_3$5, "Selected: " + vue.toDisplayString(selected.value.length), 1 /* TEXT */)
    ]),
    _hoisted_4$4
  ], 10 /* CLASS, PROPS */, _hoisted_1$6))
}
}

};

script$6.__file = "src/components/inputs/grid.vue";

const _hoisted_1$5 = ["data-type"];
const _hoisted_2$5 = { class: "flex flex-col py-2" };
const _hoisted_3$4 = /*#__PURE__*/vue.createElementVNode("hr", null, null, -1 /* HOISTED */);
  
  
var script$5 = {
  __name: 'subform',
  props: ['context'],
  setup(__props) {

const { context } = __props;

   
  const props = vue.computed(() => context.node?.props || {});  

  const model = vue.ref( props.value?.model ); 
  const selected = vue.ref([]); 
  const resource = vue.computed(() => model.value.api?.resource || {});  
  
  function changed(rows) { 
    selected.value = rows;
    context.node.input(rows);
  }

  vue.onMounted(() => { 
    
  });

return (_ctx, _cache) => {
  return (vue.openBlock(), vue.createElementBlock("div", {
    "data-type": __props.context.type,
    class: vue.normalizeClass([props.value.outerClass ?? ''])
  }, [
    vue.createElementVNode("div", _hoisted_2$5, [
      (vue.openBlock(), vue.createBlock(script$d, {
        key: __props.context.node.name,
        data: __props.context.value,
        resource: resource.value,
        model: model.value,
        onSaved: changed
      }, null, 8 /* PROPS */, ["data", "resource", "model"]))
    ]),
    _hoisted_3$4
  ], 10 /* CLASS, PROPS */, _hoisted_1$5))
}
}

};

script$5.__file = "src/components/inputs/subform.vue";

const _hoisted_1$4 = ["data-type"];
const _hoisted_2$4 = /*#__PURE__*/vue.createElementVNode("span", { class: "font-semibold text-xs mr-1" }, " Off ", -1 /* HOISTED */);
const _hoisted_3$3 = /*#__PURE__*/vue.createElementVNode("span", { class: "font-semibold text-xs ml-1" }, " On ", -1 /* HOISTED */);
const _hoisted_4$3 = {
  key: 2,
  class: "formkit-messages"
};
  
var script$4 = {
  __name: 'toggle',
  props: ['context'],
  setup(__props) {

const { context } = __props;
 
   
  const props = vue.computed(() => context.node?.props || {});
  const model = vue.ref(context.value ?? false);

  function setValue (value) { 
    if( context.attrs?.readonly ) return;

    model.value = !model.value;
    context.node.input(model.value);
  } 

return (_ctx, _cache) => {
  return (vue.openBlock(), vue.createElementBlock("div", {
    class: vue.normalizeClass(["formkit-outer", [props.value.outerClass ?? '']]),
    "data-type": __props.context.type
  }, [
    (__props.context.label)
      ? (vue.openBlock(), vue.createElementBlock("span", {
          key: 0,
          class: vue.normalizeClass(["formkit-label", [props.value.labelClass ?? '']])
        }, vue.toDisplayString(__props.context.label), 3 /* TEXT, CLASS */))
      : vue.createCommentVNode("v-if", true),
    vue.createElementVNode("div", {
      class: vue.normalizeClass(["formkit-wrapper flex items-center cursor-pointer py-2", [props.value.wrapperClass ?? '', __props.context.attrs?.readonly ? 'cursor-not-allowed':'']]),
      onClick: setValue
    }, [
      _hoisted_2$4,
      vue.createElementVNode("div", {
        class: vue.normalizeClass(["rounded-full w-10 h-6 p-0.5 bg-gray-300", {'bg-red-500': !model.value,'bg-green-500': model.value}])
      }, [
        vue.createElementVNode("div", {
          class: vue.normalizeClass(["rounded-full w-5 h-5 bg-white transform mx-auto duration-300 ease-in-out", {'-translate-x-2': !model.value,'translate-x-2': model.value}])
        }, null, 2 /* CLASS */)
      ], 2 /* CLASS */),
      _hoisted_3$3
    ], 2 /* CLASS */),
    (__props.context.help)
      ? (vue.openBlock(), vue.createElementBlock("span", {
          key: 1,
          class: vue.normalizeClass(["formkit-help", [props.value.helpClass ?? '']])
        }, vue.toDisplayString(__props.context.help), 3 /* TEXT, CLASS */))
      : vue.createCommentVNode("v-if", true),
    (_ctx.hasMessages)
      ? (vue.openBlock(), vue.createElementBlock("ul", _hoisted_4$3, [
          (vue.openBlock(true), vue.createElementBlock(vue.Fragment, null, vue.renderList(__props.context.messages, (msg) => {
            return (vue.openBlock(), vue.createElementBlock("li", {
              class: "formkit-message",
              key: msg.key
            }, vue.toDisplayString(msg.value), 1 /* TEXT */))
          }), 128 /* KEYED_FRAGMENT */))
        ]))
      : vue.createCommentVNode("v-if", true)
  ], 10 /* CLASS, PROPS */, _hoisted_1$4))
}
}

};

script$4.__file = "src/components/inputs/toggle.vue";

const _hoisted_1$3 = ["data-type"];
const _hoisted_2$3 = {
  key: 0,
  class: "tag-input"
};
const _hoisted_3$2 = ["onClick"];
const _hoisted_4$2 = ["onKeydown"];
const _hoisted_5$1 = { key: 1 };
const _hoisted_6$1 = {
  key: 2,
  class: "formkit-messages"
};
  
var script$3 = {
  __name: 'tags',
  props: ['context'],
  setup(__props) {

const { context } = __props;
 
   
  const props = vue.computed(() => context.node?.props || {});
  const valid = vue.ref(true);
  const model = vue.ref([]);
  
  function checkFormat(data){
    if( data === null || data === undefined ) {
      model.value = [];  
      valid.value = true;
    } else if( typeof data == 'string' ) {
        try { 
          model.value = JSON.parse(data);
          valid.value = true;
        } catch (e) {
            valid.value = false;
        }
    } else {
        valid.value = false;
    }
  }
  function addTag (event) {
      event.preventDefault();
      var val = event.target.value.trim();
      if (val.length > 0) {
        model.value.push(val);
        event.target.value = '';
        changeData(model.value);
      }
  }
  function removeTag (index) {
      model.value.splice(index, 1);
      changeData(model.value);
  }
  function removeLastTag(event) {
      if (event.target.value.length === 0) {
        removeTag(model.value.length - 1);
        
        changeData(model.value);
      }
  }
  function changeData(data){ 
    if( context.output && context.output == 'json')
      context.node.input(JSON.stringify(data));
    else
      context.node.input(data); 
  }

  vue.onMounted(() => {
    checkFormat(context.value);
  });

return (_ctx, _cache) => {
  return (vue.openBlock(), vue.createElementBlock("div", {
    class: vue.normalizeClass(["formkit-outer", [props.value.outerClass ?? '']]),
    "data-type": __props.context.type
  }, [
    (__props.context.label)
      ? (vue.openBlock(), vue.createElementBlock("span", {
          key: 0,
          class: vue.normalizeClass(["formkit-label", [props.value.labelClass ?? '']])
        }, vue.toDisplayString(__props.context.label), 3 /* TEXT, CLASS */))
      : vue.createCommentVNode("v-if", true),
    vue.createElementVNode("section", {
      class: vue.normalizeClass(["formkit-wrapper", [props.value.wrapperClass ?? '']])
    }, [
      (valid.value)
        ? (vue.openBlock(), vue.createElementBlock("div", _hoisted_2$3, [
            (vue.openBlock(true), vue.createElementBlock(vue.Fragment, null, vue.renderList(model.value, (tag, index) => {
              return (vue.openBlock(), vue.createElementBlock("div", {
                key: index,
                class: "tag-input__tag"
              }, [
                vue.createElementVNode("span", {
                  onClick: $event => (removeTag(index))
                }, "x", 8 /* PROPS */, _hoisted_3$2),
                vue.createTextVNode(" " + vue.toDisplayString(tag), 1 /* TEXT */)
              ]))
            }), 128 /* KEYED_FRAGMENT */)),
            vue.createElementVNode("input", vue.mergeProps({ type: "text" }, __props.context.attributes, {
              placeholder: "Type + Enter",
              class: "tag-input__text",
              onKeydown: [
                vue.withKeys(addTag, ["enter"]),
                vue.withKeys(addTag, ["188"]),
                vue.withKeys(removeLastTag, ["delete"])
              ]
            }), null, 16 /* FULL_PROPS */, _hoisted_4$2)
          ]))
        : vue.createCommentVNode("v-if", true),
      (!valid.value)
        ? (vue.openBlock(), vue.createElementBlock("p", _hoisted_5$1, "Invalid data"))
        : vue.createCommentVNode("v-if", true)
    ], 2 /* CLASS */),
    (__props.context.help)
      ? (vue.openBlock(), vue.createElementBlock("span", {
          key: 1,
          class: vue.normalizeClass(["formkit-help", [props.value.helpClass ?? '']])
        }, vue.toDisplayString(__props.context.help), 3 /* TEXT, CLASS */))
      : vue.createCommentVNode("v-if", true),
    (_ctx.hasMessages)
      ? (vue.openBlock(), vue.createElementBlock("ul", _hoisted_6$1, [
          (vue.openBlock(true), vue.createElementBlock(vue.Fragment, null, vue.renderList(__props.context.messages, (msg) => {
            return (vue.openBlock(), vue.createElementBlock("li", {
              class: "formkit-message",
              key: msg.key
            }, vue.toDisplayString(msg.value), 1 /* TEXT */))
          }), 128 /* KEYED_FRAGMENT */))
        ]))
      : vue.createCommentVNode("v-if", true)
  ], 10 /* CLASS, PROPS */, _hoisted_1$3))
}
}

};

script$3.__scopeId = "data-v-342edb1f";
script$3.__file = "src/components/inputs/tags.vue";

const _hoisted_1$2 = ["data-type"];
const _hoisted_2$2 = {
  key: 0,
  class: "relative"
};
const _hoisted_3$1 = { class: "flex py-2 gap-2" };
const _hoisted_4$1 = ["onClick"];
const _hoisted_5 = /*#__PURE__*/vue.createElementVNode("hr", null, null, -1 /* HOISTED */);
const _hoisted_6 = {
  key: 1,
  class: "relative"
};
const _hoisted_7 = { key: 2 };
const _hoisted_8 = {
  key: 2,
  class: "formkit-messages"
};
  
var script$2 = {
  __name: 'repeater',
  props: ['context'],
  setup(__props) {

const { context = {} } = __props;
  
   
  const props = vue.computed(() => context.node?.props || {});
  vue.ref(true);
  const schema = vue.ref([]);
  const model = vue.ref([]); 
  const rendered = vue.ref(false);
  const schemaObj = vue.computed(() => {
    if( props.value.inline ) return []
    else
      return model.value.map((i, k) => {
        return {
          "$formkit": "group",
          "name": k,  
          "children": [
            {
              "$el": "div",
              "attrs": {"class":"flex py-2 gap-2"},
              "children":[
                {
                  "$el": "div",
                  "attrs": {"class":"w-full"},
                  "children": schema.value
                },
                {
                  "$el":'button',
                  "attrs":{ "type":"button", "class":"p-2", "onclick":() => removeTag(k) },
                  "children": [
                    {
                      "$cmp": script$q,
                      "props": { "class": "h-5", "title":"Remove item" }
                    } 
                  ]
                },
              ]
            },
            {
              "$el": "hr",
              "attrs": {"class":"w-full p-1"},
              "children":""
            }
          ]
        }
      })
  });  
  
  function addTag (event) { 
    var val = props.value.inline === true ? "":({ }); 
    // model.value.push(val)  
    context.node.input([...context.value, val]);  
    model.value = [...context.value, val];
  }

  function removeTag (index) {  
    let data = JSON.parse(JSON.stringify(model.value));
    data = data.filter((i, k) => k != index);
    context.node.input(data);  
    model.value = data;
  }
 
  vue.onMounted(async () => {  
    model.value = [...context.value];
    for(let row of (props.value.schema || []) ){ 
      schema.value.push( await normalizeInput(row) );
    } 
    rendered.value = true;
  });

return (_ctx, _cache) => {
  const _component_FormKit = vue.resolveComponent("FormKit");
  const _component_FormKitSchema = vue.resolveComponent("FormKitSchema");

  return (vue.openBlock(), vue.createElementBlock("div", {
    class: vue.normalizeClass(["formkit-outer", [props.value.outerClass ?? '']]),
    "data-type": __props.context.type
  }, [
    (__props.context.label)
      ? (vue.openBlock(), vue.createElementBlock("span", {
          key: 0,
          class: vue.normalizeClass(["formkit-label", [props.value.labelClass ?? '']])
        }, vue.toDisplayString(__props.context.label), 3 /* TEXT, CLASS */))
      : vue.createCommentVNode("v-if", true),
    vue.createElementVNode("section", {
      class: vue.normalizeClass(["formkit-wrapper", [props.value.wrapperClass ?? '']])
    }, [
      (schema.value && rendered.value && props.value.inline === true)
        ? (vue.openBlock(), vue.createElementBlock("div", _hoisted_2$2, [
            (vue.openBlock(true), vue.createElementBlock(vue.Fragment, null, vue.renderList(__props.context.value, (row, i) => {
              return (vue.openBlock(), vue.createElementBlock(vue.Fragment, { key: i }, [
                vue.createElementVNode("div", _hoisted_3$1, [
                  (![null,undefined].includes(model.value[i]))
                    ? (vue.openBlock(), vue.createBlock(_component_FormKit, vue.mergeProps({ key: 0 }, vue.unref(_).omit(schema.value[0], ['$formkit']), {
                        modelValue: model.value[i],
                        "onUpdate:modelValue": $event => ((model.value[i]) = $event)
                      }), null, 16 /* FULL_PROPS */, ["modelValue", "onUpdate:modelValue"]))
                    : vue.createCommentVNode("v-if", true),
                  vue.createElementVNode("button", {
                    type: "button",
                    class: "flex justify-between items-center gap-2 p-2",
                    onClick: $event => (removeTag(i)),
                    title: "Remove item"
                  }, [
                    vue.createVNode(vue.unref(script$q), { class: "h-5" })
                  ], 8 /* PROPS */, _hoisted_4$1)
                ]),
                _hoisted_5
              ], 64 /* STABLE_FRAGMENT */))
            }), 128 /* KEYED_FRAGMENT */))
          ]))
        : (schema.value && rendered.value && !props.value.inline)
          ? (vue.openBlock(), vue.createElementBlock("div", _hoisted_6, [
              vue.createVNode(_component_FormKitSchema, { schema: schemaObj.value }, null, 8 /* PROPS */, ["schema"])
            ]))
          : (vue.openBlock(), vue.createElementBlock("span", _hoisted_7, "error"))
    ], 2 /* CLASS */),
    vue.createElementVNode("button", {
      type: "button",
      class: "flex justify-start items-center gap-2 py-2",
      onClick: addTag,
      title: "Add new item"
    }, [
      vue.createVNode(vue.unref(script$p), { class: "h-5" }),
      vue.createTextVNode(" Add ")
    ]),
    (__props.context.help)
      ? (vue.openBlock(), vue.createElementBlock("span", {
          key: 1,
          class: vue.normalizeClass(["formkit-help", [props.value.helpClass ?? '']])
        }, vue.toDisplayString(__props.context.help), 3 /* TEXT, CLASS */))
      : vue.createCommentVNode("v-if", true),
    (_ctx.hasMessages)
      ? (vue.openBlock(), vue.createElementBlock("ul", _hoisted_8, [
          (vue.openBlock(true), vue.createElementBlock(vue.Fragment, null, vue.renderList(__props.context.messages, (msg) => {
            return (vue.openBlock(), vue.createElementBlock("li", {
              class: "formkit-message",
              key: msg.key
            }, vue.toDisplayString(msg.value), 1 /* TEXT */))
          }), 128 /* KEYED_FRAGMENT */))
        ]))
      : vue.createCommentVNode("v-if", true)
  ], 10 /* CLASS, PROPS */, _hoisted_1$2))
}
}

};

script$2.__file = "src/components/inputs/repeater.vue";

const _hoisted_1$1 = ["data-type"];
const _hoisted_2$1 = {
  key: 0,
  class: "prefix p-2"
};
const _hoisted_3 = {
  key: 1,
  class: "suffix p-2"
};
const _hoisted_4 = {
  key: 2,
  class: "formkit-messages"
};
  
var script$1 = {
  __name: 'currency',
  props: ['context'],
  setup(__props) {

const { context } = __props;
 
   
  const props = vue.computed(() => context.node?.props || {});
  const slots = vue.computed(() => props.value?.slots || {});
  const field = vue.ref();
  vue.ref([]);
  
  const formataMoedaInput = () => {
    field.value = formatarMoeda(field.value);
    
    context.node.input( unformat(field.value) );
  };
  
  const formatarMoeda = (valor) => {
    valor = valor + '';
    valor = parseInt( valor.replace(/[\D]+/g, '') );
    valor = valor + '';
    valor = valor.replace(/[\D]+/g, '');
    valor = valor.replace(/([0-9]{2})$/g, ',$1');
    
    if (valor.length === 3) valor = '0'+valor;
    else if (valor.length === 1) valor = '0,0'+valor;
    
    if( valor.length > 6 )
      valor = valor.replace(/([0-9]{3}),([0-9]{2}$)/g, ".$1,$2");
    if( valor.length > 10 )
      valor = valor.replace(/([0-9]{3}),([0-9]{3}),([0-9]{2}$)/g, ".$1.$2,$3");
    if( valor.length > 14 )
      valor = valor.replace(/([0-9]{3}),([0-9]{3}),([0-9]{3}),([0-9]{2}$)/g, ".$1.$2.$3,$4"); 
    if( valor == 'NaN' ) return ''
    
    return valor
  };
  
  const unformat = (valor) => {
    valor = valor + '';
    valor = valor.replace(/[^0-9,]+/g, ''); 
    valor = valor.replace(',', '.'); 
    return (valor === NaN || valor == 'NaN') ? '' : +valor
  };
  
  const parseNumber = (valor = '0') => {
    const splitValor = (valor + '').split('.');
    
    if( !splitValor[1] ) ;
    else if (splitValor[1].length === 1) valor += '0';
    
    return valor+''.replace(/\D/g, '') || 0
  };
  
  vue.watch(() => context.value, (newVal, oldVal) => {
     if( newVal && unformat(field.value) !== newVal ){
       field.value = parseNumber(newVal);
       field.value = formatarMoeda(field.value);
     }
  });
  
  vue.onMounted(() => {
    field.value = parseNumber(context.value); 
  });

return (_ctx, _cache) => {
  return (vue.openBlock(), vue.createElementBlock("div", {
    class: vue.normalizeClass(["formkit-outer", [props.value.outerClass ?? '']]),
    "data-type": __props.context.type
  }, [
    (__props.context.label)
      ? (vue.openBlock(), vue.createElementBlock("span", {
          key: 0,
          class: vue.normalizeClass(["formkit-label", [props.value.labelClass ?? '']])
        }, vue.toDisplayString(__props.context.label), 3 /* TEXT, CLASS */))
      : vue.createCommentVNode("v-if", true),
    vue.createElementVNode("div", {
      class: vue.normalizeClass(["formkit-wrapper flex items-center", [props.value.wrapperClass ?? '']])
    }, [
      (slots.value.prefix)
        ? (vue.openBlock(), vue.createElementBlock("span", _hoisted_2$1, vue.toDisplayString(slots.value.prefix), 1 /* TEXT */))
        : vue.createCommentVNode("v-if", true),
      (vue.openBlock(), vue.createBlock(vue.resolveDynamicComponent(_ctx.$slots.prefix))),
      vue.withDirectives(vue.createElementVNode("input", vue.mergeProps({ type: "text" }, __props.context.attributes, {
        class: "formkit-input",
        "onUpdate:modelValue": _cache[0] || (_cache[0] = $event => ((field).value = $event)),
        onKeyup: formataMoedaInput,
        onBlur: _cache[1] || (_cache[1] = (...args) => (__props.context.blur && __props.context.blur(...args))),
        autocomplete: "off",
        maxlength: "16"
      }), null, 16 /* FULL_PROPS */), [
        [vue.vModelText, field.value]
      ]),
      (vue.openBlock(), vue.createBlock(vue.resolveDynamicComponent(_ctx.$slots.suffix))),
      (slots.value.suffix)
        ? (vue.openBlock(), vue.createElementBlock("span", _hoisted_3, vue.toDisplayString(slots.value.suffix), 1 /* TEXT */))
        : vue.createCommentVNode("v-if", true)
    ], 2 /* CLASS */),
    (__props.context.help)
      ? (vue.openBlock(), vue.createElementBlock("span", {
          key: 1,
          class: vue.normalizeClass(["formkit-help", [props.value.helpClass ?? '']])
        }, [
          vue.createTextVNode(vue.toDisplayString(__props.context.help) + " ", 1 /* TEXT */),
          (vue.openBlock(), vue.createBlock(vue.resolveDynamicComponent(_ctx.$slots.help)))
        ], 2 /* CLASS */))
      : vue.createCommentVNode("v-if", true),
    (_ctx.hasMessages)
      ? (vue.openBlock(), vue.createElementBlock("ul", _hoisted_4, [
          (vue.openBlock(true), vue.createElementBlock(vue.Fragment, null, vue.renderList(__props.context.messages, (msg) => {
            return (vue.openBlock(), vue.createElementBlock("li", {
              class: "formkit-message",
              key: msg.key
            }, vue.toDisplayString(msg.value), 1 /* TEXT */))
          }), 128 /* KEYED_FRAGMENT */))
        ]))
      : vue.createCommentVNode("v-if", true)
  ], 10 /* CLASS, PROPS */, _hoisted_1$1))
}
}

};

script$1.__file = "src/components/inputs/currency.vue";

const _hoisted_1 = { class: "border-b-2 border-zinc-300 py-1" };
const _hoisted_2 = ["onClick"];

var script = {
  __name: 'object',
  props: ['context'],
  setup(__props) {

const { context } = __props;
 
 
 
const props = vue.computed(() => context.node?.props || {}); 
const keys = vue.ref(Object.keys(context.value));
const model = vue.ref(Object.values(context.value));
const modelTypes = vue.ref([]);
const render = vue.ref(true);
const types = {
  'text':'Text',
  'number':'Number',
  'toggle':'Boolean', 
};

function forceRender(){
  render.value = false;
  vue.nextTick(() => {
    render.value = true;
  });
}

function addItem(){
  keys.value.push(' ');
  model.value.push(' ');
  forceRender();
  setValue();
}

function removeItem(k){
  keys.value.splice(k, 1);
  model.value.splice(k, 1); 
  forceRender();
  setValue();
}
 
async function setValue () { 
  vue.nextTick(() => {
    context.node.input( 
      _.zipObject(keys.value, model.value) 
    );  
  });
}  

return (_ctx, _cache) => {
  const _component_FormKit = vue.resolveComponent("FormKit");

  return (render.value)
    ? (vue.openBlock(), vue.createBlock(_component_FormKit, {
        key: 0,
        type: "group",
        outerClass: "formkit-object pt-2"
      }, {
        default: vue.withCtx(() => [
          vue.createElementVNode("p", _hoisted_1, vue.toDisplayString(props.value.label ?? __props.context.meta), 1 /* TEXT */),
          (vue.openBlock(true), vue.createElementBlock(vue.Fragment, null, vue.renderList(keys.value, (idx, k) => {
            return (vue.openBlock(), vue.createElementBlock("div", {
              class: "flex gap-2 py-2 items-center pl-2",
              key: k
            }, [
              vue.createVNode(_component_FormKit, {
                modelValue: keys.value[k],
                "onUpdate:modelValue": $event => ((keys.value[k]) = $event),
                onInput: setValue
              }, null, 8 /* PROPS */, ["modelValue", "onUpdate:modelValue"]),
              vue.createTextVNode(": "),
              vue.createVNode(_component_FormKit, {
                modelValue: model.value[k],
                "onUpdate:modelValue": $event => ((model.value[k]) = $event),
                onInput: setValue,
                type: modelTypes.value[k] ?? 'text'
              }, null, 8 /* PROPS */, ["modelValue", "onUpdate:modelValue", "type"]),
              vue.createVNode(_component_FormKit, {
                type: "select",
                options: types,
                modelValue: modelTypes.value[k],
                "onUpdate:modelValue": $event => ((modelTypes.value[k]) = $event),
                onChange: forceRender
              }, null, 8 /* PROPS */, ["modelValue", "onUpdate:modelValue"]),
              vue.createElementVNode("button", {
                type: "button",
                onClick: e => removeItem(k)
              }, [
                vue.createVNode(vue.unref(script$q), { class: "h-5" })
              ], 8 /* PROPS */, _hoisted_2)
            ]))
          }), 128 /* KEYED_FRAGMENT */)),
          vue.createElementVNode("button", {
            type: "button",
            onClick: addItem,
            class: "block w-full py-2 bg-zinc-100 hover:bg-zinc-200"
          }, [
            vue.createVNode(vue.unref(script$p), { class: "h-4 m-auto" })
          ])
        ]),
        _: 1 /* STABLE */
      }))
    : vue.createCommentVNode("v-if", true)
}
}

};

script.__file = "src/components/inputs/object.vue";

let arrOptions = [];
const searchFeature = async (node) => {
  // const { $axios } = useNuxtApp()
  // const schemaModel = inject('model')
  const $axios = axios; 
  const Instance = ResourceClass({ $axios });   

  const getOptions = async ({ rootApi, fieldLabel, fieldValue, ...data }) => {
    try{   
      if( rootApi ){ 
        rootApi = interpolate(rootApi, { data: node.value });
        Instance.setModel({ api:{ ...data,  rootApi, resource:{} } });

        let { rows } = await Instance.getData({ data: node.value}); 

        arrOptions = rows && rows.map((i, k) => ({ 
            label: _.get(i, fieldLabel, i.toString()), 
            value: _.get(i, fieldValue, k)
          }) 
        );  
      }
    }catch(e){
        alert('Erro to get data from '+ rootApi);
        console.log('Erro select input', e);
    }
  };

  const init = async () => { 
    console.log('pre init', node.props);
    if( !node.props?.model ) return 'DISMISSED';
    node.props.options = node.props.options ?? [];

    let { model = {}, overwrite = {} } = node.props;
    model = mergeDeep(model, overwrite);
    if( model && typeof model  == 'string' ) 
      return console.error('model string not loaded')
    
    await getOptions(model.api);
  };
 
  node.on('created', async () => {
    await init();
    // Ensure our matches prop starts as an array.
    node.props.matches = [];
    node.props.selection = '';
    node.props.active = ''; 
    node.props.allOptions = [...arrOptions, ...node.props.options].map((i, k) => {
      if( typeof i == 'string' )
         i = { value:k, label:i };
      return i
    });  

    if( node.value ){
      let preSelected = node.props.allOptions.find(i => i.value == node.value);
      node.props.active = preSelected?.label ?? '??';
    }
    // When we actually have an value to set:
    const setValue = async (e) => {
      if (e && typeof e.preventDefault === 'function') e.preventDefault();
      let selected = node.props.selection;
      let modelFound = node.props.allOptions.find(
        i => {
          return i.label === selected
        }
      );
      
      node.input( modelFound?.value );
      node.props.active = modelFound?.label ?? selected;
      node.props.selection = '';
      node.props.searchValue = '';

      await new Promise((r) => setTimeout(r, 50)); // "next tick"

      if ( document.querySelector('input#' + node.props.id) ) {
        document.querySelector('input#' + node.props.id).focus();
      }
    };

    // Perform a soft selection, this is shown as a highlight in the dropdown
    const select = (delta) => { 
      const available = node.props.matches;
      let idx = available.indexOf(node.props.selection) + delta;
      if (idx >= available.length) {
        idx = 0;
      } else if (idx < 0) {
        idx = available.length - 1;
      }
      node.props.selection = available[idx];
    };

    // Add some new "handlers" for our autocomplete. The handlers object is
    // just a conventionally good place to put event handlers. Auto complete
    // inputs always have to deal with lots of keyboard events, so that logic
    // is registered here.
    Object.assign(node.context.handlers, {
      setValue,
      selection: (e) => {
        // This handler is called when entering data into the search input.
        switch (e.key) {
          case 'Enter':
            return setValue()
          case 'ArrowDown':
            e.preventDefault();
            return select(1)
          case 'ArrowUp':
            e.preventDefault();
            return select(-1)
        }
      },
      search(e) {
        node.props.searchValue = e.target.value;
      },
      hover: (e) => {
        node.props.selection = e.target.textContent;
      },
      unhover: (e) => {
        if (e.target.textContent === node.props.selection) {
          node.props.selection = '';
        }
      },
    });
 
  });

  // Perform filtering when the search value changes
  node.on('prop:searchValue', ({ payload: value }) => {
    const results = node.props.allOptions.filter((option) => { 
      return option.label.toLowerCase().startsWith(value.toLowerCase())
    });
    if (!results.length) results.push({ label:'No matches' });
    node.props.matches = results;
  });
};

const schema$3 = [ 
  {
    if: "$value && $active",
    then: [
      {
        $el: 'a',
        attrs: {
          id: '$id',
          href: '#',
          class: 'block border-2 border-black p-2',
          onClick: '$handlers.setValue',
          title: 'Click to change'
        },
        children: '$active',
      },
    ],
    else: [
      {
        $el: 'input',
        bind: '$attrs',
        attrs: {
          id: '$id',
          class: '$classes.input',
          onKeydown: '$handlers.selection',
          onInput: '$handlers.search',
          value: '$searchValue',
        },
      },
      {
        $el: 'ul',
        if: '$matches.length < $allOptions.length',
        attrs: {
          class: '$classes.dropdown',
        },
        children: [
          {
            $el: 'li',
            for: ['match', '$matches'],
            attrs: {
              'data-selected': {
                if: '$selection === $match.value',
                then: 'true',
                else: 'false',
              },
              class: 'formkit-dropdown-item border-b border-2 cursor-pointer p-1',
              onClick: '$handlers.setValue',
              onMouseenter: '$handlers.hover',
              onMouseleave: '$handlers.unhover',
            },
            children: '$match.label',
          },
        ],
      },
    ],
  }, 
];

const autocomplete = vue$1.createInput(schema$3, {
  props: ['options', 'allOptions', 'matches', 'selection', 'searchValue', 'active', 'overwrite', 'model'],
  features: [searchFeature],
});

const features$2 = (node) => {
  const $axios = axios;
  // const { $axios } = useNuxtApp()
  vue.inject('model');
  const Instance = ResourceClass({ $axios });
   
  // We wait for our node to be fully  "created" before we start to add our
  // handlers to ensure the core Vue plugin has added its context object:
  node.on('created', () => {  
    // Ensure our matches prop starts as an array.
    const upload = async (e) => { 
      console.debug('upload change');
      let file = e.target.files[0];
      let { model = {}, overwrite = {} } = node.props;
      
      const formData = new FormData();
      formData.append('file', file);

      // model = URL.createObjectURL(file);
      model = mergeDeep(model, overwrite);
      Instance.setModel(model);
 
      return await Instance.saveData( 
        formData
      )
      .then(({data}) => {
        if( data )
          node.input( _.get(data, _.get(model, 'api.wrapData', '[0].src'), JSON.stringify(data)) ); 
        else {
            alert('Upload error');
            console.error(data);
        }
      })
      .catch((err) => {
        alert(err.message || err);
        console.error(err); 
      })
    }; 

    const selectFile = (e) => {
      if (e && typeof e.preventDefault === 'function') e.preventDefault();
      
      console.debug('Select file clicked');
      var input = document.createElement('input');
      input.type = 'file';
      input.name = 'upload';
      input.onchange = e => upload(e);
      input.click();
    };
    // Add some new "handlers" for our autocomplete. The handlers object is
    // just a conventionally good place to put event handlers. Auto complete
    // inputs always have to deal with lots of keyboard events, so that logic
    // is registered here.
    Object.assign(node.context.handlers, {
      'selectFile': selectFile, 
      hover: (e) => {
        node.props.selection = e.target.textContent;
      },
      unhover: (e) => {
        if (e.target.textContent === node.props.selection) {
          node.props.selection = '';
        }
      },
    });
 
  });

};

const schema$2 = [ 
  {
    $el: 'div',
    attrs: {  
      class: 'flex justify-between items-center gap-2 border-y border-1 ',  
    },
    children: [ 
      {
        if: '$value',
        then: [
          {
            if: '$baseUrl',
            then:[
              {
                $el: 'img',
                attrs: {
                  id: '$id',
                  src: '$baseUrl + $value',
                  class: 'w-12',
                },
                children: ''
              }
            ],
            else:{
                $el: 'img',
                attrs: {
                  id: '$id',
                  src: '$value',
                  class: 'w-14',
                },
                children: '',
            } 
          }
        ],
      }, 
      {   
        $el: 'input',
        attrs: {
          name: 'imageUrl',
          onInput: '$handlers.DOMInput',
          onBlur: '$handlers.blur',
          value: '$_value',
          class: 'formkit-input'
        },
      }, 
      {
        if: '$model.api.rootApi',
        then: [
          {
            $el: 'a',
            attrs: {
              id: 'upload',
              href: '#',
              class: 'p-2',
              onClick: '$handlers.selectFile',
              title: 'Upload new'
            },
            children: [
              {
                $el:'svg',
                attrs:{
                  xmlns:"http://www.w3.org/2000/svg",
                  viewBox:"0 0 512 512",
                  class: 'w-4'
                },
                children:[
                  {
                    $el: 'path',
                    attrs:{
                      d:"M288 109.3V352c0 17.7-14.3 32-32 32s-32-14.3-32-32V109.3l-73.4 73.4c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3l128-128c12.5-12.5 32.8-12.5 45.3 0l128 128c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L288 109.3zM64 352H192c0 35.3 28.7 64 64 64s64-28.7 64-64H448c35.3 0 64 28.7 64 64v32c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V416c0-35.3 28.7-64 64-64zM432 456c13.3 0 24-10.7 24-24s-10.7-24-24-24s-24 10.7-24 24s10.7 24 24 24z"
                    }
                  }
                ]
              }
            ]
          }, 
        ]
      }
    ]
  }
];
 
const image = vue$1.createInput(schema$2, {
  props: ['overwrite', 'model', 'baseUrl'],
  features: [features$2],
});

const features$1 = (node) => {
  let loading = false; 
  const $axios = axios; 
  // const schemaModel = inject('model')
  const Instance = ResourceClass({ $axios }); 
  node.props.arrOptions = [];

  const getOptions = async ({ rootApi, fieldLabel, fieldValue, ...data }) => {
    try{  
      console.log('getOptions', { rootApi, fieldLabel, fieldValue, ...data });
      if( rootApi ){
        loading = true;
        rootApi = interpolate(rootApi, { data: node.value });
        Instance.setModel({ api:{ ...data,  rootApi, resource:{} } });

        let { rows } = await Instance.getData({ data: node.value}); 

        node.props.arrOptions = rows && rows.map((i, k) => ({ 
            label: _.get(i, fieldLabel, i.toString()), 
            value: _.get(i, fieldValue, k)
          }) 
        ); 

        loading = false; 
      }
    }catch(e){
        alert('Erro to get data from '+ rootApi);
        console.log('Erro select input', e);
    }
  };

  const init = async () => { 
    let { model = {}, overwrite = {} } = node.props.attrs;
    model = mergeDeep(model, overwrite);
    if( model && typeof model  == 'string' ) return console.error('model string not loaded')
    
    getOptions(model.api);
  };
  
  init(); 
  // We wait for our node to be fully  "created" before we start to add our
  // handlers to ensure the core Vue plugin has added its context object:
  node.on('created', () => {  
    node.props.arrOptions = node.props.options;

    Object.assign(node.context.handlers, { 
      setValue: e => {
        node.input(e); 
      }, 
      refresh: () => { 
        let { model = {}, overwrite = {} } = node.props;
        model = mergeDeep(model, overwrite);
        if( model && typeof model  == 'string' ) return console.error('model string not loaded')
        
        getOptions(model.api);
      },  
    });
 
  });
};
 
const schema$1 = [  
  { 
    $el: 'div',
    attrs: {    
      class: 'formkit-inner flex border-2 border-black',
    },
    children:[
      {   
        $el: 'select',
        attrs: { 
          name: '$context.name',
          id: '$context.id',
          oninput: '$handlers.DOMInput', 
          value: '$_value',
          class: 'formkit-input border-0',
        },
        children:[
          {
            $el: 'option',
            for: ['item', '$arrOptions'],
            attrs:{
              value: '$item.value'
            },
            children: '$item.label'
          }
        ]
      }, 
      {
        $el: 'button', 
        attrs:{
          type: 'button',
          onClick: '$handlers.refresh',
          title: "Refresh list"
        },
        children: [
          {
            $el:'svg',
            attrs:{
              xmlns:"http://www.w3.org/2000/svg",
              viewBox:"0 0 512 512",
              class: 'w-4 m-2'
            },
            children:[
              {
                $el: 'path',
                attrs:{
                  d:"M105.1 202.6c7.7-21.8 20.2-42.3 37.8-59.8c62.5-62.5 163.8-62.5 226.3 0L386.3 160H336c-17.7 0-32 14.3-32 32s14.3 32 32 32H463.5c0 0 0 0 0 0h.4c17.7 0 32-14.3 32-32V64c0-17.7-14.3-32-32-32s-32 14.3-32 32v51.2L414.4 97.6c-87.5-87.5-229.3-87.5-316.8 0C73.2 122 55.6 150.7 44.8 181.4c-5.9 16.7 2.9 34.9 19.5 40.8s34.9-2.9 40.8-19.5zM39 289.3c-5 1.5-9.8 4.2-13.7 8.2c-4 4-6.7 8.8-8.1 14c-.3 1.2-.6 2.5-.8 3.8c-.3 1.7-.4 3.4-.4 5.1V448c0 17.7 14.3 32 32 32s32-14.3 32-32V396.9l17.6 17.5 0 0c87.5 87.4 229.3 87.4 316.7 0c24.4-24.4 42.1-53.1 52.9-83.7c5.9-16.7-2.9-34.9-19.5-40.8s-34.9 2.9-40.8 19.5c-7.7 21.8-20.2 42.3-37.8 59.8c-62.5 62.5-163.8 62.5-226.3 0l-.1-.1L125.6 352H176c17.7 0 32-14.3 32-32s-14.3-32-32-32H48.4c-1.6 0-3.2 .1-4.8 .3s-3.1 .5-4.6 1z"
                }
              }
            ]
          }
        ] 
      }
    ]
  } 
]; 

const dynamic = vue$1.createInput(schema$1, {
  props: ['overwrite', 'model', 'options', 'arrOptions'],
  features: [features$1],
});

const features = (node) => {
  let loading = false; 
  const $axios = axios;
  // const { $axios } = useNuxtApp()
  // const schemaModel = inject('model')
  const Instance = ResourceClass({ $axios }); 
  node.props.arrOptions = [];
  node.props.arrFiltered = [];

  if(!Array.isArray(node.value))
    node.input([]);

  const getOptions = async ({ rootApi, fieldLabel, fieldValue, ...data }) => {
    try{  
      console.debug('getOptions', { rootApi, fieldLabel, fieldValue, ...data });
      if( rootApi ){
        loading = true;
        rootApi = interpolate(rootApi, { data: node.value });
        Instance.setModel({ api:{ ...data,  rootApi, resource:{} } });

        let { rows } = await Instance.getData({ data: node.value }); 

        node.props.arrOptions = rows && rows.map((i, k) => ({ 
            label: _.get(i, fieldLabel, i.toString()), 
            value: _.get(i, fieldValue, k)
          }) 
        ); 

        node.props.arrFiltered = node.props.arrOptions;
        loading = false; 
      }
    }catch(e){
        alert('Erro to get data from '+ rootApi);
        console.log('Erro select input', e);
    }
  };

  const init = async () => { 
    let { model = {}, overwrite = {} } = node.props.attrs;
    model = mergeDeep(model, overwrite);
    if( model && typeof model  == 'string' ) return console.error('model string not loaded')
    
    getOptions(model.api);
  };
  
  init(); 
  // We wait for our node to be fully  "created" before we start to add our
  // handlers to ensure the core Vue plugin has added its context object:
  node.on('created', () => {  
    node.props.arrOptions = node.props.options ?? [];

    Object.assign(node.context.handlers, { 
      setValue: e => {
        node.input(e); 
      }, 
      checked: e => {
        let item = e?.target?.value;
        let exists = node.value.findIndex(i => i == item);
        if( exists >= 0 ){
          node.input( node.value.splice(exists, 1) ); 
        }else {
          node.input([...node.value, item]);
        } 
      },
      isChecked: e => {  
        return node.value.some(i => e == i)
      },
      filter: e => {
        let busca = e.target?.value;
        if( busca )
          node.props.arrFiltered = node.props.arrOptions.filter(
            i => i.label?.toLowerCase().startsWith(busca?.toLowerCase())
          );
        else
          node.props.arrFiltered = node.props.arrOptions;
      },
      refresh: () => { 
        let { model = {}, overwrite = {} } = node.props;
        model = mergeDeep(model, overwrite);
        if( model && typeof model  == 'string' ) return console.error('model string not loaded')
        
        getOptions(model.api);
      },  
    });
 
  });
};
 
const schema = [  
  {
    $el: 'div',
    attrs: {
      class: 'w-full'
    },
    children:[
      {   
        $el: 'input',
        attrs: { 
          type: 'search',
          name: '$context.name',
          id: '$context.id',
          oninput: '$handlers.filter',  
          class: 'formkit-input w-full',
          placeholder: 'filter'
        }, 
      },
      {
        $el: 'div', 
        attrs: {
          class: 'grid grid-cols-3 py-2 gap-2 w-full max-h-28 overflow-y-auto overflow-x-hidden'
        },
        children:[
          {
            $el: 'label',
            for: ['item', '$arrFiltered'],
            attrs:{
              for: '#$item.value', 
              value: '$item.value',
              class: 'flex items-center gap-2 p-2',
            },
            children: [ 
              {
                $el: 'input', 
                attrs: {
                  type: 'checkbox',
                  class: 'flex flex-col',
                  value: '$item.value',
                  onclick: '$handlers.checked',
                  checked: '$handlers.isChecked($item.value)'
                },
              },
              {
                $el: 'p',  
                attrs: {
                  class: 'whitespace-nowrap', 
                },
                children: '$item.label'
              }
            ]
          }
        ]
      } 
    ]
  }
]; 

const multiple = vue$1.createInput(schema, {
  props: ['overwrite', 'model', 'options', 'arrOptions', 'arrFiltered'],
  features: [features],
});

// Custom inputs
// import CodeInput from './code.vue'
// import JsonInput from './json.vue'
// import EditorInput from './editor.vue'

var inputs = {
  // CodeInput, 
  // EditorInput,
  ToggleInput: script$4,
  TagsInput: script$3,
  RepeaterInput: script$2,
  // DateRangeInput: DateRange,
  CurrencyInput: script$1,
  GridInput: script$6,
  FormInput: script$5,
  ObjectInput: script,
  AutocompleteInput: autocomplete,
  ImageInput: image,
  DynamicInput: dynamic,
  MultipleInput: multiple, 
};

const inputByComponent = (comp, type = 'input', props = []) => { 
  return {
    // Node type: input, group, or list.
    type: type,
    // Schema to render (schema object or function that returns an object)
    schema: [],
    // A Vue component to render (use schema _OR_ component, but not both)
    component: comp,
    // (optional) Input specific props the <FormKit> component should accept.
    // should be an array of camelCase strings
    props: props,
    // (optional) Array of functions that receive the node.
    features: []
  }
};

const plugin = {
  install (Vue) {
    for (const prop in components) {
      if (components.hasOwnProperty(prop)) {
        const component = components[prop];
        // console.log(`Crud${component.__name}`)
        Vue.component(`Crud${component.__name}`, component);
      }
    }
  }
};

const {
  CodeInput,
  JsonInput,
  // EditorInput,
  // DateRangeInput,
  GridInput,
  FormInput,
  ToggleInput,
  TagsInput,
  RepeaterInput,
  CurrencyInput,
  ObjectInput,
  AutocompleteInput,
  ImageInput,
  DynamicInput,
  MultipleInput,
} = inputs; 

const CustomInputs = {
  // 'link': inputByComponent(LinkComponent),
  // 'code': inputByComponent(CodeInput, 'input'),
  // 'json': inputByComponent(JsonInput, 'input'),
  // 'editor': inputByComponent(EditorInput, 'input'),
  // 'daterange': inputByComponent(DateRangeInput, 'input', ['format']), 
  'autocomplete': AutocompleteInput,
  'toggle': inputByComponent(ToggleInput, 'input', ['boolean']),
  'tags': inputByComponent(TagsInput, 'input', ['output']),
  'hasMany': inputByComponent(RepeaterInput, 'list', ['schema','inline']),
  'grid': inputByComponent(GridInput, 'input', ['model','overwrite']), 
  'subform': inputByComponent(FormInput, 'input', ['model','overwrite','resource']), 
  'currency': inputByComponent(CurrencyInput, 'input', ['slots']), 
  'image': ImageInput,
  'dynamic': DynamicInput,
  'multiple': MultipleInput,
  'object': inputByComponent(ObjectInput, 'input', ['slots']), 
};

const Pluggable = plugin;

exports.CustomInputs = CustomInputs;
exports.Pluggable = Pluggable;
