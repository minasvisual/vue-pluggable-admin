'use strict';

var vue = require('vue');
var _ = require('lodash');
var axios = require('axios');
var deepmerge = require('deepmerge');
var moment = require('moment');

const _hoisted_1$h = {
  xmlns: "http://www.w3.org/2000/svg",
  viewBox: "0 0 320 512"
};
const _hoisted_2$d = /*#__PURE__*/vue.createElementVNode("path", { d: "M9.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l192 192c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L77.3 256 246.6 86.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-192 192z" }, null, -1 /* HOISTED */);
const _hoisted_3$3 = [
  _hoisted_2$d
];

function render$d(_ctx, _cache) {
  return (vue.openBlock(), vue.createElementBlock("svg", _hoisted_1$h, _hoisted_3$3))
}

const script$h = {};


script$h.render = render$d;
script$h.__file = "src/components/icons/ChevronLeft.vue";

const _hoisted_1$g = {
  xmlns: "http://www.w3.org/2000/svg",
  viewBox: "0 0 320 512"
};
const _hoisted_2$c = /*#__PURE__*/vue.createElementVNode("path", { d: "M310.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-192 192c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L242.7 256 73.4 86.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l192 192z" }, null, -1 /* HOISTED */);

function render$c(_ctx, _cache) {
  return (vue.openBlock(), vue.createElementBlock("svg", _hoisted_1$g, [
    vue.createCommentVNode("! Font Awesome Pro 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. "),
    _hoisted_2$c
  ]))
}

const script$g = {};


script$g.render = render$c;
script$g.__file = "src/components/icons/ChevronRight.vue";

const _hoisted_1$f = {
  xmlns: "http://www.w3.org/2000/svg",
  viewBox: "0 0 384 512"
};
const _hoisted_2$b = /*#__PURE__*/vue.createElementVNode("path", { d: "M169.4 470.6c12.5 12.5 32.8 12.5 45.3 0l160-160c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L224 370.8 224 64c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 306.7L54.6 265.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l160 160z" }, null, -1 /* HOISTED */);

function render$b(_ctx, _cache) {
  return (vue.openBlock(), vue.createElementBlock("svg", _hoisted_1$f, [
    vue.createCommentVNode("! Font Awesome Pro 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. "),
    _hoisted_2$b
  ]))
}

const script$f = {};


script$f.render = render$b;
script$f.__file = "src/components/icons/ArrowDown.vue";

const _hoisted_1$e = {
  xmlns: "http://www.w3.org/2000/svg",
  viewBox: "0 0 384 512"
};
const _hoisted_2$a = /*#__PURE__*/vue.createElementVNode("path", { d: "M214.6 41.4c-12.5-12.5-32.8-12.5-45.3 0l-160 160c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L160 141.2V448c0 17.7 14.3 32 32 32s32-14.3 32-32V141.2L329.4 246.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3l-160-160z" }, null, -1 /* HOISTED */);

function render$a(_ctx, _cache) {
  return (vue.openBlock(), vue.createElementBlock("svg", _hoisted_1$e, [
    vue.createCommentVNode("! Font Awesome Pro 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. "),
    _hoisted_2$a
  ]))
}

const script$e = {};


script$e.render = render$a;
script$e.__file = "src/components/icons/ArrowUp.vue";

const _hoisted_1$d = {
  xmlns: "http://www.w3.org/2000/svg",
  viewBox: "0 0 512 512"
};
const _hoisted_2$9 = /*#__PURE__*/vue.createElementVNode("path", { d: "M441 58.9L453.1 71c9.4 9.4 9.4 24.6 0 33.9L424 134.1 377.9 88 407 58.9c9.4-9.4 24.6-9.4 33.9 0zM209.8 256.2L344 121.9 390.1 168 255.8 302.2c-2.9 2.9-6.5 5-10.4 6.1l-58.5 16.7 16.7-58.5c1.1-3.9 3.2-7.5 6.1-10.4zM373.1 25L175.8 222.2c-8.7 8.7-15 19.4-18.3 31.1l-28.6 100c-2.4 8.4-.1 17.4 6.1 23.6s15.2 8.5 23.6 6.1l100-28.6c11.8-3.4 22.5-9.7 31.1-18.3L487 138.9c28.1-28.1 28.1-73.7 0-101.8L474.9 25C446.8-3.1 401.2-3.1 373.1 25zM88 64C39.4 64 0 103.4 0 152V424c0 48.6 39.4 88 88 88H360c48.6 0 88-39.4 88-88V312c0-13.3-10.7-24-24-24s-24 10.7-24 24V424c0 22.1-17.9 40-40 40H88c-22.1 0-40-17.9-40-40V152c0-22.1 17.9-40 40-40H200c13.3 0 24-10.7 24-24s-10.7-24-24-24H88z" }, null, -1 /* HOISTED */);

function render$9(_ctx, _cache) {
  return (vue.openBlock(), vue.createElementBlock("svg", _hoisted_1$d, [
    vue.createCommentVNode("! Font Awesome Pro 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. "),
    _hoisted_2$9
  ]))
}

const script$d = {};


script$d.render = render$9;
script$d.__file = "src/components/icons/Pencil.vue";

const _hoisted_1$c = {
  xmlns: "http://www.w3.org/2000/svg",
  viewBox: "0 0 448 512"
};
const _hoisted_2$8 = /*#__PURE__*/vue.createElementVNode("path", { d: "M256 80c0-17.7-14.3-32-32-32s-32 14.3-32 32V224H48c-17.7 0-32 14.3-32 32s14.3 32 32 32H192V432c0 17.7 14.3 32 32 32s32-14.3 32-32V288H400c17.7 0 32-14.3 32-32s-14.3-32-32-32H256V80z" }, null, -1 /* HOISTED */);

function render$8(_ctx, _cache) {
  return (vue.openBlock(), vue.createElementBlock("svg", _hoisted_1$c, [
    vue.createCommentVNode("! Font Awesome Pro 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. "),
    _hoisted_2$8
  ]))
}

const script$c = {};


script$c.render = render$8;
script$c.__file = "src/components/icons/Plus.vue";

const _hoisted_1$b = {
  xmlns: "http://www.w3.org/2000/svg",
  viewBox: "0 0 512 512"
};
const _hoisted_2$7 = /*#__PURE__*/vue.createElementVNode("path", { d: "M142.9 142.9c62.2-62.2 162.7-62.5 225.3-1L327 183c-6.9 6.9-8.9 17.2-5.2 26.2s12.5 14.8 22.2 14.8H463.5c0 0 0 0 0 0H472c13.3 0 24-10.7 24-24V72c0-9.7-5.8-18.5-14.8-22.2s-19.3-1.7-26.2 5.2L413.4 96.6c-87.6-86.5-228.7-86.2-315.8 1C73.2 122 55.6 150.7 44.8 181.4c-5.9 16.7 2.9 34.9 19.5 40.8s34.9-2.9 40.8-19.5c7.7-21.8 20.2-42.3 37.8-59.8zM16 312v7.6 .7V440c0 9.7 5.8 18.5 14.8 22.2s19.3 1.7 26.2-5.2l41.6-41.6c87.6 86.5 228.7 86.2 315.8-1c24.4-24.4 42.1-53.1 52.9-83.7c5.9-16.7-2.9-34.9-19.5-40.8s-34.9 2.9-40.8 19.5c-7.7 21.8-20.2 42.3-37.8 59.8c-62.2 62.2-162.7 62.5-225.3 1L185 329c6.9-6.9 8.9-17.2 5.2-26.2s-12.5-14.8-22.2-14.8H48.4h-.7H40c-13.3 0-24 10.7-24 24z" }, null, -1 /* HOISTED */);

function render$7(_ctx, _cache) {
  return (vue.openBlock(), vue.createElementBlock("svg", _hoisted_1$b, [
    vue.createCommentVNode("! Font Awesome Pro 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. "),
    _hoisted_2$7
  ]))
}

const script$b = {};


script$b.render = render$7;
script$b.__file = "src/components/icons/Refresh.vue";

const _hoisted_1$a = {
  xmlns: "http://www.w3.org/2000/svg",
  viewBox: "0 0 448 512"
};
const _hoisted_2$6 = /*#__PURE__*/vue.createElementVNode("path", { d: "M170.5 51.6L151.5 80h145l-19-28.4c-1.5-2.2-4-3.6-6.7-3.6H177.1c-2.7 0-5.2 1.3-6.7 3.6zm147-26.6L354.2 80H368h48 8c13.3 0 24 10.7 24 24s-10.7 24-24 24h-8V432c0 44.2-35.8 80-80 80H112c-44.2 0-80-35.8-80-80V128H24c-13.3 0-24-10.7-24-24S10.7 80 24 80h8H80 93.8l36.7-55.1C140.9 9.4 158.4 0 177.1 0h93.7c18.7 0 36.2 9.4 46.6 24.9zM80 128V432c0 17.7 14.3 32 32 32H336c17.7 0 32-14.3 32-32V128H80zm80 64V400c0 8.8-7.2 16-16 16s-16-7.2-16-16V192c0-8.8 7.2-16 16-16s16 7.2 16 16zm80 0V400c0 8.8-7.2 16-16 16s-16-7.2-16-16V192c0-8.8 7.2-16 16-16s16 7.2 16 16zm80 0V400c0 8.8-7.2 16-16 16s-16-7.2-16-16V192c0-8.8 7.2-16 16-16s16 7.2 16 16z" }, null, -1 /* HOISTED */);

function render$6(_ctx, _cache) {
  return (vue.openBlock(), vue.createElementBlock("svg", _hoisted_1$a, [
    vue.createCommentVNode("! Font Awesome Pro 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. "),
    _hoisted_2$6
  ]))
}

const script$a = {};


script$a.render = render$6;
script$a.__file = "src/components/icons/Trash.vue";

var script$9 = { 
    components: {  ChevronRightIcon: script$g, ChevronLeftIcon: script$h },
    props:{
      pages: {
        type: Number
      },
      actual: {
        type: Number,
        default: 1
      },
    },
    setup(props, { emit }){
      
      const _actual = vue.ref(props.actual);   
      const _pages = vue.ref(props.pages);   

      vue.watch(_pages, (nil) => {
        console.log('novo pages', nil);
      });

      let hasPrev = vue.computed(() => _actual.value > 1);
      let hasNext = vue.computed(() => _actual.value < _pages.value);
      let pageNums = vue.computed(() => {
        let init =  _pages.value > 5; 
        let ends =  _pages.value > 10; 
        let pg = init && ends && _actual.value > 5 && _actual.value < (_pages.value - 5) ? [_actual.value]:[]; 
        return [ ..._.range(1, ( init ? 5:_pages.value)), ...pg, ..._.range( (ends ? (_pages.value - 5):_pages.value), _pages.value)] 
      });
      
      const prev = () => {
        _actual.value = _actual.value > 1 ? (_actual.value - 1) : _actual.value; 
        console.log(
          'prev', typeof _actual.value , 1
        );
        emit('change', _actual.value);
      };

      const next = () => { 
        console.log(
          'next', _actual.value , _pages.value
        );
        _actual.value = _actual.value < _pages.value ? (_actual.value + 1) : _actual.value; 
      
        emit('change', _actual.value);
      };

      const change = (num) => {
        _actual.value = num;
        emit('change', _actual.value);
      };
           
      return {
        change,
        next,
        prev,
        hasPrev,
        hasNext,
        _,
        _actual,
        _pages,
        pageNums
      }
    },
    mounted(){
      this.$watch('pages', () => {
        this._pages = (this.pages + 1);
      }, { immediate: true });
    }
  };

const _hoisted_1$9 = { class: "flex justify-center" };
const _hoisted_2$5 = { "aria-label": "Page navigation example" };
const _hoisted_3$2 = { class: "flex list-style-none" };
const _hoisted_4$1 = {
  key: 0,
  class: "page-item"
};
const _hoisted_5$1 = { "aria-hidden": "true" };
const _hoisted_6$1 = ["onClick"];
const _hoisted_7$1 = {
  key: 1,
  class: "page-item"
};
const _hoisted_8$1 = {
  "aria-hidden": "true",
  class: "text-md"
};

function render$5(_ctx, _cache, $props, $setup, $data, $options) {
  const _component_ChevronLeftIcon = vue.resolveComponent("ChevronLeftIcon");
  const _component_ChevronRightIcon = vue.resolveComponent("ChevronRightIcon");

  return (vue.openBlock(), vue.createElementBlock("div", _hoisted_1$9, [
    vue.createElementVNode("nav", _hoisted_2$5, [
      vue.createElementVNode("ul", _hoisted_3$2, [
        ($setup.hasPrev)
          ? (vue.openBlock(), vue.createElementBlock("li", _hoisted_4$1, [
              vue.createElementVNode("a", {
                class: "page-link relative block py-1.5 px-3 rounded border-0 bg-transparent outline-none transition-all duration-300 rounded text-gray-800 hover:text-gray-800 focus:shadow-none cursor-pointer",
                "aria-label": "Previous",
                onClick: _cache[0] || (_cache[0] = vue.withModifiers((...args) => ($setup.prev && $setup.prev(...args)), ["prevent"]))
              }, [
                vue.createElementVNode("span", _hoisted_5$1, [
                  vue.createVNode(_component_ChevronLeftIcon, {
                    class: "h-6 w-6",
                    "aria-hidden": "true"
                  })
                ])
              ])
            ]))
          : vue.createCommentVNode("v-if", true),
        (vue.openBlock(true), vue.createElementBlock(vue.Fragment, null, vue.renderList($setup.pageNums, (i) => {
          return (vue.openBlock(), vue.createElementBlock("li", {
            class: vue.normalizeClass(["page-item", { 'active': $setup._actual === i }]),
            key: i
          }, [
            vue.createElementVNode("a", {
              class: vue.normalizeClass(["page-link relative block py-1.5 px-3 rounded border-0 outline-none transition-all duration-300 rounded hover:text-gray-800 hover:bg-gray-200 focus:shadow-none cursor-pointer", { 'bg-blue-600 text-white ': $setup._actual === i, 'bg-transparent text-teal-900': $setup._actual != i }]),
              onClick: vue.withModifiers(() => $setup.change(i), ["prevent"])
            }, vue.toDisplayString(i), 11 /* TEXT, CLASS, PROPS */, _hoisted_6$1)
          ], 2 /* CLASS */))
        }), 128 /* KEYED_FRAGMENT */)),
        ($setup.hasNext)
          ? (vue.openBlock(), vue.createElementBlock("li", _hoisted_7$1, [
              vue.createElementVNode("a", {
                class: "page-link relative block py-1.5 px-3 rounded border-0 bg-transparent outline-none transition-all duration-300 rounded text-gray-800 hover:text-gray-800 hover:bg-gray-200 focus:shadow-none cursor-pointer",
                "aria-label": "Next",
                onClick: _cache[1] || (_cache[1] = vue.withModifiers((...args) => ($setup.next && $setup.next(...args)), ["prevent"]))
              }, [
                vue.createElementVNode("span", _hoisted_8$1, [
                  vue.createVNode(_component_ChevronRightIcon, {
                    class: "h-6 w-6",
                    "aria-hidden": "true"
                  })
                ])
              ])
            ]))
          : vue.createCommentVNode("v-if", true)
      ])
    ])
  ]))
}

script$9.render = render$5;
script$9.__file = "src/components/common/Pagination.vue";

var script$8 = {
    props:['data', 'cell'],
    data(){ return {
        formopen: false
    }},
    methods: {
        replaceByDefault(e) {
            e.target.src = '';
        },
        showModal(item){ 
           this.$emit("click", this.data);
           this.formopen = true;
           this.$message(`<img src="${item}" />`, null, false);
        }
    }
};

const _hoisted_1$8 = ["src"];

function render$4(_ctx, _cache, $props, $setup, $data, $options) {
  return (vue.openBlock(), vue.createElementBlock("span", null, [
    vue.createElementVNode("img", {
      onClick: _cache[0] || (_cache[0] = $event => ($options.showModal($props.data))),
      src: $props.data,
      style: {"height":"30px","width":"auto"},
      onError: _cache[1] || (_cache[1] = (...args) => ($options.replaceByDefault && $options.replaceByDefault(...args)))
    }, null, 40 /* PROPS, HYDRATE_EVENTS */, _hoisted_1$8)
  ]))
}

script$8.render = render$4;
script$8.__file = "src/components/tables/image.vue";

var script$7 = {
    props:['data', 'cell'],
    data(){ return {
        valid: true,
        model: []
    }},
    mounted () {
      this.checkFormat(this.data);
    },
    methods:{
        checkFormat(data){
            if( data === null || data === undefined) 
            this.model = [];
            if( Array.isArray(data) ){
            this.valid = true;
            this.model = data;
            }else if( typeof data == 'string' && data.includes('[') ){
                try {
                    this.model = JSON.parse(data);
                    this.valid = true;
                } catch (e) {
                    this.valid = false;
                }
            }else {
                this.valid = false;
            }
        }
    }
};

const _hoisted_1$7 = { key: 0 };
const _hoisted_2$4 = { key: 1 };

function render$3(_ctx, _cache, $props, $setup, $data, $options) {
  return (vue.openBlock(), vue.createElementBlock("span", null, [
    ($data.valid)
      ? (vue.openBlock(), vue.createElementBlock("span", _hoisted_1$7, vue.toDisplayString($data.model && $data.model.join(', ')), 1 /* TEXT */))
      : (vue.openBlock(), vue.createElementBlock("span", _hoisted_2$4, "Invalid data array"))
  ]))
}

script$7.render = render$3;
script$7.__file = "src/components/tables/tags.vue";

const { has: has$1, sortBy, get: get$2, isNil: isNil$1, isObject, omit, isEqual, capitalize, round } = _;
 
// const sendType = (cell, row, data) => {
//     if( cell?.action?.source == 'cell')
//         return cell
//     else if( cell?.action?.source == 'row')
//         return { ...row, [cell.key]: data }
//     else if( cell?.action?.source == 'field')
//         return { [cell.key]: data }
//     else if( cell?.action?.source == 'context')
//         return mergeDeep(cell?.action?.data, { overwrite: {api:{ resource:row }}, row: get(row, cell?.action?.id, data) })
//     else if( cell?.action?.source == 'custom')
//         return cell?.action?.data
//     else    
//         return data
// }

const mergeDeep  = (a = {}, b = {}) => {
    return deepmerge(a, b, {
        arrayMerge: (d, s) => {
            return [ ...d, ...s ]
        }
    })
};

// const formatModel = (columns=[], data) => {
//     columns.map(i => {
//         if( data[i.prop] && ['date'].includes(i.type) ){ 
//             let format = ( i.type == 'date' ? 'YYYY-MM-DD': 'YYYY-MM-DD\\Thh:mm:ss' )
//             data[i.prop] = formatDate(data[i.prop], format, null, true)
//         } 
//     })
//     return data
// }

// const formatOutput = (columns=[], data) => {
//     console.debug('formatOutput', data)
//     let extractdata = (col = {}, k) =>  {
//         if( col.children && Array.isArray(col.children) )  col.children.map( i => extractdata(i, k))
//         if( get(col, 'name', false) ){
//             if( col.ignored && data[col.name] ) {
//                 console.debug('formatOutput ignored', col)
//                 data = omit(data, [col.name]) 
//             }
//         }
//     }
//     columns.map((col, k) => {
//             extractdata(col, k)
//     })
//     console.debug('formatOutput out', data)
//     return data
// }

const formatDate = function(value, format, from, utc=false) {
    if (value) {
      let date = moment(String(value), from);
      console.log('formatDate', value, date);
      if(utc) date = date.utc();
      return date.format(format)
    }
};

const interpolate = (string, scope, def) => {
    if( typeof string !== 'string' ) return string; 

    return string.replace(/\{([^}]*)}/g, (r,k) => get$2(scope, k, (def ? def:'{'+k+'}')) );
};

const queryString = (params, join, data) => {
    let rtn = '';
    let arrQuery = [];
    if( isObject(params) && Object.keys(params).length > 0 ){
        Object.keys(params).map(k => {
            if( Array.isArray(params[k]) )
                params[k].map(i => arrQuery.push([ interpolate(k, data), interpolate(i, data)]) );
            else
                arrQuery.push([interpolate(k, data), interpolate(params[k], data)]);
        });

        rtn = join+new URLSearchParams( arrQuery );
    }
    return rtn
};

const filterParams = (api, queryInfo) => { 
    let { page, pageSize, sort, filters } = queryInfo || {};
    let { params = {}, pagination = {} } = api || {};
    if( !isNil$1(page) && has$1(pagination, 'pageField') )
        params[ pagination.pageField || 'page' ] = page;
    if( !isNil$1(pageSize) && has$1(pagination, 'limitField') )
        params[ pagination.limitField || 'limit'] = pageSize;
    if( sort && !isNil$1(sort.prop) && !isNil$1(sort.order) && has$1(pagination, 'sortField') && has$1(pagination, 'sortExp') ){
        let pagData = {prop: sort.prop, sort: sort.order == 'ascending'? get$2(pagination,'sortAscChar','asc'): get$2(pagination, 'sortDescChar', 'desc')};
        params[ pagination.sortField || 'order' ] = interpolate( get$2(pagination, 'sortExp', '{prop},{order}'), pagData);
    }

    if( get$2(queryInfo, 'filters', []).length > 0 ){
      for(let i = 0; i < get$2(queryInfo, 'filters', []).length; i++ ){  
        let filterField = interpolate(
          get$2(filters[i], 'filterField', (pagination?.filterField || 'filter')), 
          get$2(filters, '[0]', {}) 
        );
        let filterExp = get$2(filters[i], 'filterExp', (pagination?.filterExp || '{prop},like,%{value}%'));
        if ( !params[filterField] ) params[ filterField ] = [];
        if( has$1(filters, `[${i}].prop`) && has$1(filters, `[${i}].value`) && filters[i].value && has$1(pagination, 'filterField') && (has$1(pagination, 'filterExp') || has$1(filters[i], 'filterExp')) )
            params[ filterField ].push( interpolate(filterExp, filters[i]) );
      }
    }else if( has$1(pagination, 'filterField') ){
      let filterField = interpolate(
        get$2(pagination, 'filterField', 'filter'), 
        get$2(filters, '[0]', {}) 
      );
      delete params[ filterField ];
    }
    console.log('filter params', params);
    return {...api, params};
};

// const getLocalStorage = (key, json=true) => {
//     try{
//         let ls = window.localStorage.getItem(key)
//         if( ls ){
//             if( json ) ls = JSON.parse(ls)
//             return ls
//         }
//         return null
//     }catch(e){
//         console.log('getLocalStorage', e)
//         return null
//     }
// }

// const setLocalStorage = (key, data, json=true) => {
//     try{
//         if( key ){
//             if( json ) data = JSON.stringify(data)
            
//             let ls = window.localStorage.setItem(key, data)
//             return ls
//         }
//         return true
//     }catch(e){
//         console.log('setLocalStorage', e)
//         return false
//     }
// }

// const saveSettings = (data) => {
//     try{
//         let settings = getLocalStorage('settings') || {}

//         settings = { ...settings, ...data }

//         setLocalStorage('settings', settings)

//         return settings
//     }catch(e){
        
//         console.log('saveSettings', e)
//     }
// }

// const isRegex = (data, reg, custom=false) => {
//     let rgs ={
//         url: "^(http[s]?:\\/\\/(www\\.)?|ftp:\\/\\/(www\\.)?|www\\.)"
//     }
//     if( !rgs[reg] && !custom ) return ;

//     var regex = new RegExp( rgs[reg] || reg );

//     console.debug('isRegex', rgs[reg], data, regex.test(data))
//     return regex.test(data)
// }  


///
// TABLES
//

const schemaColumns = (properties) => {
  // let columns = [ { label: '', key: "_selected", filter: false, sorter:false, sort: -1 } ]
  let columns = [  ];
  let extractdata = (col = {}, k) =>  {
      if( col.children && Array.isArray(col.children) )  col.children.map( i => extractdata(i, k));
      if( get$2(col, 'config.grid', false) )
          columns.push({
              sort: get$2(col, 'config.sort', k+1),
              key: get$2(col, 'name', col.id),
              label: get$2(col, 'config.label', capitalize((col.label || col.name))),
              type: get$2(col, 'config.type', (col.type || 'text')),
              action: Object.assign( get$2(col, 'config.action',{}), get$2(col, 'attributes', {}) ),
              options: get$2(col, 'options', {}),
              model: get$2(col, 'model', {}),
              overwrite: get$2(col, 'overwrite', {}),
              sorter: get$2(col, 'config.sorter', true),
              filter: get$2(col, 'config.filter', true),
              _classes: get$2(col, 'config.classes'),
              _style: get$2(col, 'config.styles'),
          });
  };
  properties.map((col, k) => {
          extractdata(col, k);
  });

  // columns.push({ label: '', key: 'actions', filter: false, sorter: false })

  return sortBy(columns, ['sort'])
};

const can = (schema, attr) => {
  return get$2(schema, attr, true)
};

const isSelected = (rows, row) => {
    return rows.findIndex(i => _.isEqual(i, row) ) >= 0
};

const selectionChange = (rows, row, index) => {
    let key = rows.findIndex(i => isEqual(i, row) );
    if( key >= 0 )   
      rows.splice(key, 1);
    else
      rows.push(row);
    return rows
};

const selectionAll = (rows, data) =>{
  if( rows.length == data.length ){
    rows = [];
  }else
    rows = data;
  return rows
};

const fetchQueryInfo = (type, data) => {
  console.debug("fetch query info", type, data);
  let queryInfo = { type };
  if( type == 'sort' ){
    queryInfo.sort = { prop: data.column, order: data.asc === true ? 'ascending':'descending' };
  }
  if( type == 'filter' ){
    queryInfo.filters = Object.keys(data).map((key) => ({ 
      prop: key, value: data[key]?.value, filterExp: data[key]?.filter?.filterExp, filterField: data[key]?.filter?.filterField
    }));
  }
  if( type == 'page' ){
    queryInfo.page = data;
  }
  if( type == 'pageSize' ){
    queryInfo.pageSize = data;
  }
  
 return queryInfo
};

const validateQueryInfo = (queryInfo) => { 
  if( !queryInfo || typeof queryInfo !== 'object' ) return false;
  
  if( ['sizeChange', 'pageSize', 'size', 'pageChange', 'sort', 'filter', 'page', 'init'].includes(queryInfo.type) ){
      if( queryInfo.type == 'filter' &&  !get$2(queryInfo, 'filters[0].prop')  )
          return false;
  }

  return true
};

const calcPages = (totalRows, perPage) => {
  let count = (totalRows || 1) / perPage;
  let rounded = round(count);
  return count > rounded ? rounded + 1 : rounded
};

var script$6 = {
    props:['data', 'cell', 'row'],
    methods: {
        replaceContent() {
            if( this.cell?.action?.label ) 
                return interpolate(this.cell.action.label, {data: this.data, action: this.cell.action, row: this.row  })
            else
                return this.data
        }
    }
};

const _hoisted_1$6 = ["href", "target", "innerHTML"];

function render$2(_ctx, _cache, $props, $setup, $data, $options) {
  return (vue.openBlock(), vue.createElementBlock("a", {
    href: $props.cell?.action?.handler,
    target: ($props.cell?.action?.target ?? '_self'),
    innerHTML: $options.replaceContent()
  }, null, 8 /* PROPS */, _hoisted_1$6))
}

script$6.render = render$2;
script$6.__file = "src/components/tables/link.vue";

var script$5 = {
    props:['data', 'cell', 'row'],
    computed:{ 
        expression(){ 
            let compiled = _.template(_.get(this.cell, 'action.template', '${ data }'));
            return compiled({data: this.data, cell: this.cell, row: this.row}) 
        }
    }
};

const _hoisted_1$5 = ["innerHTML"];

function render$1(_ctx, _cache, $props, $setup, $data, $options) {
  return (vue.openBlock(), vue.createElementBlock("span", vue.mergeProps({ innerHTML: $options.expression }, vue.toHandlers(_ctx.$listeners, true)), null, 16 /* FULL_PROPS */, _hoisted_1$5))
}

script$5.render = render$1;
script$5.__file = "src/components/tables/expression.vue";

const { get: get$1, set, has, isNil, isEmpty } = _;

var ResourceClass = ({ $axios,  }) => {
  let modelUrl = null;
  let model = {};
  // table
  let rows = {};
  let total = 1;
 
  // Schema 
  const setModel = (modelObj={}) => {
    model = JSON.parse(JSON.stringify(modelObj));
    model.properties;
  };
  const getModel = () => {
    return model
  };

  const loadModel = async (url, options) => {
    return await $axios.get(url, options).then( res => {
        console.log("loadModel "+url, res);
        if( !res.api ) throw { message: "Model Load error" }

        return res
    })
  };

  const loadModelByUrl = async (path='', file) => {
    try {
      modelUrl = `/models/${path}${file}`;
      let { data } = await $axios.get(modelUrl);
      if( !data.domain )
        throw { message:'Model load error' }

      model = data;

      return data
    } catch (error) {
      console.error("loadModelByUrl", error);
      return false
    }
  };

  const can = (perm) => {
    if( perm == 'getData' ){
      return get$1(model, 'api.getData', true)
    }
    if( perm == 'getDataById' ){
      return get$1(model, 'api.getData', true)
    } 
    if( perm == 'deleteDataById' ){
      return get$1(model, 'api.deleteDataById', true)
    }

    return true
  };

  const isIt = (perm) => {
    if( perm == 'local' ){
      return get$1(model, 'api.pagination.local', false)
    } 
    return false
  };

  // Data
  const setData = (resource, filters) => { 
    console.log('setData', resource, filters);
    let data = resource;
    let isRow = has(data, `[${model.primaryKey || 'id'}]`) || model.type == 'form';
    let api = get$1(model, 'api', {});

    if( isRow ){
      return ( !isNil(api.wrapDataById) ? get$1(data, api.wrapDataById, data): data)
    }else {
      rows = ( !isNil(api.wrapData) ? get$1(data, api.wrapData, data): data);
      total = ( !isNil(api.totalData) ? get$1(data, api.totalData, rows.length): rows.length );

      if( !Array.isArray(rows) ) rows = [rows];
      if( typeof total !== 'number' ) total = rows.length;

      if( filters?.filters && Array.isArray(filters?.filters) && filters?.filters?.length > 0 ){
        rows = filterLocal(filters.filters);
        total = rows.length;
      }

      if( filters?.sort )
        rows = sortLocal(filters.sort);

      return {
        rows,
        total
      }
    }
  };

  const getData = async (data={}, config={}) => {
    console.log("called get data", data, config);
    let { api = {} } = model;
    if( api.resource && isEmpty(data.data) ) data.data = api.resource;

    let url = '';
    let isRow = has(data, `[${model.primaryKey || 'id'}]`) || model.type == 'form';
    let options = {
      method: ( isRow ? ( isNil(api.methodGetById) ? 'GET':api.methodGetById) : (isNil(api.methodGet) ? 'GET':api.methodGet) ),
      ...config
    }; 
    let sessionConfig = {
      session: model.auth
    };

    let query = queryString(api.params, ( api.rootApi.includes('?') ? '&':'?'), data);

    if( isRow )
      url = `${api.rootApi}${ isNil(api.urlGetById) ? '/{id}{query}': api.urlGetById }`;
    else
      url = `${api.rootApi}${ isNil(api.urlGet) ? '{query}': api.urlGet }`;

    if( api.headers )
      options['headers'] = api.headers;
    
    url = interpolate(url, {...data, query });
  
    // console.debug('get data', url, options, sessionConfig)
    return $axios(url, options, sessionConfig)
    .then( data => {  
      data = sessionConfig.wrap === false ? data : data.data;

      if( isRow ){
        return ( !isNil(api.wrapDataById) ? get$1(data, api.wrapDataById, data): data)
      }else {
        rows = ( !isNil(api.wrapData) ? get$1(data, api.wrapData, data): data);
        total = ( !isNil(api.totalData) ? get$1(data, api.totalData, rows.length): rows.length );

        if( !Array.isArray(rows) ) rows = [rows];
        if( typeof total !== 'number' ) total = rows.length;
  
        return {
          rows,
          total
        }
      }
    })
  };
  
  const getDataObject = async (data={}, config={}) => { 
    let { api = {} } = model;
    if( api.resource && isEmpty(data.data) ) data.data = api.resource;

    let url = '';
    let options = {
      method:  isNil(api.methodGet) ? 'GET': api.methodGet,
      ...config
    }; 
    let sessionConfig = {
      session: model.auth
    };

    let query = queryString(api.params, ( api.rootApi.includes('?') ? '&':'?'), data);
  
    url = `${api.rootApi}${ isNil(api.urlGet) ? '{query}':api.urlGet }`;

    if( api.headers )
      options['headers'] = api.headers;
    
    url = interpolate(url, {...data, query });
    
    console.debug('get data object', url, options, sessionConfig);
    return $axios(url, options, sessionConfig)
        .then( data => {   
          return ( !isNil(api.wrapData) ? get$1(data, api.wrapData, data): data) 
        })
  };
    
  const saveData = async (data, config={}) => { 
    let { api = {} } = model; 
    let resource = api.resource || {};
    let url = '';
    let primaryKey = (isNil(model.primaryKey) ? 'id':model.primaryKey);
    let method = data[primaryKey] ? (isNil(api.methodPatch) ? "PUT":api.methodPatch) : (isNil(api.methodPost) ? "POST":api.methodPost);
    let query = interpolate( 
      queryString(api.params, (api.rootApi.includes('?') ? '&':'?')),  
      { ...data, data: resource }
    );
    let sessionConfig = {
      session: model.auth
    };
  
    if( has(data, primaryKey) )
      url = `${api.rootApi}${ isNil(api.urlPatch) ? '/{id}':api.urlPatch }`;
    else
      url = `${api.rootApi}${ isNil(api.urlPost) ? '': api.urlPost}`;

    console.log("saveData interpolate date", url, {...data, query}, api.resource);
    url = interpolate(url, {...data, query, data: resource});

    let options = {
      method,
      data,
      ...config
    };
    if( api.headers )
      options['headers'] = api.headers;
    
    return $axios(url, options, sessionConfig)
  };

  const deleteData = async (data, config={}) => {
    let { api={} } = model;
    if( api?.resource && isEmpty(data.data) ) data.data = api.resource;
    
    let primaryKey = (model?.primaryKey || 'id');

    if( !has(data, primaryKey) ) return Promise.reject('Id not found')

    let sessionConfig = {
      session: model?.auth
    };
    
    let method = ( isNil(api.methodDelete) ? "DELETE":api.methodDelete );
    let query = interpolate( 
      queryString(api.params, (api.rootApi.includes('?') ? '&':'?')),  
      data
    );
    let url = `${api.rootApi}${ isNil(api.urlDelete) ? '/{id}':api.urlDelete }`;
      
    url = interpolate(url, {...data, query});

    let options = {
      method,
      ...config
    };
    if( api.headers )
      options['headers'] = api.headers;
    
    return $axios(url, options, sessionConfig)
  };

  // Fitlers
  const paginate = ({ local = false, perPage = 5, page = 1 }) => { 
    console.debug('paginate', rows.length, ((perPage * page) - perPage), (perPage * page));
    if( !local ) return rows
    return  [...rows].slice( ((perPage * page) - perPage), (perPage * page))
  };

  const sorting = ({ local, col, order }) => {
    if( !local ) return rows
    return _.orderBy(rows, col. order)
  };

  const filterLocal = (filters = []) => { 
    return rows.filter(
      (row) => {
        return filters.some(i => String(row[i.prop]).includes(String(i.value)) )
      }
    )
  };

  const sortLocal = (filters) => { 
    if( !filters || !filters.prop ) return rows

    let sorted = _.sortBy(rows, [filters.prop]);
    if( filters.order === 'descending' ) sorted.reverse();
    return sorted
  };

  return {
    // Schema
    loadModel,
    loadModelByUrl,
    setModel,
    getModel,
    can,
    isIt,
    // Data
    getData,
    setData,
    getDataObject,
    saveData,
    deleteData,
    paginate,
    sorting,
  }
};

// import InputMixin from '~/libs/core/input.mixin'

var script$4 = {
  props:['data', 'cell'],
  // mixins: [InputMixin],
  data(){return { 
    Instance: ResourceClass({ $axios: axios }),  
  }},
  computed:{

  },
  async mounted(){
    let { action, model } = this.cell;
    this.Instance = ResourceClass;
    // if( schema )
    //   schema = await this.loadNestedSchema(schema)
      
    // if( action && action.fieldValue )
    //   schema = { api:  }

    if( model && model.api  )
      this.cell.options = await this.getOptions(
          { ...model.api, ...action }, 
          this.data, 
          filterParams(model.api, { filters:[{prop: action.fieldValue, value: this.data}] }) 
      );

    this.renderComponent = true;
  },
  methods:{ 
    forceRerender() {
      this.renderComponent = false;

      this.$nextTick(() => {
        this.renderComponent = true;
      });
    }, 
    async getOptions({ rootApi, fieldLabel, fieldValue, ...data }, model = {}, filter={}){
      try{ 
        // console.debug("input mixin get options", { rootApi, fieldLabel, fieldValue, ...data })
        if( rootApi ){
          this.loading = true;
          data = mergeDeep(data, this.request);
          if( typeof filter == 'object' )
            data = mergeDeep(data, filter);

          rootApi = interpolate(rootApi, { data: model });
 
          this.Instance.setModel({ api: { ...data, rootApi, resource: this.formValues } });

          // console.log("getOoptions", this.Instance.getModel())
          let { rows } = await this.Instance.getData({ data: model }); 

         this.options = rows && rows.map((i, k) => ({ 
              label: get(i, fieldLabel, i.toString()), 
              value: get(i, fieldValue, k)
            }) 
          );
          
          this.loading = false;
          this.forceRerender();
          return this.options
        }
      }catch(e){
          alert('Erro to get data from '+ rootApi);
          console.error('Erro select input', e);
          return this.options
      }
    },
  }
};

const _hoisted_1$4 = ["value"];
const _hoisted_2$3 = ["value"];

function render(_ctx, _cache, $props, $setup, $data, $options) {
  return (_ctx.renderComponent)
    ? (vue.openBlock(), vue.createElementBlock("select", {
        key: 0,
        class: "table-select",
        value: $props.data,
        size: "sm",
        disabled: ""
      }, [
        vue.createCommentVNode(" v-on=\"$listeners\" "),
        (vue.openBlock(true), vue.createElementBlock(vue.Fragment, null, vue.renderList(($props.cell.options || _ctx.options), (opt, idx) => {
          return (vue.openBlock(), vue.createElementBlock("option", {
            key: idx,
            value: opt.value
          }, vue.toDisplayString(opt.label), 9 /* TEXT, PROPS */, _hoisted_2$3))
        }), 128 /* KEYED_FRAGMENT */))
      ], 8 /* PROPS */, _hoisted_1$4))
    : vue.createCommentVNode("v-if", true)
}

script$4.render = render;
script$4.__file = "src/components/tables/select.vue";

const _hoisted_1$3 = {
  key: 0,
  class: "font-semibold text-xs mr-1"
};
const _hoisted_2$2 = {
  key: 1,
  class: "font-semibold text-xs ml-1"
};


var script$3 = {
  __name: 'toggle',
  props: ['data', 'cell', 'row'],
  setup(__props) {

const { data, cell, row } = __props;
 
    
  const model = ref(row ?? false);

return (_ctx, _cache) => {
  return (vue.openBlock(), vue.createElementBlock("div", {
    class: vue.normalizeClass(["flex items-center cursor-pointer py-2", ['cursor-not-allowed']])
  }, [
    (!vue.unref(model))
      ? (vue.openBlock(), vue.createElementBlock("span", _hoisted_1$3, " Off "))
      : vue.createCommentVNode("v-if", true),
    vue.createElementVNode("div", {
      class: vue.normalizeClass(["rounded-full w-10 h-6 p-0.5 bg-gray-300", {'bg-red-500': !vue.unref(model),'bg-green-500': vue.unref(model)}])
    }, [
      vue.createElementVNode("div", {
        class: vue.normalizeClass(["rounded-full w-5 h-5 bg-white transform mx-auto duration-300 ease-in-out", {'-translate-x-2': !vue.unref(model),'translate-x-2': vue.unref(model)}])
      }, null, 2 /* CLASS */)
    ], 2 /* CLASS */),
    (vue.unref(model))
      ? (vue.openBlock(), vue.createElementBlock("span", _hoisted_2$2, " On "))
      : vue.createCommentVNode("v-if", true)
  ]))
}
}

};

script$3.__file = "src/components/tables/toggle.vue";

const _hoisted_1$2 = { class: "whitespace-nowrap" };
  
var script$2 = {
  __name: 'dates',
  props: ['data', 'cell', 'row'],
  setup(__props) {

  
    

return (_ctx, _cache) => {
  return (vue.openBlock(), vue.createElementBlock("div", _hoisted_1$2, vue.toDisplayString(vue.unref(formatDate)(__props.data, __props.cell?.action?.format || 'MM/DD/YYYY hh:mm', __props.cell?.action?.from || null, __props.cell?.action?.utc || false)), 1 /* TEXT */))
}
}

};

script$2.__file = "src/components/tables/dates.vue";

const _hoisted_1$1 = ["textContent"];
const _hoisted_2$1 = ["innerHTML"];
const _hoisted_3$1 = ["textContent"];
// import Actions from './action'
// import BelongsTo from './belongsTo'

var script$1 = {
  __name: 'index',
  props: ['data','cell'],
  setup(__props) {

const { data, cell } = __props;
  
const { get } = _;
  
vue.computed(() => {
    return get(cell, 'click.type', 'link')
});  

function emitAction(){
    // if( this.cell.type == 'action' || !this.cell.action || !this.cell.action.event || this.cell.action.event != 'click' ) 
    //     return;

    // this.$bus.$emit(this.cell.action?.handler, this.sendType(this.cell, this.data, this.data[this.cell.key]) )
    // console.log("chamado event", this.cell)
}

return (_ctx, _cache) => {
  const _component_CommonsFragment = vue.resolveComponent("CommonsFragment");

  return (__props.cell.type == 'tags')
    ? (vue.openBlock(), vue.createBlock(_component_CommonsFragment, { key: 0 }, {
        default: vue.withCtx(() => [
          vue.createVNode(script$7, {
            data: __props.data[__props.cell.key],
            cell: __props.cell,
            row: __props.data,
            onClick: emitAction
          }, null, 8 /* PROPS */, ["data", "cell", "row"])
        ]),
        _: 1 /* STABLE */
      }))
    : (__props.cell.type == 'image')
      ? (vue.openBlock(), vue.createBlock(_component_CommonsFragment, { key: 1 }, {
          default: vue.withCtx(() => [
            vue.createVNode(script$8, {
              data: __props.data[__props.cell.key],
              cell: __props.cell,
              row: __props.data,
              onClick: emitAction
            }, null, 8 /* PROPS */, ["data", "cell", "row"])
          ]),
          _: 1 /* STABLE */
        }))
      : (__props.cell.type == 'switch' || __props.cell.type == 'toggle')
        ? (vue.openBlock(), vue.createBlock(_component_CommonsFragment, { key: 2 }, {
            default: vue.withCtx(() => [
              vue.createVNode(script$3, {
                data: __props.data[__props.cell.key],
                cell: __props.cell,
                row: __props.data,
                onClick: emitAction
              }, null, 8 /* PROPS */, ["data", "cell", "row"])
            ]),
            _: 1 /* STABLE */
          }))
        : (__props.cell.type == 'select' || __props.cell.type == 'autocomplete' || __props.cell.type == 'dynamic')
          ? (vue.openBlock(), vue.createBlock(_component_CommonsFragment, {
              key: 3,
              onClick: emitAction
            }, {
              default: vue.withCtx(() => [
                vue.createVNode(script$4, {
                  data: __props.data[__props.cell.key],
                  cell: __props.cell,
                  row: __props.data,
                  onClick: emitAction
                }, null, 8 /* PROPS */, ["data", "cell", "row"])
              ]),
              _: 1 /* STABLE */
            }))
          : (__props.cell.type == 'link')
            ? (vue.openBlock(), vue.createElementBlock(vue.Fragment, { key: 4 }, [
                vue.createCommentVNode(" <span v-else-if=\"cell.type == 'belongsTo'\">\r\n        <BelongsTo :data=\"data[cell.key]\" :cell=\"cell\" :row=\"data\" v-on:click=\"emitAction\"   />\r\n    </span>  "),
                vue.createVNode(_component_CommonsFragment, null, {
                  default: vue.withCtx(() => [
                    vue.createVNode(script$6, {
                      data: __props.data[__props.cell.key],
                      cell: __props.cell,
                      row: __props.data,
                      onClick: emitAction
                    }, null, 8 /* PROPS */, ["data", "cell", "row"])
                  ]),
                  _: 1 /* STABLE */
                })
              ], 2112 /* STABLE_FRAGMENT, DEV_ROOT_FRAGMENT */))
            : (__props.cell.type == 'expression')
              ? (vue.openBlock(), vue.createBlock(_component_CommonsFragment, { key: 5 }, {
                  default: vue.withCtx(() => [
                    vue.createVNode(script$5, {
                      data: __props.data[__props.cell.key],
                      cell: __props.cell,
                      row: __props.data,
                      onClick: emitAction
                    }, null, 8 /* PROPS */, ["data", "cell", "row"])
                  ]),
                  _: 1 /* STABLE */
                }))
              : (__props.cell.type == 'date')
                ? (vue.openBlock(), vue.createElementBlock("span", {
                    key: 6,
                    onClick: emitAction
                  }, [
                    vue.createVNode(script$2, {
                      data: __props.data[__props.cell.key],
                      cell: __props.cell,
                      row: __props.data,
                      onClick: emitAction
                    }, null, 8 /* PROPS */, ["data", "cell", "row"])
                  ]))
                : (__props.cell.type == 'object')
                  ? (vue.openBlock(), vue.createElementBlock(vue.Fragment, { key: 7 }, [
                      vue.createCommentVNode(" <span v-else-if=\"cell.type == 'action'\"  >\r\n        <Actions :data.sync=\"data[cell.key]\" :cell.sync=\"cell\" :row.sync=\"data\" />\r\n    </span> "),
                      vue.createElementVNode("span", {
                        textContent: vue.toDisplayString(vue.unref(get)(__props.data, `row.${__props.cell.action.name}`, __props.data[__props.cell.key])),
                        onClick: emitAction
                      }, null, 8 /* PROPS */, _hoisted_1$1)
                    ], 2112 /* STABLE_FRAGMENT, DEV_ROOT_FRAGMENT */))
                  : (__props.cell.type == 'html')
                    ? (vue.openBlock(), vue.createElementBlock("span", {
                        key: 8,
                        innerHTML: __props.data[__props.cell.key],
                        onClick: emitAction
                      }, null, 8 /* PROPS */, _hoisted_2$1))
                    : (vue.openBlock(), vue.createElementBlock("span", {
                        key: 9,
                        textContent: vue.toDisplayString(__props.data[__props.cell.key]),
                        onClick: emitAction
                      }, null, 8 /* PROPS */, _hoisted_3$1))
}
}

};

script$1.__file = "src/components/tables/index.vue";

const _hoisted_1 = { class: "relative shadow-md sm:rounded-lg crud-table overflow-x-auto w-full" };
const _hoisted_2 = {
  key: 1,
  class: "w-full text-sm text-left text-gray-500 dark:text-gray-400"
};
const _hoisted_3 = { class: "text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400" };
const _hoisted_4 = { class: "pd-toolbar" };
const _hoisted_5 = ["colspan"];
const _hoisted_6 = { class: "headers flex" };
const _hoisted_7 = { class: "lelf-col flex items-center justify-left w-1/2" };
const _hoisted_8 = { class: "right-col flex items-center justify-center w-1/2" };
const _hoisted_9 = { class: "right-col flex items-center justify-end w-1/2" };
const _hoisted_10 = /*#__PURE__*/vue.createElementVNode("th", null, null, -1 /* HOISTED */);
const _hoisted_11 = ["onClick"];
const _hoisted_12 = { class: "flex items-center gap-2" };
const _hoisted_13 = { key: 0 };
const _hoisted_14 = { class: "pd-filters" };
const _hoisted_15 = { class: "px-4 flex gap-2" };
const _hoisted_16 = ["checked"];
const _hoisted_17 = { class: "px-2 flex items-center justify-end" };
const _hoisted_18 = /*#__PURE__*/vue.createElementVNode("p", { class: "" }, "Limit", -1 /* HOISTED */);
const _hoisted_19 = { class: "px-4 py-2" };
const _hoisted_20 = ["checked", "onChange"];
const _hoisted_21 = { class: "px-2 py-2 flex justify-end" };
const _hoisted_22 = ["onClick"];
const _hoisted_23 = ["onClick"];
const _hoisted_24 = { class: "pd-footer" };
const _hoisted_25 = ["colspan"];
  // import { useAppContext } from '~/store/global' 
  
  
var script = {
  __name: 'Table',
  props: {  
    model:{
      type: Object,
      default: null
    },
    resource: {
      type: Array,
      default: []
    }
  },
  emits: ['create','edit','delete','selected','refresh'],
  setup(__props, { emit }) {

const { resource, model:defModel } = __props;

  
  
  let model = defModel ? vue.ref(defModel) : vue.inject('model');  
  vue.inject('session');  
  // const App = useAppContext() 
  let Instance = ResourceClass({ $axios: axios }); 
  let alert = vue.ref(null);
  let ready = vue.ref(false);
  let schema = vue.ref([]);
  let filters = vue.ref({});
  let selected = vue.ref([]);
  let table = vue.ref(resource);
  let perPage = vue.ref(5);
  let tableCount = vue.ref(1);
  let config = vue.reactive({});
  let queryInfo = vue.reactive({});
  const gete = _.get;

  
      
  let totalCols = vue.computed(() => { 
    return schema.value.length + 2
  });
    
  let totalPages = vue.computed(() => { 
    return calcPages(tableCount.value, perPage.value)
  });

  const deleteEmit = (row) =>{
    // Instance.setModel({ ...model.value })

    if( confirm('Are you sure?') ) { 
      ( Instance.can('deleteDataById') ? Instance.deleteData(row):Promise.resolve('bypassed')).then(
        e => {
          console.log(e);
          // $message("Removido com sucesso")
          emit('delete', { target: 'delete', row });
          getDatasource();
        }
      ).catch(setAlert);
    }else {
     return false
    }
  };

  const selectAll = () => {
    selected.value = selectionAll(selected.value, table.value);
    table.value = [ ...table.value ];
  };

  const deleteSelected = async () => {
    if( confirm('Are you sure?') ) {
      for( let row of selected.value ){
        await Instance.deleteData(row).then(e => { 
          emit('delete', { target: 'delete', row});
        });
      }
      $message("Removido com sucesso");
      getDatasource();
    }
  };

  const toggleSort = (col = {}) => {
    vue.nextTick(() => { 
      // let localPagination = _.get(model.value,'api.pagination.local', false)
      config.sort = col.key;
      col._order = _.isNil(col._order) ? false : !col._order;

      queryInfo = { ...queryInfo, ...fetchQueryInfo('sort', { column: col.key, asc: col._order }) };

      console.debug('toggleSort', queryInfo);
      // if( Instance.isIt('local') )
      //   table.value = Instance.sorting({ local: true, col:[col.key], order:[col._order ? 'desc':'asc']  })
      // else
        getDatasource();
    });
  };

  const changePage = (num) => {
    vue.nextTick(() => { 
      let localPagination = _.get(model.value,'api.pagination.local', false);
      queryInfo = { ...queryInfo, ...fetchQueryInfo('page', num) };

      if( localPagination )
        table.value = Instance.paginate({ local: true, perPage: perPage.value, page:num });
      else
        getDatasource();
    });
  };

  const changeLimit = (v) => {
    vue.nextTick(() => { 
      queryInfo = { ...queryInfo, ...fetchQueryInfo('pageSize', v) };

      getDatasource();
    });
  };

  const setFilter = (col, value) => {
    return changeFilters({ [col.key]:{ value:value, filter: col?.filter }})
  };

  const changeFilters = (e) => {
    vue.nextTick(() => { 
      console.debug("changeFilters change", e); 
      filters.value = Object.assign(filters.value, e);

      Object.keys(filters.value).map((item) => {
        if( !filters.value[item].value )
           filters.value = _.omit(filters.value, [item]);
      });

      queryInfo = { ...queryInfo, ...fetchQueryInfo('filter', filters.value) };
      getDatasource();
    });
  };

  const getDatasource = async (data={}, config={}) => {
    try { 
      if( !Instance.isIt('local') && !validateQueryInfo( JSON.parse(JSON.stringify(queryInfo)) )){
        let api = filterParams({ ...model.value.api }, { ...queryInfo, data: resource.value }); 
        Instance.setModel({ ...model.value, api });
      }
 
      if( Instance.can('getData') ){
        var { rows, total } = await Instance.getData(data, config);  
      } else { 
        var { rows, total } = await Instance.setData(resource, queryInfo);  
      }

      if( Instance.isIt('local') ) { 
        var { rows, total } = await Instance.setData(rows, queryInfo);  
      }
       
      // table.value = localPagination ? 
      table.value = Instance.paginate({ local:true, perPage: perPage.value });
      tableCount.value = total;

      emit('refresh', { target:'refresh', rows });
      console.debug("concluiu  getDatasource");
    } catch (error) {
      console.error(error);
      alert("Error to getData");
    }
  };

  const modifyColumn = async (input) => {
    if( input.model && typeof input.model == 'string' ) 
      input.model = await Instance.loadModel(input.model);

    if( input.overwrite && typeof input.overwrite == 'object' )
      input.model = mergeDeep(input.model, input.overwrite);
 
    return input
  };

  const setAlert = (rs) => {
    alert.value = {
      message: _.get(rs, 'response.data.message', _.get(rs, 'data.message', rs.message)),
      type: rs && rs.error ? 'error': 'success',
    };
  };

  vue.watch(model, () => {
    Instance.setModel({ ...model.value });

    getDatasource();
  });

  vue.watch(() => selected, (dd) => {  
    emit('selected', { target:'selected', rows:dd.value });
  }, { deep: true });

  vue.onBeforeMount(async () => {
    schema.value = schemaColumns(model.value?.properties); 
    for(let idx in schema.value){
      console.log('onBeforeMount', schema.value[idx]);
      schema.value[idx] = await modifyColumn(schema.value[idx]);
    }
  });
    
  vue.onMounted(async () => {
    try { 
      // console.error("table mounted", model.value)
      Instance.setModel({ ...model.value });
  
      await getDatasource();

      // $bus.listen('table:refresh', getDatasource)
    } catch (error) {
      console.error("onmounted", error);
    }
    ready.value = true;
  });
 
  vue.onUnmounted(() => {
      // console.error("table unmountedmounted", model.value)
      Instance.setModel({ });
  });

return (_ctx, _cache) => {
  const _component_FormKit = vue.resolveComponent("FormKit");

  return (vue.openBlock(), vue.createElementBlock("div", _hoisted_1, [
    (vue.unref(alert) && vue.unref(alert).message)
      ? (vue.openBlock(), vue.createElementBlock("div", {
          key: 0,
          class: vue.normalizeClass(`alert w-full text-center ${ vue.unref(alert)?.type || '' }`)
        }, [
          vue.createElementVNode("span", null, vue.toDisplayString(vue.unref(alert).message), 1 /* TEXT */)
        ], 2 /* CLASS */))
      : vue.createCommentVNode("v-if", true),
    (vue.unref(ready))
      ? (vue.openBlock(), vue.createElementBlock("table", _hoisted_2, [
          vue.createElementVNode("thead", _hoisted_3, [
            vue.createElementVNode("tr", _hoisted_4, [
              vue.createElementVNode("th", {
                scope: "col",
                colspan: vue.unref(totalCols),
                class: "py-2"
              }, [
                vue.createElementVNode("div", _hoisted_6, [
                  vue.createElementVNode("div", _hoisted_7, [
                    (vue.unref(selected).length)
                      ? (vue.openBlock(), vue.createElementBlock("button", {
                          key: 0,
                          class: "px-4 flex items-center whitespace-nowrap",
                          type: "button",
                          onClick: deleteSelected
                        }, [
                          vue.createVNode(vue.unref(script$a), { class: "h-5" }),
                          vue.createTextVNode(" " + vue.toDisplayString(vue.unref(selected).length) + " Selected ", 1 /* TEXT */)
                        ]))
                      : vue.createCommentVNode("v-if", true),
                    vue.createElementVNode("button", {
                      class: "px-4",
                      type: "button",
                      onClick: getDatasource
                    }, [
                      vue.createVNode(vue.unref(script$b), { class: "h-5" })
                    ]),
                    vue.createElementVNode("button", {
                      class: "px-4",
                      type: "button",
                      onClick: _cache[0] || (_cache[0] = () => emit('create', {target: 'create', row: {}}))
                    }, [
                      vue.createVNode(vue.unref(script$c), { class: "h-5" })
                    ]),
                    vue.renderSlot(_ctx.$slots, "toolbar-left")
                  ]),
                  vue.createElementVNode("div", _hoisted_8, [
                    vue.renderSlot(_ctx.$slots, "toolbar-center")
                  ]),
                  vue.createElementVNode("div", _hoisted_9, [
                    vue.renderSlot(_ctx.$slots, "toolbar-right")
                  ])
                ])
              ], 8 /* PROPS */, _hoisted_5)
            ]),
            vue.createElementVNode("tr", null, [
              _hoisted_10,
              (vue.openBlock(true), vue.createElementBlock(vue.Fragment, null, vue.renderList(vue.unref(schema), (col) => {
                return (vue.openBlock(), vue.createElementBlock("th", {
                  scope: "col",
                  class: "px-2 py-1",
                  key: col.key,
                  onClick: () => toggleSort(col)
                }, [
                  vue.createElementVNode("div", _hoisted_12, [
                    vue.createTextVNode(vue.toDisplayString(col.label) + " ", 1 /* TEXT */),
                    (col.sorter && vue.unref(config).sort == col.key)
                      ? (vue.openBlock(), vue.createElementBlock("span", _hoisted_13, [
                          (col._order)
                            ? (vue.openBlock(), vue.createBlock(vue.unref(script$e), {
                                key: 0,
                                class: "h-4"
                              }))
                            : (vue.openBlock(), vue.createBlock(vue.unref(script$f), {
                                key: 1,
                                class: "h-4"
                              }))
                        ]))
                      : vue.createCommentVNode("v-if", true)
                  ])
                ], 8 /* PROPS */, _hoisted_11))
              }), 128 /* KEYED_FRAGMENT */))
            ]),
            vue.createElementVNode("tr", _hoisted_14, [
              vue.createElementVNode("th", _hoisted_15, [
                vue.createElementVNode("input", {
                  type: "checkbox",
                  checked: (vue.unref(selected).length == vue.unref(table).length),
                  onChange: selectAll
                }, null, 40 /* PROPS, HYDRATE_EVENTS */, _hoisted_16),
                vue.createTextVNode(" All ")
              ]),
              (vue.openBlock(true), vue.createElementBlock(vue.Fragment, null, vue.renderList(vue.unref(schema), (col) => {
                return (vue.openBlock(), vue.createElementBlock("th", {
                  scope: "col",
                  class: "px-2 py-1",
                  key: col.key
                }, [
                  (col.filter)
                    ? (vue.openBlock(), vue.createBlock(_component_FormKit, {
                        key: 0,
                        type: vue.unref(gete)(col, 'filter.type', 'search'),
                        delay: 500,
                        "outer-class": "m-0 p-0",
                        "input-class": "w-full p-1",
                        model: vue.unref(gete)(col, 'model', {}),
                        overwrite: vue.unref(gete)(col, 'overwrite', {}),
                        options: vue.unref(gete)(col, 'options', []),
                        onInput: e => setFilter(col, e)
                      }, null, 8 /* PROPS */, ["type", "model", "overwrite", "options", "onInput"]))
                    : vue.createCommentVNode("v-if", true)
                ]))
              }), 128 /* KEYED_FRAGMENT */)),
              vue.createElementVNode("th", _hoisted_17, [
                _hoisted_18,
                vue.createVNode(_component_FormKit, {
                  "outer-class": "m-0 p-0 pl-2",
                  type: "select",
                  modelValue: vue.unref(perPage),
                  "onUpdate:modelValue": _cache[1] || (_cache[1] = $event => (vue.isRef(perPage) ? (perPage).value = $event : perPage = $event)),
                  options: [1,5,15,25,50,100,500],
                  onInput: changeLimit
                }, null, 8 /* PROPS */, ["modelValue"])
              ])
            ])
          ]),
          vue.createElementVNode("tbody", null, [
            (vue.openBlock(true), vue.createElementBlock(vue.Fragment, null, vue.renderList(vue.unref(table), (row, index) => {
              return (vue.openBlock(), vue.createElementBlock("tr", {
                class: "pd-rows bg-white border-b dark:bg-gray-800 dark:border-gray-700",
                key: index
              }, [
                vue.createElementVNode("td", _hoisted_19, [
                  vue.createElementVNode("input", {
                    type: "checkbox",
                    value: false,
                    checked: vue.unref(isSelected)(vue.unref(selected), row),
                    onChange: $event => (vue.unref(selectionChange)(vue.unref(selected), row))
                  }, null, 40 /* PROPS, HYDRATE_EVENTS */, _hoisted_20)
                ]),
                (vue.openBlock(true), vue.createElementBlock(vue.Fragment, null, vue.renderList(vue.unref(schema), (col) => {
                  return (vue.openBlock(), vue.createElementBlock("td", {
                    class: "px-2 py-2",
                    key: col.key
                  }, [
                    vue.createVNode(script$1, {
                      cell: col,
                      data: row
                    }, null, 8 /* PROPS */, ["cell", "data"])
                  ]))
                }), 128 /* KEYED_FRAGMENT */)),
                vue.createElementVNode("td", _hoisted_21, [
                  (vue.unref(can)(vue.unref(schema), 'canEdit'))
                    ? (vue.openBlock(), vue.createElementBlock("a", {
                        key: 0,
                        class: "cursor-pointer mr-3",
                        onClick: () => emit('edit', { target: 'edit', row})
                      }, [
                        vue.createVNode(vue.unref(script$d), { class: "h-5" })
                      ], 8 /* PROPS */, _hoisted_22))
                    : vue.createCommentVNode("v-if", true),
                  (vue.unref(can)(vue.unref(schema), 'canDelete'))
                    ? (vue.openBlock(), vue.createElementBlock("a", {
                        key: 1,
                        class: "cursor-pointer",
                        onClick: () => deleteEmit(row)
                      }, [
                        vue.createVNode(vue.unref(script$a), { class: "h-5" })
                      ], 8 /* PROPS */, _hoisted_23))
                    : vue.createCommentVNode("v-if", true)
                ])
              ]))
            }), 128 /* KEYED_FRAGMENT */))
          ]),
          vue.createElementVNode("tfoot", null, [
            vue.createElementVNode("tr", _hoisted_24, [
              vue.createElementVNode("td", {
                colspan: vue.unref(totalCols),
                class: "w-full p-2 pt-4"
              }, [
                vue.createVNode(script$9, {
                  pages: vue.unref(totalPages),
                  actual: 1,
                  onChange: changePage
                }, null, 8 /* PROPS */, ["pages"])
              ], 8 /* PROPS */, _hoisted_25)
            ])
          ])
        ]))
      : vue.createCommentVNode("v-if", true)
  ]))
}
}

};

script.__file = "src/components/Table.vue";

var components = {
  Table: script
};

const plugin = {
  install (Vue) {
    for (const prop in components) {
      if (components.hasOwnProperty(prop)) {
        const component = components[prop];
        Vue.component(`Crud${component.__name}`, component);
      }
    }
  }
};

module.exports = plugin;
